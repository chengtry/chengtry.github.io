<!DOCTYPE html>
<html lang="zh-cn">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>Redis - chengtry</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<meta name="author" content="chengtry" /><meta name="description" content="Redis基础 Redis的安装： 安装redis 1 2 3 4 5 #下载redis的安装包并用Xftp上传到服务器，用tar命令解压安装包 1. tar -xzvf redis-6.0.6.tar.gz #进" /><meta name="keywords" content="Hugo, theme, even" />






<meta name="generator" content="Hugo 0.98.0 with theme even" />


<link rel="canonical" href="https://chengtry.github.io/post/redis/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">



<link href="/sass/main.scss" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css" integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin="anonymous">


<meta property="og:title" content="Redis" />
<meta property="og:description" content="Redis基础 Redis的安装： 安装redis 1 2 3 4 5 #下载redis的安装包并用Xftp上传到服务器，用tar命令解压安装包 1. tar -xzvf redis-6.0.6.tar.gz #进" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://chengtry.github.io/post/redis/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2023-02-14T19:48:43+08:00" />
<meta property="article:modified_time" content="2023-02-28T16:36:45+08:00" />

<meta itemprop="name" content="Redis">
<meta itemprop="description" content="Redis基础 Redis的安装： 安装redis 1 2 3 4 5 #下载redis的安装包并用Xftp上传到服务器，用tar命令解压安装包 1. tar -xzvf redis-6.0.6.tar.gz #进"><meta itemprop="datePublished" content="2023-02-14T19:48:43+08:00" />
<meta itemprop="dateModified" content="2023-02-28T16:36:45+08:00" />
<meta itemprop="wordCount" content="11344">
<meta itemprop="keywords" content="Redis," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Redis"/>
<meta name="twitter:description" content="Redis基础 Redis的安装： 安装redis 1 2 3 4 5 #下载redis的安装包并用Xftp上传到服务器，用tar命令解压安装包 1. tar -xzvf redis-6.0.6.tar.gz #进"/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">chengtry</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">首页</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">归档</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">标签</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">目录</li>
      </a>
  </ul>

  


</nav>

  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">chengtry</a>
</div>





<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">首页</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">归档</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">标签</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">目录</a>
      </li>
  </ul>
</nav>

    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">Redis</h1>

      <div class="post-meta">
        <span class="post-time"> 2023-02-14 </span>
        <div class="post-category">
            <a href="/categories/study/"> Study </a>
            <a href="/categories/note/"> Note </a>
            </div>
          <span class="more-meta"> 约 11344 字 </span>
          <span class="more-meta"> 预计阅读 23 分钟 </span>
        
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">文章目录</h2>
  <div class="post-toc-content always-active">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#redis的安装">Redis的安装：</a>
      <ul>
        <li><a href="#安装redis">安装redis</a></li>
        <li><a href="#安装过程中出现的问题">安装过程中出现的问题</a></li>
      </ul>
    </li>
    <li><a href="#redis中文乱码">Redis中文乱码：</a>
      <ul>
        <li><a href="#解决方案启动时加上--raw">解决方案：启动时加上&ndash;raw</a></li>
      </ul>
    </li>
    <li><a href="#查看redis安装目录">查看Redis安装目录：</a>
      <ul>
        <li><a href="#用whereis和which命令找不到安装目录可以使用以下方法">用whereis和which命令找不到安装目录可以使用以下方法：</a></li>
      </ul>
    </li>
    <li><a href="#查看redis版本号">查看Redis版本号：</a>
      <ul>
        <li><a href="#1-redis-server---version">1. redis-server &ndash;version</a></li>
        <li><a href="#2-redis-cli--v">2. redis-cli -v</a></li>
        <li><a href="#3-启动redis后用info命令">3. 启动redis后，用info命令</a></li>
      </ul>
    </li>
    <li><a href="#redis启动停止重启设置密码进入">Redis启动、停止、重启、设置密码、进入</a>
      <ul>
        <li><a href="#redis启动">Redis启动:</a></li>
        <li><a href="#redis关闭">Redis关闭：</a></li>
        <li><a href="#redis重启">Redis重启：</a></li>
        <li><a href="#redis设置密码">Redis设置密码：</a></li>
        <li><a href="#redis进入">Redis进入</a></li>
      </ul>
    </li>
    <li><a href="#为什么-redis-是单线程还这么快">为什么 Redis 是单线程还这么快？</a></li>
  </ul>

  <ul>
    <li><a href="#string类型">String类型</a>
      <ul>
        <li><a href="#常见命令">常见命令：</a></li>
        <li><a href="#ttl命令">TTL命令：</a></li>
        <li><a href="#设置和取消过期时间">设置和取消过期时间</a></li>
        <li><a href="#rename-和-renamex-命令">rename 和 renamex 命令：</a></li>
        <li><a href="#命令代码">命令代码：</a></li>
      </ul>
    </li>
    <li><a href="#list类型">List类型</a>
      <ul>
        <li><a href="#命令代码-1">命令代码：</a></li>
      </ul>
    </li>
    <li><a href="#set类型">Set类型</a>
      <ul>
        <li><a href="#命令代码-2">命令代码：</a></li>
      </ul>
    </li>
    <li><a href="#hash类型">Hash类型</a>
      <ul>
        <li><a href="#命令代码-3">命令代码：</a></li>
      </ul>
    </li>
    <li><a href="#zset类型">Zset类型</a>
      <ul>
        <li><a href="#命令代码-4">命令代码:</a></li>
      </ul>
    </li>
  </ul>

  <ul>
    <li><a href="#geospatial地理位置">Geospatial(地理位置)</a>
      <ul>
        <li><a href="#命令代码-5">命令代码：</a></li>
      </ul>
    </li>
    <li><a href="#hyperloglog基数统计">Hyperloglog(基数统计)</a>
      <ul>
        <li><a href="#命令代码-6">命令代码：</a></li>
      </ul>
    </li>
    <li><a href="#bitmap位图">BitMap(位图)</a>
      <ul>
        <li><a href="#命令代码-7">命令代码：</a></li>
      </ul>
    </li>
  </ul>

  <ul>
    <li><a href="#事务">事务：</a></li>
    <li><a href="#redis事务过程">Redis事务过程：</a></li>
    <li><a href="#取消事务discard">取消事务(DISCARD)：</a></li>
    <li><a href="#事务错误">事务错误</a>
      <ul>
        <li><a href="#1代码语法错误编译时异常所有的命令都不执行">1.代码语法错误（编译时异常）所有的命令都不执行</a></li>
        <li><a href="#2代码逻辑错误-运行时异常-其他命令可以正常执行---所以不保证事务原子性">2.代码逻辑错误 (运行时异常) **其他命令可以正常执行 ** &raquo;&gt; 所以不保证事务原子性</a></li>
      </ul>
    </li>
  </ul>

  <ul>
    <li><a href="#乐观锁">乐观锁：</a>
      <ul>
        <li><a href="#1-正常执行">1. 正常执行</a></li>
        <li><a href="#2多线程测试">2.多线程测试</a></li>
      </ul>
    </li>
  </ul>

  <ul>
    <li><a href="#缓存穿透">缓存穿透</a>
      <ul>
        <li><a href="#概念">概念：</a></li>
        <li><a href="#解决方案">解决方案：</a></li>
      </ul>
    </li>
    <li><a href="#缓存击穿">缓存击穿</a>
      <ul>
        <li><a href="#概念-1">概念：</a></li>
        <li><a href="#解决方案-1">解决方案：</a></li>
      </ul>
    </li>
    <li><a href="#缓存雪崩">缓存雪崩</a>
      <ul>
        <li><a href="#概念-2">概念：</a></li>
        <li><a href="#解决方案-2">解决方案：</a></li>
      </ul>
    </li>
  </ul>

  <ul>
    <li><a href="#概念-3">概念</a></li>
    <li><a href="#开启多个redis服务一主二从">开启多个redis服务（一主二从）</a>
      <ul>
        <li><a href="#1去阿里云添加安全组规则开放637963806381端口号开放linux防火墙端口号">1.去阿里云添加安全组规则，开放6379/6380/6381端口号，开放linux防火墙端口号</a></li>
        <li><a href="#2复制redisconf-到-redis-6380confredis-6381conf">2.复制redis.conf 到 redis-6380.conf，redis-6381.conf</a></li>
        <li><a href="#3修改-redis-6380confredis-6381conf信息主要三个信息">3.修改 redis-6380.conf，redis-6381.conf信息（主要三个信息）</a></li>
        <li><a href="#4启动redis服务三个端口号">4.启动redis服务（三个端口号）</a></li>
        <li><a href="#5查看信息">5.查看信息</a></li>
        <li><a href="#6遇到master_link_status为down情况">6.遇到master_link_status为down情况</a></li>
      </ul>
    </li>
  </ul>

  <ul>
    <li><a href="#复制sentinelconf到自己目录下">复制sentinel.conf到自己目录下</a>
      <ul>
        <li><a href="#安装好的redis源码默认含有redisconf文件和sentinelconf文件">安装好的redis源码默认含有redis.conf文件和sentinel.conf文件</a></li>
      </ul>
    </li>
    <li><a href="#复制sentinelconf到sentinel-26380confsentinel-23681conf">复制sentinel.conf到sentinel-26380.conf，sentinel-23681.conf</a></li>
    <li><a href="#修改sentinelconf配置文件主要修改5处其他redis默认的一般不修改">修改sentinel.conf配置文件（主要修改5处，其他redis默认的一般不修改）</a></li>
    <li><a href="#启动redis哨兵服务">启动redis哨兵服务</a></li>
    <li><a href="#查看哨兵信息">查看哨兵信息</a></li>
    <li><a href="#测试哨兵模式">测试哨兵模式</a></li>
    <li><a href="#遇到的问题">遇到的问题</a>
      <ul>
        <li><a href="#启动sentinelconf报错">启动sentinel.conf报错</a></li>
        <li><a href="#主机杀死重连后master_link_statusdown">主机杀死重连后，master_link_status:down</a></li>
        <li><a href="#sentinel监视redismaster节点挂了不自动选举的问题next-failover-delay-i-will-not-start-a-failover-before-sat-mar-19-003923-2022">sentinel监视redis，master节点挂了不自动选举的问题，Next failover delay: I will not start a failover before Sat Mar 19 00:39:23 2022</a></li>
      </ul>
    </li>
  </ul>

  <ul>
    <li><a href="#1添加依赖">1.添加依赖</a></li>
    <li><a href="#2yml配置">2.yml配置</a></li>
    <li><a href="#4遇到的问题">4.遇到的问题</a>
      <ul>
        <li><a href="#41-启动项目显示unable-to-connect-to-81401396381">4.1 启动项目显示Unable to connect to 8.140.1.39:6381</a></li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</div>
    <div class="post-content">
      <h1 id="redis基础">Redis基础</h1>
<h2 id="redis的安装">Redis的安装：</h2>
<h3 id="安装redis">安装redis</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="c1">#下载redis的安装包并用Xftp上传到服务器，用tar命令解压安装包</span>
</span></span><span class="line"><span class="cl">1. tar -xzvf redis-6.0.6.tar.gz
</span></span><span class="line"><span class="cl"><span class="c1">#进入redis安装目录使用make命令</span>
</span></span><span class="line"><span class="cl">2. <span class="nb">cd</span> redis-6.0.6
</span></span><span class="line"><span class="cl">   make
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="安装过程中出现的问题">安装过程中出现的问题</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">1.#使用make命令发生错误，查明原因发现未安装gcc，使用以下命令
</span></span><span class="line"><span class="cl">yum install cpp
</span></span><span class="line"><span class="cl">yum install binutils
</span></span><span class="line"><span class="cl">yum install glibc
</span></span><span class="line"><span class="cl">yum install glibc-kernheaders
</span></span><span class="line"><span class="cl">yum install glibc-common
</span></span><span class="line"><span class="cl">yum install glibc-devel
</span></span><span class="line"><span class="cl">yum install gcc
</span></span><span class="line"><span class="cl">yum install make
</span></span><span class="line"><span class="cl">yum -y install gcc-c++
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">2.#再次使用make命令还是报错，查明原因发现gcc版本太低（只针对redis6.0版本及以上）
</span></span><span class="line"><span class="cl"><span class="c1">#redis6.0版本以上需要将gcc升级到5.3以上，而CentOS 7默认安装的gcc版本是4.8.5</span>
</span></span><span class="line"><span class="cl">gcc -v <span class="c1">#查看gcc版本号</span>
</span></span><span class="line"><span class="cl"><span class="c1">#升级gcc到 5.3及以上版本</span>
</span></span><span class="line"><span class="cl">yum -y install centos-release-scl
</span></span><span class="line"><span class="cl">yum -y install devtoolset-9-gcc devtoolset-9-gcc-c++ devtoolset-9-binutils
</span></span><span class="line"><span class="cl">scl <span class="nb">enable</span> devtoolset-9 bash
</span></span><span class="line"><span class="cl"><span class="c1">#再次使用make命令（可以先重新安装redis--&gt;先删除解压好的redis--&gt;用tar -xzvf 命令重新解压）</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">3.#redis启动出现三个警告
</span></span><span class="line"><span class="cl">第一个警告：The TCP backlog setting of <span class="m">511</span> cannot be enforced because /proc/sys/net/core/somaxconn is <span class="nb">set</span> to the lower value of 128.
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">第二个警告：overcommit_memory is <span class="nb">set</span> to 0! Background save may fail under low memory condition. To fix this issue add <span class="s1">&#39;vm.overcommit_memory = 1&#39;</span> to/etc/sysctl.conf and <span class="k">then</span> reboot or run the <span class="nb">command</span> <span class="s1">&#39;sysctl vm.overcommit_memory=1&#39;</span> <span class="k">for</span> this to take effect.
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">第三个警告：you have Transparent Huge Pages <span class="o">(</span>THP<span class="o">)</span> support enabled in your kernel. This will create latency and memory usage issues with Redis. To fix thisissue run the <span class="nb">command</span> <span class="s1">&#39;echo never &gt; /sys/kernel/mm/transparent_hugepage/enabled&#39;</span> as root, and add it to your /etc/rc.local in order to retain thesetting after a reboot. Redis must be restarted after THP is disabled.
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#解决方案</span>
</span></span><span class="line"><span class="cl">第一个警告
</span></span><span class="line"><span class="cl">将net.core.somaxconn <span class="o">=</span> 1024添加到/etc/sysctl.conf中，然后执行sysctl -p生效配置。
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">第二个警告
</span></span><span class="line"><span class="cl">将vm.overcommit_memory <span class="o">=</span> 1添加到/etc/sysctl.conf中，然后执行sysctl -p生效配置。
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">第三个警告
</span></span><span class="line"><span class="cl">将echo never &gt; /sys/kernel/mm/transparent_hugepage/enabled添加到/etc/rc.local中，然后执行source /etc/rc.local生效配置。
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">重新启动redis正常
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="redis中文乱码">Redis中文乱码：</h2>
<h3 id="解决方案启动时加上--raw">解决方案：启动时加上&ndash;raw</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">redis</span><span class="o">-</span><span class="n">cli</span> <span class="o">-</span><span class="n">p</span> <span class="n">6379</span> <span class="o">--</span><span class="n">raw</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="查看redis安装目录">查看Redis安装目录：</h2>
<h3 id="用whereis和which命令找不到安装目录可以使用以下方法">用whereis和which命令找不到安装目录可以使用以下方法：</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">第一步</span><span class="err">：</span><span class="n">ps</span> <span class="o">-</span><span class="n">ef</span><span class="o">|</span><span class="n">grep</span> <span class="n">redis</span>       <span class="n">得到进程号信息</span>
</span></span><span class="line"><span class="cl"><span class="n">第二步</span><span class="err">：</span><span class="n">ls</span> <span class="o">-</span><span class="n">l</span> <span class="o">/</span><span class="n">proc</span><span class="o">/</span><span class="n">进程号</span><span class="o">/</span><span class="n">cwd</span>   <span class="n">得到安装目录信息</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><img src="https://raw.githubusercontent.com/chengtry/my-picture/main/img/image-20210310095730403.png" alt=""></p>
<h2 id="查看redis版本号">查看Redis版本号：</h2>
<h3 id="1-redis-server---version">1. redis-server &ndash;version</h3>
<h3 id="2-redis-cli--v">2. redis-cli -v</h3>
<p><img src="https://raw.githubusercontent.com/chengtry/my-picture/main/img/image-20210310101418280.png" alt=""></p>
<h3 id="3-启动redis后用info命令">3. 启动redis后，用info命令</h3>
<p><img src="https://raw.githubusercontent.com/chengtry/my-picture/main/img/image-20210310101443498.png" alt=""></p>
<h2 id="redis启动停止重启设置密码进入">Redis启动、停止、重启、设置密码、进入</h2>
<h3 id="redis启动">Redis启动:</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">启动redis服务</span>
</span></span><span class="line"><span class="cl"><span class="n">redis</span><span class="o">-</span><span class="n">server</span> <span class="n">redis</span><span class="o">.</span><span class="na">conf</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="redis关闭">Redis关闭：</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">redis</span><span class="o">-</span><span class="n">cli</span> <span class="o">-</span><span class="n">h</span> <span class="n">127</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">1</span> <span class="o">-</span><span class="n">p</span> <span class="n">6379</span> <span class="n">shutdown</span>
</span></span><span class="line"><span class="cl"><span class="n">redis</span><span class="o">-</span><span class="n">cli</span> <span class="n">shutdown</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="redis重启">Redis重启：</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">使用关闭</span><span class="o">+</span><span class="n">启动组合命令</span><span class="err">：</span><span class="n">redis</span><span class="o">-</span><span class="n">cli</span> <span class="n">shutdown</span> <span class="err">、</span> <span class="n">redis</span><span class="o">-</span><span class="n">server</span> <span class="n">redis</span><span class="o">.</span><span class="na">conf</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="redis设置密码">Redis设置密码：</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">1</span><span class="o">.</span> <span class="n">修改配置文件</span><span class="err">，</span><span class="n">永久生效</span><span class="o">(</span><span class="n">修改后需要重启redis才能生效</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">进入redis</span><span class="o">.</span><span class="na">conf配置文件</span><span class="err">，</span><span class="n">添加</span> <span class="n">requirepass</span> <span class="nf">redis123</span> <span class="o">(</span><span class="n">密码</span><span class="err">：</span><span class="n">redis123</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">2</span><span class="o">.</span> <span class="nf">临时添加密码</span><span class="o">(</span><span class="n">重启redis密码失效</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">config</span> <span class="n">set</span> <span class="n">requirepass</span> <span class="n">redis123</span> 
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="redis进入">Redis进入</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">使用密码进入并解决中文乱码</span> 
</span></span><span class="line"><span class="cl"><span class="n">redis</span><span class="o">-</span><span class="n">cli</span> <span class="o">-</span><span class="n">a</span> <span class="n">redis123</span> <span class="o">--</span><span class="n">raw</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="为什么-redis-是单线程还这么快">为什么 Redis 是单线程还这么快？</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">Redis 所有的数据都是存放在内存中的，单线程的操作没有上下文的切换，从而达到很高的效率。
</span></span></code></pre></td></tr></table>
</div>
</div><h1 id="五种基本类型">五种基本类型</h1>
<h2 id="string类型">String类型</h2>
<h3 id="常见命令">常见命令：</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">exists key：判断键是否存在
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">del key：删除键值对
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">move key db：将键值对移动到指定数据库
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">expire key second：设置键值对的过期时间
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">type</span> key：查看value的数据类型
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="ttl命令">TTL命令：</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">Redis的key，通过TTL命令返回key的过期时间，一般来说有3种：
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">1.当前key没有设置过期时间，所以会返回-1.
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">2.当前key有设置过期时间，而且key已经过期，所以会返回-2.
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">3.当前key有设置过期时间，且key还没有过期，故会返回key的正常剩余时间.
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="设置和取消过期时间">设置和取消过期时间</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="c1">#设置 name 的过期时间为6000秒</span>
</span></span><span class="line"><span class="cl">expire name <span class="m">6000</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#取消 name 的过期时间</span>
</span></span><span class="line"><span class="cl">persist name
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#查看 name 过期时间</span>
</span></span><span class="line"><span class="cl">ttl name
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="rename-和-renamex-命令">rename 和 renamex 命令：</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="sb">`</span>RENAME key newkey<span class="sb">`</span> 修改 key 的名称
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="sb">`</span>RENAMENX key newkey<span class="sb">`</span> 仅当 newkey 不存在时，将 key 改名为 newkey 
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="命令代码">命令代码：</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">127</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">1</span><span class="o">:</span><span class="n">6379</span><span class="o">&gt;</span> <span class="n">keys</span> <span class="o">*</span> <span class="err">#</span> <span class="n">查看当前数据库所有key</span>
</span></span><span class="line"><span class="cl"><span class="o">(</span><span class="n">empty</span> <span class="n">list</span> <span class="n">or</span> <span class="n">set</span><span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="n">127</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">1</span><span class="o">:</span><span class="n">6379</span><span class="o">&gt;</span> <span class="n">set</span> <span class="n">name</span> <span class="n">qinjiang</span> <span class="err">#</span> <span class="n">set</span> <span class="n">key</span>
</span></span><span class="line"><span class="cl"><span class="n">OK</span>
</span></span><span class="line"><span class="cl"><span class="n">127</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">1</span><span class="o">:</span><span class="n">6379</span><span class="o">&gt;</span> <span class="n">set</span> <span class="n">age</span> <span class="n">20</span>
</span></span><span class="line"><span class="cl"><span class="n">OK</span>
</span></span><span class="line"><span class="cl"><span class="n">127</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">1</span><span class="o">:</span><span class="n">6379</span><span class="o">&gt;</span> <span class="n">keys</span> <span class="o">*</span>
</span></span><span class="line"><span class="cl"><span class="n">1</span><span class="o">)</span> <span class="s">&#34;age&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">2</span><span class="o">)</span> <span class="s">&#34;name&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">127</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">1</span><span class="o">:</span><span class="n">6379</span><span class="o">&gt;</span> <span class="n">move</span> <span class="n">age</span> <span class="n">1</span> <span class="err">#</span> <span class="n">将键值对移动到指定数据库</span>
</span></span><span class="line"><span class="cl"><span class="o">(</span><span class="n">integer</span><span class="o">)</span> <span class="n">1</span>
</span></span><span class="line"><span class="cl"><span class="n">127</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">1</span><span class="o">:</span><span class="n">6379</span><span class="o">&gt;</span> <span class="n">EXISTS</span> <span class="n">age</span> <span class="err">#</span> <span class="n">判断键是否存在</span>
</span></span><span class="line"><span class="cl"><span class="o">(</span><span class="n">integer</span><span class="o">)</span> <span class="n">0</span> <span class="err">#</span> <span class="n">不存在</span>
</span></span><span class="line"><span class="cl"><span class="n">127</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">1</span><span class="o">:</span><span class="n">6379</span><span class="o">&gt;</span> <span class="n">EXISTS</span> <span class="nf">name</span>
</span></span><span class="line"><span class="cl"><span class="o">(</span><span class="n">integer</span><span class="o">)</span> <span class="n">1</span> <span class="err">#</span> <span class="n">存在</span>
</span></span><span class="line"><span class="cl"><span class="n">127</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">1</span><span class="o">:</span><span class="n">6379</span><span class="o">&gt;</span> <span class="n">SELECT</span> <span class="n">1</span>
</span></span><span class="line"><span class="cl"><span class="n">OK</span>
</span></span><span class="line"><span class="cl"><span class="n">127</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">1</span><span class="o">:</span><span class="n">6379</span><span class="o">[</span><span class="n">1</span><span class="o">]&gt;</span> <span class="n">keys</span> <span class="o">*</span>
</span></span><span class="line"><span class="cl"><span class="n">1</span><span class="o">)</span> <span class="s">&#34;age&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">127</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">1</span><span class="o">:</span><span class="n">6379</span><span class="o">[</span><span class="n">1</span><span class="o">]&gt;</span> <span class="n">del</span> <span class="n">age</span> <span class="err">#</span> <span class="n">删除键值对</span>
</span></span><span class="line"><span class="cl"><span class="o">(</span><span class="n">integer</span><span class="o">)</span> <span class="n">1</span> <span class="err">#</span> <span class="n">删除个数</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">127</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">1</span><span class="o">:</span><span class="n">6379</span><span class="o">&gt;</span> <span class="n">set</span> <span class="n">age</span> <span class="n">20</span>
</span></span><span class="line"><span class="cl"><span class="n">OK</span>
</span></span><span class="line"><span class="cl"><span class="n">127</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">1</span><span class="o">:</span><span class="n">6379</span><span class="o">&gt;</span> <span class="n">EXPIRE</span> <span class="n">age</span> <span class="n">15</span> <span class="err">#</span> <span class="n">设置键值对的过期时间</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">(</span><span class="n">integer</span><span class="o">)</span> <span class="n">1</span> <span class="err">#</span> <span class="n">设置成功</span> <span class="n">开始计数</span>
</span></span><span class="line"><span class="cl"><span class="n">127</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">1</span><span class="o">:</span><span class="n">6379</span><span class="o">&gt;</span> <span class="n">ttl</span> <span class="n">age</span> <span class="err">#</span> <span class="n">查看key的过期剩余时间</span>
</span></span><span class="line"><span class="cl"><span class="o">(</span><span class="n">integer</span><span class="o">)</span> <span class="n">13</span>
</span></span><span class="line"><span class="cl"><span class="n">127</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">1</span><span class="o">:</span><span class="n">6379</span><span class="o">&gt;</span> <span class="n">ttl</span> <span class="nf">age</span>
</span></span><span class="line"><span class="cl"><span class="o">(</span><span class="n">integer</span><span class="o">)</span> <span class="n">11</span>
</span></span><span class="line"><span class="cl"><span class="n">127</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">1</span><span class="o">:</span><span class="n">6379</span><span class="o">&gt;</span> <span class="n">ttl</span> <span class="nf">age</span>
</span></span><span class="line"><span class="cl"><span class="o">(</span><span class="n">integer</span><span class="o">)</span> <span class="n">9</span>
</span></span><span class="line"><span class="cl"><span class="n">127</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">1</span><span class="o">:</span><span class="n">6379</span><span class="o">&gt;</span> <span class="n">ttl</span> <span class="nf">age</span>
</span></span><span class="line"><span class="cl"><span class="o">(</span><span class="n">integer</span><span class="o">)</span> <span class="o">-</span><span class="n">2</span> <span class="err">#</span> <span class="o">-</span><span class="n">2</span> <span class="n">表示key过期</span><span class="err">，</span><span class="o">-</span><span class="n">1表示key未设置过期时间</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">127</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">1</span><span class="o">:</span><span class="n">6379</span><span class="o">&gt;</span> <span class="n">get</span> <span class="n">age</span> <span class="err">#</span> <span class="n">过期的key</span> <span class="nf">会被自动delete</span>
</span></span><span class="line"><span class="cl"><span class="o">(</span><span class="n">nil</span><span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="n">127</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">1</span><span class="o">:</span><span class="n">6379</span><span class="o">&gt;</span> <span class="n">keys</span> <span class="o">*</span>
</span></span><span class="line"><span class="cl"><span class="n">1</span><span class="o">)</span> <span class="s">&#34;name&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">127</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">1</span><span class="o">:</span><span class="n">6379</span><span class="o">&gt;</span> <span class="n">type</span> <span class="n">name</span> <span class="err">#</span> <span class="n">查看value的数据类型</span>
</span></span><span class="line"><span class="cl"><span class="n">string</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="list类型">List类型</h2>
<h3 id="命令代码-1">命令代码：</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="o">---------------------------</span><span class="n">LPUSH</span><span class="o">---</span><span class="n">RPUSH</span><span class="o">---</span><span class="n">LRANGE</span><span class="o">--------------------------------</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">127</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">1</span><span class="o">:</span><span class="n">6379</span><span class="o">&gt;</span> <span class="n">LPUSH</span> <span class="n">mylist</span> <span class="n">k1</span> <span class="err">#</span> <span class="n">LPUSH</span> <span class="n">mylist</span><span class="o">=&gt;{</span><span class="n">1</span><span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">(</span><span class="n">integer</span><span class="o">)</span> <span class="n">1</span>
</span></span><span class="line"><span class="cl"><span class="n">127</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">1</span><span class="o">:</span><span class="n">6379</span><span class="o">&gt;</span> <span class="n">LPUSH</span> <span class="n">mylist</span> <span class="n">k2</span> <span class="err">#</span> <span class="n">LPUSH</span> <span class="n">mylist</span><span class="o">=&gt;{</span><span class="n">2</span><span class="o">,</span><span class="n">1</span><span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">(</span><span class="n">integer</span><span class="o">)</span> <span class="n">2</span>
</span></span><span class="line"><span class="cl"><span class="n">127</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">1</span><span class="o">:</span><span class="n">6379</span><span class="o">&gt;</span> <span class="n">RPUSH</span> <span class="n">mylist</span> <span class="n">k3</span> <span class="err">#</span> <span class="n">RPUSH</span> <span class="n">mylist</span><span class="o">=&gt;{</span><span class="n">2</span><span class="o">,</span><span class="n">1</span><span class="o">,</span><span class="n">3</span><span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">(</span><span class="n">integer</span><span class="o">)</span> <span class="n">3</span>
</span></span><span class="line"><span class="cl"><span class="n">127</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">1</span><span class="o">:</span><span class="n">6379</span><span class="o">&gt;</span> <span class="n">get</span> <span class="n">mylist</span> <span class="err">#</span> <span class="n">普通的get是无法获取list值的</span>
</span></span><span class="line"><span class="cl"><span class="o">(</span><span class="n">error</span><span class="o">)</span> <span class="n">WRONGTYPE</span> <span class="n">Operation</span> <span class="n">against</span> <span class="n">a</span> <span class="n">key</span> <span class="n">holding</span> <span class="n">the</span> <span class="n">wrong</span> <span class="n">kind</span> <span class="n">of</span> <span class="n">value</span>
</span></span><span class="line"><span class="cl"><span class="n">127</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">1</span><span class="o">:</span><span class="n">6379</span><span class="o">&gt;</span> <span class="n">LRANGE</span> <span class="n">mylist</span> <span class="n">0</span> <span class="n">4</span> <span class="err">#</span> <span class="n">LRANGE</span> <span class="n">获取起止位置范围内的元素</span>
</span></span><span class="line"><span class="cl"><span class="n">1</span><span class="o">)</span> <span class="s">&#34;k2&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">2</span><span class="o">)</span> <span class="s">&#34;k1&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">3</span><span class="o">)</span> <span class="s">&#34;k3&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">127</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">1</span><span class="o">:</span><span class="n">6379</span><span class="o">&gt;</span> <span class="n">LRANGE</span> <span class="n">mylist</span> <span class="n">0</span> <span class="n">2</span>
</span></span><span class="line"><span class="cl"><span class="n">1</span><span class="o">)</span> <span class="s">&#34;k2&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">2</span><span class="o">)</span> <span class="s">&#34;k1&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">3</span><span class="o">)</span> <span class="s">&#34;k3&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">127</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">1</span><span class="o">:</span><span class="n">6379</span><span class="o">&gt;</span> <span class="n">LRANGE</span> <span class="n">mylist</span> <span class="n">0</span> <span class="n">1</span>
</span></span><span class="line"><span class="cl"><span class="n">1</span><span class="o">)</span> <span class="s">&#34;k2&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">2</span><span class="o">)</span> <span class="s">&#34;k1&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">127</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">1</span><span class="o">:</span><span class="n">6379</span><span class="o">&gt;</span> <span class="n">LRANGE</span> <span class="n">mylist</span> <span class="n">0</span> <span class="o">-</span><span class="n">1</span> <span class="err">#</span> <span class="n">获取全部元素</span>
</span></span><span class="line"><span class="cl"><span class="n">1</span><span class="o">)</span> <span class="s">&#34;k2&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">2</span><span class="o">)</span> <span class="s">&#34;k1&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">3</span><span class="o">)</span> <span class="s">&#34;k3&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">---------------------------</span><span class="n">LPUSHX</span><span class="o">---</span><span class="n">RPUSHX</span><span class="o">-----------------------------------</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">127</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">1</span><span class="o">:</span><span class="n">6379</span><span class="o">&gt;</span> <span class="n">LPUSHX</span> <span class="n">list</span> <span class="n">v1</span> <span class="err">#</span> <span class="n">list不存在</span> <span class="nf">LPUSHX失败</span>
</span></span><span class="line"><span class="cl"><span class="o">(</span><span class="n">integer</span><span class="o">)</span> <span class="n">0</span>
</span></span><span class="line"><span class="cl"><span class="n">127</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">1</span><span class="o">:</span><span class="n">6379</span><span class="o">&gt;</span> <span class="n">LPUSHX</span> <span class="n">list</span> <span class="n">v1</span> <span class="nf">v2</span>  
</span></span><span class="line"><span class="cl"><span class="o">(</span><span class="n">integer</span><span class="o">)</span> <span class="n">0</span>
</span></span><span class="line"><span class="cl"><span class="n">127</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">1</span><span class="o">:</span><span class="n">6379</span><span class="o">&gt;</span> <span class="n">LPUSHX</span> <span class="n">mylist</span> <span class="n">k4</span> <span class="n">k5</span> <span class="err">#</span> <span class="n">向mylist中</span> <span class="n">左边</span> <span class="n">PUSH</span> <span class="n">k4</span> <span class="nf">k5</span>
</span></span><span class="line"><span class="cl"><span class="o">(</span><span class="n">integer</span><span class="o">)</span> <span class="n">5</span>
</span></span><span class="line"><span class="cl"><span class="n">127</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">1</span><span class="o">:</span><span class="n">6379</span><span class="o">&gt;</span> <span class="n">LRANGE</span> <span class="n">mylist</span> <span class="n">0</span> <span class="o">-</span><span class="n">1</span>
</span></span><span class="line"><span class="cl"><span class="n">1</span><span class="o">)</span> <span class="s">&#34;k5&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">2</span><span class="o">)</span> <span class="s">&#34;k4&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">3</span><span class="o">)</span> <span class="s">&#34;k2&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">4</span><span class="o">)</span> <span class="s">&#34;k1&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">5</span><span class="o">)</span> <span class="s">&#34;k3&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">---------------------------</span><span class="n">LINSERT</span><span class="o">--</span><span class="n">LLEN</span><span class="o">--</span><span class="n">LINDEX</span><span class="o">--</span><span class="n">LSET</span><span class="o">----------------------------</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">127</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">1</span><span class="o">:</span><span class="n">6379</span><span class="o">&gt;</span> <span class="n">LINSERT</span> <span class="n">mylist</span> <span class="n">after</span> <span class="n">k2</span> <span class="n">ins_key1</span> <span class="err">#</span> <span class="n">在k2元素后</span> <span class="nf">插入ins_key1</span>
</span></span><span class="line"><span class="cl"><span class="o">(</span><span class="n">integer</span><span class="o">)</span> <span class="n">6</span>
</span></span><span class="line"><span class="cl"><span class="n">127</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">1</span><span class="o">:</span><span class="n">6379</span><span class="o">&gt;</span> <span class="n">LRANGE</span> <span class="n">mylist</span> <span class="n">0</span> <span class="o">-</span><span class="n">1</span>
</span></span><span class="line"><span class="cl"><span class="n">1</span><span class="o">)</span> <span class="s">&#34;k5&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">2</span><span class="o">)</span> <span class="s">&#34;k4&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">3</span><span class="o">)</span> <span class="s">&#34;k2&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">4</span><span class="o">)</span> <span class="s">&#34;ins_key1&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">5</span><span class="o">)</span> <span class="s">&#34;k1&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">6</span><span class="o">)</span> <span class="s">&#34;k3&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">127</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">1</span><span class="o">:</span><span class="n">6379</span><span class="o">&gt;</span> <span class="n">LLEN</span> <span class="n">mylist</span> <span class="err">#</span> <span class="n">查看mylist的长度</span>
</span></span><span class="line"><span class="cl"><span class="o">(</span><span class="n">integer</span><span class="o">)</span> <span class="n">6</span>
</span></span><span class="line"><span class="cl"><span class="n">127</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">1</span><span class="o">:</span><span class="n">6379</span><span class="o">&gt;</span> <span class="n">LINDEX</span> <span class="n">mylist</span> <span class="n">3</span> <span class="err">#</span> <span class="n">获取下标为3的元素</span>
</span></span><span class="line"><span class="cl"><span class="s">&#34;ins_key1&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">127</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">1</span><span class="o">:</span><span class="n">6379</span><span class="o">&gt;</span> <span class="n">LINDEX</span> <span class="n">mylist</span> <span class="n">0</span>
</span></span><span class="line"><span class="cl"><span class="s">&#34;k5&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">127</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">1</span><span class="o">:</span><span class="n">6379</span><span class="o">&gt;</span> <span class="n">LSET</span> <span class="n">mylist</span> <span class="n">3</span> <span class="n">k6</span> <span class="err">#</span> <span class="n">将下标3的元素</span> <span class="n">set值为k6</span>
</span></span><span class="line"><span class="cl"><span class="n">OK</span>
</span></span><span class="line"><span class="cl"><span class="n">127</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">1</span><span class="o">:</span><span class="n">6379</span><span class="o">&gt;</span> <span class="n">LRANGE</span> <span class="n">mylist</span> <span class="n">0</span> <span class="o">-</span><span class="n">1</span>
</span></span><span class="line"><span class="cl"><span class="n">1</span><span class="o">)</span> <span class="s">&#34;k5&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">2</span><span class="o">)</span> <span class="s">&#34;k4&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">3</span><span class="o">)</span> <span class="s">&#34;k2&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">4</span><span class="o">)</span> <span class="s">&#34;k6&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">5</span><span class="o">)</span> <span class="s">&#34;k1&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">6</span><span class="o">)</span> <span class="s">&#34;k3&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">---------------------------</span><span class="n">LPOP</span><span class="o">--</span><span class="n">RPOP</span><span class="o">--------------------------</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">127</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">1</span><span class="o">:</span><span class="n">6379</span><span class="o">&gt;</span> <span class="n">LPOP</span> <span class="n">mylist</span> <span class="err">#</span> <span class="n">左侧</span><span class="o">(</span><span class="n">头部</span><span class="o">)</span><span class="n">弹出</span>
</span></span><span class="line"><span class="cl"><span class="s">&#34;k5&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">127</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">1</span><span class="o">:</span><span class="n">6379</span><span class="o">&gt;</span> <span class="n">RPOP</span> <span class="n">mylist</span> <span class="err">#</span> <span class="n">右侧</span><span class="o">(</span><span class="n">尾部</span><span class="o">)</span><span class="n">弹出</span>
</span></span><span class="line"><span class="cl"><span class="s">&#34;k3&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">---------------------------</span><span class="n">RPOPLPUSH</span><span class="o">--------------------------</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">127</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">1</span><span class="o">:</span><span class="n">6379</span><span class="o">&gt;</span> <span class="n">LRANGE</span> <span class="n">mylist</span> <span class="n">0</span> <span class="o">-</span><span class="n">1</span>
</span></span><span class="line"><span class="cl"><span class="n">1</span><span class="o">)</span> <span class="s">&#34;k4&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">2</span><span class="o">)</span> <span class="s">&#34;k2&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">3</span><span class="o">)</span> <span class="s">&#34;k6&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">4</span><span class="o">)</span> <span class="s">&#34;k1&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">127</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">1</span><span class="o">:</span><span class="n">6379</span><span class="o">&gt;</span> <span class="n">RPOPLPUSH</span> <span class="n">mylist</span> <span class="n">newlist</span> <span class="err">#</span> <span class="n">将mylist的最后一个值</span><span class="o">(</span><span class="n">k1</span><span class="o">)</span><span class="n">弹出</span><span class="err">，</span><span class="n">加入到newlist的头部</span>
</span></span><span class="line"><span class="cl"><span class="s">&#34;k1&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">127</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">1</span><span class="o">:</span><span class="n">6379</span><span class="o">&gt;</span> <span class="n">LRANGE</span> <span class="n">newlist</span> <span class="n">0</span> <span class="o">-</span><span class="n">1</span>
</span></span><span class="line"><span class="cl"><span class="n">1</span><span class="o">)</span> <span class="s">&#34;k1&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">127</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">1</span><span class="o">:</span><span class="n">6379</span><span class="o">&gt;</span> <span class="n">LRANGE</span> <span class="n">mylist</span> <span class="n">0</span> <span class="o">-</span><span class="n">1</span>
</span></span><span class="line"><span class="cl"><span class="n">1</span><span class="o">)</span> <span class="s">&#34;k4&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">2</span><span class="o">)</span> <span class="s">&#34;k2&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">3</span><span class="o">)</span> <span class="s">&#34;k6&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">---------------------------</span><span class="n">LTRIM</span><span class="o">--------------------------</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">127</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">1</span><span class="o">:</span><span class="n">6379</span><span class="o">&gt;</span> <span class="n">LTRIM</span> <span class="n">mylist</span> <span class="n">0</span> <span class="n">1</span> <span class="err">#</span> <span class="n">截取mylist中的</span> <span class="n">0</span><span class="o">~</span><span class="n">1部分</span>
</span></span><span class="line"><span class="cl"><span class="n">OK</span>
</span></span><span class="line"><span class="cl"><span class="n">127</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">1</span><span class="o">:</span><span class="n">6379</span><span class="o">&gt;</span> <span class="n">LRANGE</span> <span class="n">mylist</span> <span class="n">0</span> <span class="o">-</span><span class="n">1</span>
</span></span><span class="line"><span class="cl"><span class="n">1</span><span class="o">)</span> <span class="s">&#34;k4&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">2</span><span class="o">)</span> <span class="s">&#34;k2&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="err">#</span> <span class="n">初始</span> <span class="n">mylist</span><span class="o">:</span> <span class="n">k2</span><span class="o">,</span><span class="n">k2</span><span class="o">,</span><span class="n">k2</span><span class="o">,</span><span class="n">k2</span><span class="o">,</span><span class="n">k2</span><span class="o">,</span><span class="n">k2</span><span class="o">,</span><span class="n">k4</span><span class="o">,</span><span class="n">k2</span><span class="o">,</span><span class="n">k2</span><span class="o">,</span><span class="n">k2</span><span class="o">,</span><span class="n">k2</span>
</span></span><span class="line"><span class="cl"><span class="o">---------------------------</span><span class="n">LREM</span><span class="o">--------------------------</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">127</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">1</span><span class="o">:</span><span class="n">6379</span><span class="o">&gt;</span> <span class="n">LREM</span> <span class="n">mylist</span> <span class="n">3</span> <span class="n">k2</span> <span class="err">#</span> <span class="n">从头部开始搜索</span> <span class="n">至多删除3个</span> <span class="nf">k2</span>
</span></span><span class="line"><span class="cl"><span class="o">(</span><span class="n">integer</span><span class="o">)</span> <span class="n">3</span>
</span></span><span class="line"><span class="cl"><span class="err">#</span> <span class="n">删除后</span><span class="err">：</span><span class="n">mylist</span><span class="o">:</span> <span class="n">k2</span><span class="o">,</span><span class="n">k2</span><span class="o">,</span><span class="n">k2</span><span class="o">,</span><span class="n">k4</span><span class="o">,</span><span class="n">k2</span><span class="o">,</span><span class="n">k2</span><span class="o">,</span><span class="n">k2</span><span class="o">,</span><span class="n">k2</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">127</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">1</span><span class="o">:</span><span class="n">6379</span><span class="o">&gt;</span> <span class="n">LREM</span> <span class="n">mylist</span> <span class="o">-</span><span class="n">2</span> <span class="n">k2</span> <span class="err">#</span><span class="n">从尾部开始搜索</span> <span class="n">至多删除2个</span> <span class="nf">k2</span>
</span></span><span class="line"><span class="cl"><span class="o">(</span><span class="n">integer</span><span class="o">)</span> <span class="n">2</span>
</span></span><span class="line"><span class="cl"><span class="err">#</span> <span class="n">删除后</span><span class="err">：</span><span class="n">mylist</span><span class="o">:</span> <span class="n">k2</span><span class="o">,</span><span class="n">k2</span><span class="o">,</span><span class="n">k2</span><span class="o">,</span><span class="n">k4</span><span class="o">,</span><span class="n">k2</span><span class="o">,</span><span class="n">k2</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">---------------------------</span><span class="n">BLPOP</span><span class="o">--</span><span class="n">BRPOP</span><span class="o">--------------------------</span>
</span></span><span class="line"><span class="cl"><span class="nl">
</span></span></span><span class="line"><span class="cl"><span class="nl">mylist:</span> <span class="n">k2</span><span class="o">,</span><span class="n">k2</span><span class="o">,</span><span class="n">k2</span><span class="o">,</span><span class="n">k4</span><span class="o">,</span><span class="n">k2</span><span class="o">,</span><span class="n">k2</span>
</span></span><span class="line"><span class="cl"><span class="nl">newlist:</span> <span class="n">k1</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">127</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">1</span><span class="o">:</span><span class="n">6379</span><span class="o">&gt;</span> <span class="n">BLPOP</span> <span class="n">newlist</span> <span class="n">mylist</span> <span class="n">30</span> <span class="err">#</span> <span class="n">从newlist中弹出第一个值</span><span class="err">，</span><span class="n">mylist作为候选</span>
</span></span><span class="line"><span class="cl"><span class="n">1</span><span class="o">)</span> <span class="s">&#34;newlist&#34;</span> <span class="err">#</span> <span class="n">弹出</span>
</span></span><span class="line"><span class="cl"><span class="n">2</span><span class="o">)</span> <span class="s">&#34;k1&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">127</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">1</span><span class="o">:</span><span class="n">6379</span><span class="o">&gt;</span> <span class="n">BLPOP</span> <span class="n">newlist</span> <span class="n">mylist</span> <span class="n">30</span>
</span></span><span class="line"><span class="cl"><span class="n">1</span><span class="o">)</span> <span class="s">&#34;mylist&#34;</span> <span class="err">#</span> <span class="n">由于newlist空了</span> <span class="n">从mylist中弹出</span>
</span></span><span class="line"><span class="cl"><span class="n">2</span><span class="o">)</span> <span class="s">&#34;k2&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">127</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">1</span><span class="o">:</span><span class="n">6379</span><span class="o">&gt;</span> <span class="n">BLPOP</span> <span class="n">newlist</span> <span class="nf">30</span>
</span></span><span class="line"><span class="cl"><span class="o">(</span><span class="n">30</span><span class="o">.</span><span class="na">10s</span><span class="o">)</span> <span class="err">#</span> <span class="n">超时了</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">127</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">1</span><span class="o">:</span><span class="n">6379</span><span class="o">&gt;</span> <span class="n">BLPOP</span> <span class="n">newlist</span> <span class="n">30</span> <span class="err">#</span> <span class="n">我们连接另一个客户端向newlist中push了test</span><span class="o">,</span> <span class="n">阻塞被解决</span><span class="err">。</span>
</span></span><span class="line"><span class="cl"><span class="n">1</span><span class="o">)</span> <span class="s">&#34;newlist&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">2</span><span class="o">)</span> <span class="s">&#34;test&#34;</span>
</span></span><span class="line"><span class="cl"><span class="o">(</span><span class="n">12</span><span class="o">.</span><span class="na">54s</span><span class="o">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="set类型">Set类型</h2>
<h3 id="命令代码-2">命令代码：</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span><span class="lnt">79
</span><span class="lnt">80
</span><span class="lnt">81
</span><span class="lnt">82
</span><span class="lnt">83
</span><span class="lnt">84
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="o">---------------</span><span class="n">SADD</span><span class="o">--</span><span class="n">SCARD</span><span class="o">--</span><span class="n">SMEMBERS</span><span class="o">--</span><span class="n">SISMEMBER</span><span class="o">--------------------</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">127</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">1</span><span class="o">:</span><span class="n">6379</span><span class="o">&gt;</span> <span class="n">SADD</span> <span class="n">myset</span> <span class="n">m1</span> <span class="n">m2</span> <span class="n">m3</span> <span class="n">m4</span> <span class="err">#</span> <span class="n">向myset中增加成员</span> <span class="n">m1</span><span class="o">~</span><span class="n">m4</span>
</span></span><span class="line"><span class="cl"><span class="o">(</span><span class="n">integer</span><span class="o">)</span> <span class="n">4</span>
</span></span><span class="line"><span class="cl"><span class="n">127</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">1</span><span class="o">:</span><span class="n">6379</span><span class="o">&gt;</span> <span class="n">SCARD</span> <span class="n">myset</span> <span class="err">#</span> <span class="n">获取集合的成员数目</span>
</span></span><span class="line"><span class="cl"><span class="o">(</span><span class="n">integer</span><span class="o">)</span> <span class="n">4</span>
</span></span><span class="line"><span class="cl"><span class="n">127</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">1</span><span class="o">:</span><span class="n">6379</span><span class="o">&gt;</span> <span class="n">smembers</span> <span class="n">myset</span> <span class="err">#</span> <span class="n">获取集合中所有成员</span>
</span></span><span class="line"><span class="cl"><span class="n">1</span><span class="o">)</span> <span class="s">&#34;m4&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">2</span><span class="o">)</span> <span class="s">&#34;m3&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">3</span><span class="o">)</span> <span class="s">&#34;m2&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">4</span><span class="o">)</span> <span class="s">&#34;m1&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">127</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">1</span><span class="o">:</span><span class="n">6379</span><span class="o">&gt;</span> <span class="n">SISMEMBER</span> <span class="n">myset</span> <span class="n">m5</span> <span class="err">#</span> <span class="n">查询m5是否是myset的成员</span>
</span></span><span class="line"><span class="cl"><span class="o">(</span><span class="n">integer</span><span class="o">)</span> <span class="n">0</span> <span class="err">#</span> <span class="n">不是</span><span class="err">，</span><span class="n">返回0</span>
</span></span><span class="line"><span class="cl"><span class="n">127</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">1</span><span class="o">:</span><span class="n">6379</span><span class="o">&gt;</span> <span class="n">SISMEMBER</span> <span class="n">myset</span> <span class="nf">m2</span>
</span></span><span class="line"><span class="cl"><span class="o">(</span><span class="n">integer</span><span class="o">)</span> <span class="n">1</span> <span class="err">#</span> <span class="n">是</span><span class="err">，</span><span class="n">返回1</span>
</span></span><span class="line"><span class="cl"><span class="n">127</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">1</span><span class="o">:</span><span class="n">6379</span><span class="o">&gt;</span> <span class="n">SISMEMBER</span> <span class="n">myset</span> <span class="nf">m3</span>
</span></span><span class="line"><span class="cl"><span class="o">(</span><span class="n">integer</span><span class="o">)</span> <span class="n">1</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">---------------------</span><span class="n">SRANDMEMBER</span><span class="o">--</span><span class="n">SPOP</span><span class="o">----------------------------------</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">127</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">1</span><span class="o">:</span><span class="n">6379</span><span class="o">&gt;</span> <span class="n">SRANDMEMBER</span> <span class="n">myset</span> <span class="n">3</span> <span class="err">#</span> <span class="n">随机返回3个成员</span>
</span></span><span class="line"><span class="cl"><span class="n">1</span><span class="o">)</span> <span class="s">&#34;m2&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">2</span><span class="o">)</span> <span class="s">&#34;m3&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">3</span><span class="o">)</span> <span class="s">&#34;m4&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">127</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">1</span><span class="o">:</span><span class="n">6379</span><span class="o">&gt;</span> <span class="n">SRANDMEMBER</span> <span class="n">myset</span> <span class="err">#</span> <span class="n">随机返回1个成员</span>
</span></span><span class="line"><span class="cl"><span class="s">&#34;m3&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">127</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">1</span><span class="o">:</span><span class="n">6379</span><span class="o">&gt;</span> <span class="n">SPOP</span> <span class="n">myset</span> <span class="n">2</span> <span class="err">#</span> <span class="n">随机移除并返回2个成员</span>
</span></span><span class="line"><span class="cl"><span class="n">1</span><span class="o">)</span> <span class="s">&#34;m1&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">2</span><span class="o">)</span> <span class="s">&#34;m4&#34;</span>
</span></span><span class="line"><span class="cl"><span class="err">#</span> <span class="n">将set还原到</span><span class="o">{</span><span class="n">m1</span><span class="o">,</span><span class="n">m2</span><span class="o">,</span><span class="n">m3</span><span class="o">,</span><span class="n">m4</span><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">---------------------</span><span class="n">SMOVE</span><span class="o">--</span><span class="n">SREM</span><span class="o">----------------------------------------</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">127</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">1</span><span class="o">:</span><span class="n">6379</span><span class="o">&gt;</span> <span class="n">SMOVE</span> <span class="n">myset</span> <span class="n">newset</span> <span class="n">m3</span> <span class="err">#</span> <span class="n">将myset中m3成员移动到newset集合</span>
</span></span><span class="line"><span class="cl"><span class="o">(</span><span class="n">integer</span><span class="o">)</span> <span class="n">1</span>
</span></span><span class="line"><span class="cl"><span class="n">127</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">1</span><span class="o">:</span><span class="n">6379</span><span class="o">&gt;</span> <span class="n">SMEMBERS</span> <span class="n">myset</span>
</span></span><span class="line"><span class="cl"><span class="n">1</span><span class="o">)</span> <span class="s">&#34;m4&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">2</span><span class="o">)</span> <span class="s">&#34;m2&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">3</span><span class="o">)</span> <span class="s">&#34;m1&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">127</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">1</span><span class="o">:</span><span class="n">6379</span><span class="o">&gt;</span> <span class="n">SMEMBERS</span> <span class="n">newset</span>
</span></span><span class="line"><span class="cl"><span class="n">1</span><span class="o">)</span> <span class="s">&#34;m3&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">127</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">1</span><span class="o">:</span><span class="n">6379</span><span class="o">&gt;</span> <span class="n">SREM</span> <span class="n">newset</span> <span class="n">m3</span> <span class="err">#</span> <span class="n">从newset中移除m3元素</span>
</span></span><span class="line"><span class="cl"><span class="o">(</span><span class="n">integer</span><span class="o">)</span> <span class="n">1</span>
</span></span><span class="line"><span class="cl"><span class="n">127</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">1</span><span class="o">:</span><span class="n">6379</span><span class="o">&gt;</span> <span class="n">SMEMBERS</span> <span class="nf">newset</span>
</span></span><span class="line"><span class="cl"><span class="o">(</span><span class="n">empty</span> <span class="n">list</span> <span class="n">or</span> <span class="n">set</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="err">#</span> <span class="n">下面开始是多集合操作</span><span class="o">,</span><span class="n">多集合操作中若只有一个参数默认和自身进行运算</span>
</span></span><span class="line"><span class="cl"><span class="err">#</span> <span class="n">setx</span><span class="o">=&gt;{</span><span class="n">m1</span><span class="o">,</span><span class="n">m2</span><span class="o">,</span><span class="n">m4</span><span class="o">,</span><span class="n">m6</span><span class="o">},</span> <span class="n">sety</span><span class="o">=&gt;{</span><span class="n">m2</span><span class="o">,</span><span class="n">m5</span><span class="o">,</span><span class="n">m6</span><span class="o">},</span> <span class="n">setz</span><span class="o">=&gt;{</span><span class="n">m1</span><span class="o">,</span><span class="n">m3</span><span class="o">,</span><span class="n">m6</span><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">-----------------------------</span><span class="n">SDIFF</span><span class="o">------------------------------------</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">127</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">1</span><span class="o">:</span><span class="n">6379</span><span class="o">&gt;</span> <span class="n">SDIFF</span> <span class="n">setx</span> <span class="n">sety</span> <span class="n">setz</span> <span class="err">#</span> <span class="n">等价于setx</span><span class="o">-</span><span class="n">sety</span><span class="o">-</span><span class="n">setz</span>
</span></span><span class="line"><span class="cl"><span class="n">1</span><span class="o">)</span> <span class="s">&#34;m4&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">127</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">1</span><span class="o">:</span><span class="n">6379</span><span class="o">&gt;</span> <span class="n">SDIFF</span> <span class="n">setx</span> <span class="n">sety</span> <span class="err">#</span> <span class="n">setx</span> <span class="o">-</span> <span class="n">sety</span>
</span></span><span class="line"><span class="cl"><span class="n">1</span><span class="o">)</span> <span class="s">&#34;m4&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">2</span><span class="o">)</span> <span class="s">&#34;m1&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">127</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">1</span><span class="o">:</span><span class="n">6379</span><span class="o">&gt;</span> <span class="n">SDIFF</span> <span class="n">sety</span> <span class="n">setx</span> <span class="err">#</span> <span class="n">sety</span> <span class="o">-</span> <span class="n">setx</span>
</span></span><span class="line"><span class="cl"><span class="n">1</span><span class="o">)</span> <span class="s">&#34;m5&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">-------------------------</span><span class="n">SINTER</span><span class="o">---------------------------------------</span>
</span></span><span class="line"><span class="cl"><span class="err">#</span> <span class="n">共同关注</span><span class="err">（</span><span class="n">交集</span><span class="err">）</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">127</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">1</span><span class="o">:</span><span class="n">6379</span><span class="o">&gt;</span> <span class="n">SINTER</span> <span class="n">setx</span> <span class="n">sety</span> <span class="n">setz</span> <span class="err">#</span> <span class="n">求</span> <span class="n">setx</span><span class="err">、</span><span class="n">sety</span><span class="err">、</span><span class="n">setx的交集</span>
</span></span><span class="line"><span class="cl"><span class="n">1</span><span class="o">)</span> <span class="s">&#34;m6&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">127</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">1</span><span class="o">:</span><span class="n">6379</span><span class="o">&gt;</span> <span class="n">SINTER</span> <span class="n">setx</span> <span class="n">sety</span> <span class="err">#</span> <span class="n">求setx</span> <span class="n">sety的交集</span>
</span></span><span class="line"><span class="cl"><span class="n">1</span><span class="o">)</span> <span class="s">&#34;m2&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">2</span><span class="o">)</span> <span class="s">&#34;m6&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">-------------------------</span><span class="n">SUNION</span><span class="o">---------------------------------------</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">127</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">1</span><span class="o">:</span><span class="n">6379</span><span class="o">&gt;</span> <span class="n">SUNION</span> <span class="n">setx</span> <span class="n">sety</span> <span class="n">setz</span> <span class="err">#</span> <span class="n">setx</span> <span class="n">sety</span> <span class="n">setz的并集</span>
</span></span><span class="line"><span class="cl"><span class="n">1</span><span class="o">)</span> <span class="s">&#34;m4&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">2</span><span class="o">)</span> <span class="s">&#34;m6&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">3</span><span class="o">)</span> <span class="s">&#34;m3&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">4</span><span class="o">)</span> <span class="s">&#34;m2&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">5</span><span class="o">)</span> <span class="s">&#34;m1&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">6</span><span class="o">)</span> <span class="s">&#34;m5&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">127</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">1</span><span class="o">:</span><span class="n">6379</span><span class="o">&gt;</span> <span class="n">SUNION</span> <span class="n">setx</span> <span class="n">sety</span> <span class="err">#</span> <span class="n">setx</span> <span class="n">sety</span> <span class="n">并集</span>
</span></span><span class="line"><span class="cl"><span class="n">1</span><span class="o">)</span> <span class="s">&#34;m4&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">2</span><span class="o">)</span> <span class="s">&#34;m6&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">3</span><span class="o">)</span> <span class="s">&#34;m2&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">4</span><span class="o">)</span> <span class="s">&#34;m1&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">5</span><span class="o">)</span> <span class="s">&#34;m5&#34;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="hash类型">Hash类型</h2>
<h3 id="命令代码-3">命令代码：</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="o">------------------------</span><span class="n">HSET</span><span class="o">--</span><span class="n">HMSET</span><span class="o">--</span><span class="n">HSETNX</span><span class="o">----------------</span>
</span></span><span class="line"><span class="cl"><span class="n">127</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">1</span><span class="o">:</span><span class="n">6379</span><span class="o">&gt;</span> <span class="n">HSET</span> <span class="n">studentx</span> <span class="n">name</span> <span class="n">sakura</span> <span class="err">#</span> <span class="n">将studentx哈希表作为一个对象</span><span class="err">，</span><span class="n">设置name为sakura</span>
</span></span><span class="line"><span class="cl"><span class="o">(</span><span class="n">integer</span><span class="o">)</span> <span class="n">1</span>
</span></span><span class="line"><span class="cl"><span class="n">127</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">1</span><span class="o">:</span><span class="n">6379</span><span class="o">&gt;</span> <span class="n">HSET</span> <span class="n">studentx</span> <span class="n">name</span> <span class="n">gyc</span> <span class="err">#</span> <span class="n">重复设置field进行覆盖</span><span class="err">，</span><span class="n">并返回0</span>
</span></span><span class="line"><span class="cl"><span class="o">(</span><span class="n">integer</span><span class="o">)</span> <span class="n">0</span>
</span></span><span class="line"><span class="cl"><span class="n">127</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">1</span><span class="o">:</span><span class="n">6379</span><span class="o">&gt;</span> <span class="n">HSET</span> <span class="n">studentx</span> <span class="n">age</span> <span class="n">20</span> <span class="err">#</span> <span class="n">设置studentx的age为20</span>
</span></span><span class="line"><span class="cl"><span class="o">(</span><span class="n">integer</span><span class="o">)</span> <span class="n">1</span>
</span></span><span class="line"><span class="cl"><span class="n">127</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">1</span><span class="o">:</span><span class="n">6379</span><span class="o">&gt;</span> <span class="n">HMSET</span> <span class="n">studentx</span> <span class="n">sex</span> <span class="n">1</span> <span class="n">tel</span> <span class="n">15623667886</span> <span class="err">#</span> <span class="n">设置sex为1</span><span class="err">，</span><span class="n">tel为15623667886</span>
</span></span><span class="line"><span class="cl"><span class="n">OK</span>
</span></span><span class="line"><span class="cl"><span class="n">127</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">1</span><span class="o">:</span><span class="n">6379</span><span class="o">&gt;</span> <span class="n">HSETNX</span> <span class="n">studentx</span> <span class="n">name</span> <span class="n">gyc</span> <span class="err">#</span> <span class="n">HSETNX</span> <span class="nf">设置已存在的field</span>
</span></span><span class="line"><span class="cl"><span class="o">(</span><span class="n">integer</span><span class="o">)</span> <span class="n">0</span> <span class="err">#</span> <span class="n">失败</span>
</span></span><span class="line"><span class="cl"><span class="n">127</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">1</span><span class="o">:</span><span class="n">6379</span><span class="o">&gt;</span> <span class="n">HSETNX</span> <span class="n">studentx</span> <span class="n">email</span> <span class="n">12345</span><span class="nd">@qq.com</span>
</span></span><span class="line"><span class="cl"><span class="o">(</span><span class="n">integer</span><span class="o">)</span> <span class="n">1</span> <span class="err">#</span> <span class="n">成功</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">----------------------</span><span class="n">HEXISTS</span><span class="o">--------------------------------</span>
</span></span><span class="line"><span class="cl"><span class="n">127</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">1</span><span class="o">:</span><span class="n">6379</span><span class="o">&gt;</span> <span class="n">HEXISTS</span> <span class="n">studentx</span> <span class="n">name</span> <span class="err">#</span> <span class="n">name字段在studentx中是否存在</span>
</span></span><span class="line"><span class="cl"><span class="o">(</span><span class="n">integer</span><span class="o">)</span> <span class="n">1</span> <span class="err">#</span> <span class="n">存在</span>
</span></span><span class="line"><span class="cl"><span class="n">127</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">1</span><span class="o">:</span><span class="n">6379</span><span class="o">&gt;</span> <span class="n">HEXISTS</span> <span class="n">studentx</span> <span class="nf">addr</span>
</span></span><span class="line"><span class="cl"><span class="o">(</span><span class="n">integer</span><span class="o">)</span> <span class="n">0</span> <span class="err">#</span> <span class="n">不存在</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">-------------------</span><span class="n">HGET</span><span class="o">--</span><span class="n">HMGET</span><span class="o">--</span><span class="n">HGETALL</span><span class="o">-----------</span>
</span></span><span class="line"><span class="cl"><span class="n">127</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">1</span><span class="o">:</span><span class="n">6379</span><span class="o">&gt;</span> <span class="n">HGET</span> <span class="n">studentx</span> <span class="n">name</span> <span class="err">#</span> <span class="n">获取studentx中name字段的value</span>
</span></span><span class="line"><span class="cl"><span class="s">&#34;gyc&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">127</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">1</span><span class="o">:</span><span class="n">6379</span><span class="o">&gt;</span> <span class="n">HMGET</span> <span class="n">studentx</span> <span class="n">name</span> <span class="n">age</span> <span class="n">tel</span> <span class="err">#</span> <span class="n">获取studentx中name</span><span class="err">、</span><span class="n">age</span><span class="err">、</span><span class="n">tel字段的value</span>
</span></span><span class="line"><span class="cl"><span class="n">1</span><span class="o">)</span> <span class="s">&#34;gyc&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">2</span><span class="o">)</span> <span class="s">&#34;20&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">3</span><span class="o">)</span> <span class="s">&#34;15623667886&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">127</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">1</span><span class="o">:</span><span class="n">6379</span><span class="o">&gt;</span> <span class="n">HGETALL</span> <span class="n">studentx</span> <span class="err">#</span> <span class="n">获取studentx中所有的field及其value</span>
</span></span><span class="line"><span class="cl"> <span class="n">1</span><span class="o">)</span> <span class="s">&#34;name&#34;</span>
</span></span><span class="line"><span class="cl"> <span class="n">2</span><span class="o">)</span> <span class="s">&#34;gyc&#34;</span>
</span></span><span class="line"><span class="cl"> <span class="n">3</span><span class="o">)</span> <span class="s">&#34;age&#34;</span>
</span></span><span class="line"><span class="cl"> <span class="n">4</span><span class="o">)</span> <span class="s">&#34;20&#34;</span>
</span></span><span class="line"><span class="cl"> <span class="n">5</span><span class="o">)</span> <span class="s">&#34;sex&#34;</span>
</span></span><span class="line"><span class="cl"> <span class="n">6</span><span class="o">)</span> <span class="s">&#34;1&#34;</span>
</span></span><span class="line"><span class="cl"> <span class="n">7</span><span class="o">)</span> <span class="s">&#34;tel&#34;</span>
</span></span><span class="line"><span class="cl"> <span class="n">8</span><span class="o">)</span> <span class="s">&#34;15623667886&#34;</span>
</span></span><span class="line"><span class="cl"> <span class="n">9</span><span class="o">)</span> <span class="s">&#34;email&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">10</span><span class="o">)</span> <span class="s">&#34;12345@qq.com&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">--------------------</span><span class="n">HKEYS</span><span class="o">--</span><span class="n">HLEN</span><span class="o">--</span><span class="n">HVALS</span><span class="o">--------------</span>
</span></span><span class="line"><span class="cl"><span class="n">127</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">1</span><span class="o">:</span><span class="n">6379</span><span class="o">&gt;</span> <span class="n">HKEYS</span> <span class="n">studentx</span> <span class="err">#</span> <span class="n">查看studentx中所有的field</span>
</span></span><span class="line"><span class="cl"><span class="n">1</span><span class="o">)</span> <span class="s">&#34;name&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">2</span><span class="o">)</span> <span class="s">&#34;age&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">3</span><span class="o">)</span> <span class="s">&#34;sex&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">4</span><span class="o">)</span> <span class="s">&#34;tel&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">5</span><span class="o">)</span> <span class="s">&#34;email&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">127</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">1</span><span class="o">:</span><span class="n">6379</span><span class="o">&gt;</span> <span class="n">HLEN</span> <span class="n">studentx</span> <span class="err">#</span> <span class="n">查看studentx中的字段数量</span>
</span></span><span class="line"><span class="cl"><span class="o">(</span><span class="n">integer</span><span class="o">)</span> <span class="n">5</span>
</span></span><span class="line"><span class="cl"><span class="n">127</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">1</span><span class="o">:</span><span class="n">6379</span><span class="o">&gt;</span> <span class="n">HVALS</span> <span class="n">studentx</span> <span class="err">#</span> <span class="n">查看studentx中所有的value</span>
</span></span><span class="line"><span class="cl"><span class="n">1</span><span class="o">)</span> <span class="s">&#34;gyc&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">2</span><span class="o">)</span> <span class="s">&#34;20&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">3</span><span class="o">)</span> <span class="s">&#34;1&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">4</span><span class="o">)</span> <span class="s">&#34;15623667886&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">5</span><span class="o">)</span> <span class="s">&#34;12345@qq.com&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">-------------------------</span><span class="n">HDEL</span><span class="o">--------------------------</span>
</span></span><span class="line"><span class="cl"><span class="n">127</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">1</span><span class="o">:</span><span class="n">6379</span><span class="o">&gt;</span> <span class="n">HDEL</span> <span class="n">studentx</span> <span class="n">sex</span> <span class="n">tel</span> <span class="err">#</span> <span class="n">删除studentx</span> <span class="n">中的sex</span><span class="err">、</span><span class="n">tel字段</span>
</span></span><span class="line"><span class="cl"><span class="o">(</span><span class="n">integer</span><span class="o">)</span> <span class="n">2</span>
</span></span><span class="line"><span class="cl"><span class="n">127</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">1</span><span class="o">:</span><span class="n">6379</span><span class="o">&gt;</span> <span class="n">HKEYS</span> <span class="n">studentx</span>
</span></span><span class="line"><span class="cl"><span class="n">1</span><span class="o">)</span> <span class="s">&#34;name&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">2</span><span class="o">)</span> <span class="s">&#34;age&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">3</span><span class="o">)</span> <span class="s">&#34;email&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">-------------</span><span class="n">HINCRBY</span><span class="o">--</span><span class="n">HINCRBYFLOAT</span><span class="o">------------------------</span>
</span></span><span class="line"><span class="cl"><span class="n">127</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">1</span><span class="o">:</span><span class="n">6379</span><span class="o">&gt;</span> <span class="n">HINCRBY</span> <span class="n">studentx</span> <span class="n">age</span> <span class="n">1</span> <span class="err">#</span> <span class="n">studentx的age字段数值</span><span class="o">+</span><span class="n">1</span>
</span></span><span class="line"><span class="cl"><span class="o">(</span><span class="n">integer</span><span class="o">)</span> <span class="n">21</span>
</span></span><span class="line"><span class="cl"><span class="n">127</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">1</span><span class="o">:</span><span class="n">6379</span><span class="o">&gt;</span> <span class="n">HINCRBY</span> <span class="n">studentx</span> <span class="n">name</span> <span class="n">1</span> <span class="err">#</span> <span class="n">非整数字型字段不可用</span>
</span></span><span class="line"><span class="cl"><span class="o">(</span><span class="n">error</span><span class="o">)</span> <span class="n">ERR</span> <span class="n">hash</span> <span class="n">value</span> <span class="n">is</span> <span class="n">not</span> <span class="n">an</span> <span class="n">integer</span>
</span></span><span class="line"><span class="cl"><span class="n">127</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">1</span><span class="o">:</span><span class="n">6379</span><span class="o">&gt;</span> <span class="n">HINCRBYFLOAT</span> <span class="n">studentx</span> <span class="n">weight</span> <span class="n">0</span><span class="o">.</span><span class="na">6</span> <span class="err">#</span> <span class="n">weight字段增加0</span><span class="o">.</span><span class="na">6</span>
</span></span><span class="line"><span class="cl"><span class="s">&#34;90.8&#34;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="zset类型">Zset类型</h2>
<h3 id="命令代码-4">命令代码:</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="o">-------------------</span><span class="n">ZADD</span><span class="o">--</span><span class="n">ZCARD</span><span class="o">--</span><span class="n">ZCOUNT</span><span class="o">--------------</span>
</span></span><span class="line"><span class="cl"><span class="n">127</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">1</span><span class="o">:</span><span class="n">6379</span><span class="o">&gt;</span> <span class="n">ZADD</span> <span class="n">myzset</span> <span class="n">1</span> <span class="n">m1</span> <span class="n">2</span> <span class="n">m2</span> <span class="n">3</span> <span class="n">m3</span> <span class="err">#</span> <span class="n">向有序集合myzset中添加成员m1</span> <span class="n">score</span><span class="o">=</span><span class="n">1</span> <span class="n">以及成员m2</span> <span class="n">score</span><span class="o">=</span><span class="n">2</span><span class="o">..</span>
</span></span><span class="line"><span class="cl"><span class="o">(</span><span class="n">integer</span><span class="o">)</span> <span class="n">2</span>
</span></span><span class="line"><span class="cl"><span class="n">127</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">1</span><span class="o">:</span><span class="n">6379</span><span class="o">&gt;</span> <span class="n">ZCARD</span> <span class="n">myzset</span> <span class="err">#</span> <span class="n">获取有序集合的成员数</span>
</span></span><span class="line"><span class="cl"><span class="o">(</span><span class="n">integer</span><span class="o">)</span> <span class="n">2</span>
</span></span><span class="line"><span class="cl"><span class="n">127</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">1</span><span class="o">:</span><span class="n">6379</span><span class="o">&gt;</span> <span class="n">ZCOUNT</span> <span class="n">myzset</span> <span class="n">0</span> <span class="n">1</span> <span class="err">#</span> <span class="n">获取score在</span> <span class="o">[</span><span class="n">0</span><span class="o">,</span><span class="n">1</span><span class="o">]</span><span class="n">区间的成员数量</span>
</span></span><span class="line"><span class="cl"><span class="o">(</span><span class="n">integer</span><span class="o">)</span> <span class="n">1</span>
</span></span><span class="line"><span class="cl"><span class="n">127</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">1</span><span class="o">:</span><span class="n">6379</span><span class="o">&gt;</span> <span class="n">ZCOUNT</span> <span class="n">myzset</span> <span class="n">0</span> <span class="nf">2</span>
</span></span><span class="line"><span class="cl"><span class="o">(</span><span class="n">integer</span><span class="o">)</span> <span class="n">2</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">----------------</span><span class="n">ZINCRBY</span><span class="o">--</span><span class="n">ZSCORE</span><span class="o">--------------------------</span>
</span></span><span class="line"><span class="cl"><span class="n">127</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">1</span><span class="o">:</span><span class="n">6379</span><span class="o">&gt;</span> <span class="n">ZINCRBY</span> <span class="n">myzset</span> <span class="n">5</span> <span class="n">m2</span> <span class="err">#</span> <span class="n">将成员m2的score</span> <span class="o">+</span><span class="n">5</span>
</span></span><span class="line"><span class="cl"><span class="s">&#34;7&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">127</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">1</span><span class="o">:</span><span class="n">6379</span><span class="o">&gt;</span> <span class="n">ZSCORE</span> <span class="n">myzset</span> <span class="n">m1</span> <span class="err">#</span> <span class="n">获取成员m1的score</span>
</span></span><span class="line"><span class="cl"><span class="s">&#34;1&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">127</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">1</span><span class="o">:</span><span class="n">6379</span><span class="o">&gt;</span> <span class="n">ZSCORE</span> <span class="n">myzset</span> <span class="n">m2</span>
</span></span><span class="line"><span class="cl"><span class="s">&#34;7&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">--------------</span><span class="n">ZRANK</span><span class="o">--</span><span class="n">ZRANGE</span><span class="o">-----------------------------------</span>
</span></span><span class="line"><span class="cl"><span class="n">127</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">1</span><span class="o">:</span><span class="n">6379</span><span class="o">&gt;</span> <span class="n">ZRANK</span> <span class="n">myzset</span> <span class="n">m1</span> <span class="err">#</span> <span class="n">获取成员m1的索引</span><span class="err">，</span><span class="n">索引按照score排序</span><span class="err">，</span><span class="n">score相同索引值按字典顺序顺序增加</span>
</span></span><span class="line"><span class="cl"><span class="o">(</span><span class="n">integer</span><span class="o">)</span> <span class="n">0</span>
</span></span><span class="line"><span class="cl"><span class="n">127</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">1</span><span class="o">:</span><span class="n">6379</span><span class="o">&gt;</span> <span class="n">ZRANK</span> <span class="n">myzset</span> <span class="nf">m2</span>
</span></span><span class="line"><span class="cl"><span class="o">(</span><span class="n">integer</span><span class="o">)</span> <span class="n">2</span>
</span></span><span class="line"><span class="cl"><span class="n">127</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">1</span><span class="o">:</span><span class="n">6379</span><span class="o">&gt;</span> <span class="n">ZRANGE</span> <span class="n">myzset</span> <span class="n">0</span> <span class="n">1</span> <span class="err">#</span> <span class="n">获取索引在</span> <span class="n">0</span><span class="o">~</span><span class="n">1的成员</span>
</span></span><span class="line"><span class="cl"><span class="n">1</span><span class="o">)</span> <span class="s">&#34;m1&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">2</span><span class="o">)</span> <span class="s">&#34;m3&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">127</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">1</span><span class="o">:</span><span class="n">6379</span><span class="o">&gt;</span> <span class="n">ZRANGE</span> <span class="n">myzset</span> <span class="n">0</span> <span class="o">-</span><span class="n">1</span> <span class="err">#</span> <span class="n">获取全部成员</span>
</span></span><span class="line"><span class="cl"><span class="n">1</span><span class="o">)</span> <span class="s">&#34;m1&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">2</span><span class="o">)</span> <span class="s">&#34;m3&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">3</span><span class="o">)</span> <span class="s">&#34;m2&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="err">#</span><span class="n">testset</span><span class="o">=&gt;{</span><span class="n">abc</span><span class="o">,</span><span class="n">add</span><span class="o">,</span><span class="n">amaze</span><span class="o">,</span><span class="n">apple</span><span class="o">,</span><span class="n">back</span><span class="o">,</span><span class="n">java</span><span class="o">,</span><span class="n">redis</span><span class="o">}</span> <span class="n">score均为0</span>
</span></span><span class="line"><span class="cl"><span class="o">------------------</span><span class="n">ZRANGEBYLEX</span><span class="o">---------------------------------</span>
</span></span><span class="line"><span class="cl"><span class="n">127</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">1</span><span class="o">:</span><span class="n">6379</span><span class="o">&gt;</span> <span class="n">ZRANGEBYLEX</span> <span class="n">testset</span> <span class="o">-</span> <span class="o">+</span> <span class="err">#</span> <span class="n">返回所有成员</span>
</span></span><span class="line"><span class="cl"><span class="n">1</span><span class="o">)</span> <span class="s">&#34;abc&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">2</span><span class="o">)</span> <span class="s">&#34;add&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">3</span><span class="o">)</span> <span class="s">&#34;amaze&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">4</span><span class="o">)</span> <span class="s">&#34;apple&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">5</span><span class="o">)</span> <span class="s">&#34;back&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">6</span><span class="o">)</span> <span class="s">&#34;java&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">7</span><span class="o">)</span> <span class="s">&#34;redis&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">127</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">1</span><span class="o">:</span><span class="n">6379</span><span class="o">&gt;</span> <span class="n">ZRANGEBYLEX</span> <span class="n">testset</span> <span class="o">-</span> <span class="o">+</span> <span class="n">LIMIT</span> <span class="n">0</span> <span class="n">3</span> <span class="err">#</span> <span class="n">分页</span> <span class="n">按索引显示查询结果的</span> <span class="n">0</span><span class="o">,</span><span class="n">1</span><span class="o">,</span><span class="n">2条记录</span>
</span></span><span class="line"><span class="cl"><span class="n">1</span><span class="o">)</span> <span class="s">&#34;abc&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">2</span><span class="o">)</span> <span class="s">&#34;add&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">3</span><span class="o">)</span> <span class="s">&#34;amaze&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">127</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">1</span><span class="o">:</span><span class="n">6379</span><span class="o">&gt;</span> <span class="n">ZRANGEBYLEX</span> <span class="n">testset</span> <span class="o">-</span> <span class="o">+</span> <span class="n">LIMIT</span> <span class="n">3</span> <span class="n">3</span> <span class="err">#</span> <span class="n">显示</span> <span class="n">3</span><span class="o">,</span><span class="n">4</span><span class="o">,</span><span class="n">5条记录</span>
</span></span><span class="line"><span class="cl"><span class="n">1</span><span class="o">)</span> <span class="s">&#34;apple&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">2</span><span class="o">)</span> <span class="s">&#34;back&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">3</span><span class="o">)</span> <span class="s">&#34;java&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">127</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">1</span><span class="o">:</span><span class="n">6379</span><span class="o">&gt;</span> <span class="n">ZRANGEBYLEX</span> <span class="nf">testset</span> <span class="o">(-</span> <span class="o">[</span><span class="n">apple</span> <span class="err">#</span> <span class="n">显示</span> <span class="o">(-,</span><span class="n">apple</span><span class="o">]</span> <span class="n">区间内的成员</span>
</span></span><span class="line"><span class="cl"><span class="n">1</span><span class="o">)</span> <span class="s">&#34;abc&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">2</span><span class="o">)</span> <span class="s">&#34;add&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">3</span><span class="o">)</span> <span class="s">&#34;amaze&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">4</span><span class="o">)</span> <span class="s">&#34;apple&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">127</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">1</span><span class="o">:</span><span class="n">6379</span><span class="o">&gt;</span> <span class="n">ZRANGEBYLEX</span> <span class="n">testset</span> <span class="o">[</span><span class="n">apple</span> <span class="o">[</span><span class="n">java</span> <span class="err">#</span> <span class="n">显示</span> <span class="o">[</span><span class="n">apple</span><span class="o">,</span><span class="n">java</span><span class="o">]</span><span class="n">字典区间的成员</span>
</span></span><span class="line"><span class="cl"><span class="n">1</span><span class="o">)</span> <span class="s">&#34;apple&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">2</span><span class="o">)</span> <span class="s">&#34;back&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">3</span><span class="o">)</span> <span class="s">&#34;java&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">-----------------------</span><span class="n">ZRANGEBYSCORE</span><span class="o">---------------------</span>
</span></span><span class="line"><span class="cl"><span class="n">127</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">1</span><span class="o">:</span><span class="n">6379</span><span class="o">&gt;</span> <span class="n">ZRANGEBYSCORE</span> <span class="n">myzset</span> <span class="n">1</span> <span class="n">10</span> <span class="err">#</span> <span class="n">返回score在</span> <span class="o">[</span><span class="n">1</span><span class="o">,</span><span class="n">10</span><span class="o">]</span><span class="n">之间的的成员</span>
</span></span><span class="line"><span class="cl"><span class="n">1</span><span class="o">)</span> <span class="s">&#34;m1&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">2</span><span class="o">)</span> <span class="s">&#34;m3&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">3</span><span class="o">)</span> <span class="s">&#34;m2&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">127</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">1</span><span class="o">:</span><span class="n">6379</span><span class="o">&gt;</span> <span class="n">ZRANGEBYSCORE</span> <span class="n">myzset</span> <span class="n">1</span> <span class="n">5</span>
</span></span><span class="line"><span class="cl"><span class="n">1</span><span class="o">)</span> <span class="s">&#34;m1&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">2</span><span class="o">)</span> <span class="s">&#34;m3&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">--------------------</span><span class="n">ZLEXCOUNT</span><span class="o">-----------------------------</span>
</span></span><span class="line"><span class="cl"><span class="n">127</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">1</span><span class="o">:</span><span class="n">6379</span><span class="o">&gt;</span> <span class="n">ZLEXCOUNT</span> <span class="n">testset</span> <span class="o">-</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl"><span class="o">(</span><span class="n">integer</span><span class="o">)</span> <span class="n">7</span>
</span></span><span class="line"><span class="cl"><span class="n">127</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">1</span><span class="o">:</span><span class="n">6379</span><span class="o">&gt;</span> <span class="n">ZLEXCOUNT</span> <span class="n">testset</span> <span class="o">[</span><span class="n">apple</span> <span class="o">[</span><span class="n">java</span>
</span></span><span class="line"><span class="cl"><span class="o">(</span><span class="n">integer</span><span class="o">)</span> <span class="n">3</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">------------------</span><span class="n">ZREM</span><span class="o">--</span><span class="n">ZREMRANGEBYLEX</span><span class="o">--</span><span class="n">ZREMRANGBYRANK</span><span class="o">--</span><span class="n">ZREMRANGEBYSCORE</span><span class="o">--------------------------------</span>
</span></span><span class="line"><span class="cl"><span class="n">127</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">1</span><span class="o">:</span><span class="n">6379</span><span class="o">&gt;</span> <span class="n">ZREM</span> <span class="n">testset</span> <span class="n">abc</span> <span class="err">#</span> <span class="n">移除成员abc</span>
</span></span><span class="line"><span class="cl"><span class="o">(</span><span class="n">integer</span><span class="o">)</span> <span class="n">1</span>
</span></span><span class="line"><span class="cl"><span class="n">127</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">1</span><span class="o">:</span><span class="n">6379</span><span class="o">&gt;</span> <span class="n">ZREMRANGEBYLEX</span> <span class="n">testset</span> <span class="o">[</span><span class="n">apple</span> <span class="o">[</span><span class="n">java</span> <span class="err">#</span> <span class="n">移除字典区间</span><span class="o">[</span><span class="n">apple</span><span class="o">,</span><span class="n">java</span><span class="o">]</span><span class="n">中的所有成员</span>
</span></span><span class="line"><span class="cl"><span class="o">(</span><span class="n">integer</span><span class="o">)</span> <span class="n">3</span>
</span></span><span class="line"><span class="cl"><span class="n">127</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">1</span><span class="o">:</span><span class="n">6379</span><span class="o">&gt;</span> <span class="n">ZREMRANGEBYRANK</span> <span class="n">testset</span> <span class="n">0</span> <span class="n">1</span> <span class="err">#</span> <span class="n">移除排名0</span><span class="o">~</span><span class="n">1的所有成员</span>
</span></span><span class="line"><span class="cl"><span class="o">(</span><span class="n">integer</span><span class="o">)</span> <span class="n">2</span>
</span></span><span class="line"><span class="cl"><span class="n">127</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">1</span><span class="o">:</span><span class="n">6379</span><span class="o">&gt;</span> <span class="n">ZREMRANGEBYSCORE</span> <span class="n">myzset</span> <span class="n">0</span> <span class="n">3</span> <span class="err">#</span> <span class="n">移除score在</span> <span class="o">[</span><span class="n">0</span><span class="o">,</span><span class="n">3</span><span class="o">]</span><span class="n">的成员</span>
</span></span><span class="line"><span class="cl"><span class="o">(</span><span class="n">integer</span><span class="o">)</span> <span class="n">2</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="err">#</span> <span class="n">testset</span><span class="o">=&gt;</span> <span class="o">{</span><span class="n">abc</span><span class="o">,</span><span class="n">add</span><span class="o">,</span><span class="n">apple</span><span class="o">,</span><span class="n">amaze</span><span class="o">,</span><span class="n">back</span><span class="o">,</span><span class="n">java</span><span class="o">,</span><span class="n">redis</span><span class="o">}</span> <span class="n">score均为0</span>
</span></span><span class="line"><span class="cl"><span class="err">#</span> <span class="n">myzset</span><span class="o">=&gt;</span> <span class="o">{(</span><span class="n">m1</span><span class="o">,</span><span class="n">1</span><span class="o">),(</span><span class="n">m2</span><span class="o">,</span><span class="n">2</span><span class="o">),(</span><span class="n">m3</span><span class="o">,</span><span class="n">3</span><span class="o">),(</span><span class="n">m4</span><span class="o">,</span><span class="n">4</span><span class="o">),(</span><span class="n">m7</span><span class="o">,</span><span class="n">7</span><span class="o">),(</span><span class="n">m9</span><span class="o">,</span><span class="n">9</span><span class="o">)}</span>
</span></span><span class="line"><span class="cl"><span class="o">----------------</span><span class="n">ZREVRANGE</span><span class="o">--</span><span class="n">ZREVRANGEBYSCORE</span><span class="o">--</span><span class="n">ZREVRANGEBYLEX</span><span class="o">-----------</span>
</span></span><span class="line"><span class="cl"><span class="n">127</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">1</span><span class="o">:</span><span class="n">6379</span><span class="o">&gt;</span> <span class="n">ZREVRANGE</span> <span class="n">myzset</span> <span class="n">0</span> <span class="n">3</span> <span class="err">#</span> <span class="n">按score递减排序</span><span class="err">，</span><span class="n">然后按索引</span><span class="err">，</span><span class="n">返回结果的</span> <span class="n">0</span><span class="o">~</span><span class="n">3</span>
</span></span><span class="line"><span class="cl"><span class="n">1</span><span class="o">)</span> <span class="s">&#34;m9&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">2</span><span class="o">)</span> <span class="s">&#34;m7&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">3</span><span class="o">)</span> <span class="s">&#34;m4&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">4</span><span class="o">)</span> <span class="s">&#34;m3&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">127</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">1</span><span class="o">:</span><span class="n">6379</span><span class="o">&gt;</span> <span class="n">ZREVRANGE</span> <span class="n">myzset</span> <span class="n">2</span> <span class="n">4</span> <span class="err">#</span> <span class="n">返回排序结果的</span> <span class="n">索引的2</span><span class="o">~</span><span class="n">4</span>
</span></span><span class="line"><span class="cl"><span class="n">1</span><span class="o">)</span> <span class="s">&#34;m4&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">2</span><span class="o">)</span> <span class="s">&#34;m3&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">3</span><span class="o">)</span> <span class="s">&#34;m2&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">127</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">1</span><span class="o">:</span><span class="n">6379</span><span class="o">&gt;</span> <span class="n">ZREVRANGEBYSCORE</span> <span class="n">myzset</span> <span class="n">6</span> <span class="n">2</span> <span class="err">#</span> <span class="n">按score递减顺序</span> <span class="n">返回集合中分数在</span><span class="o">[</span><span class="n">2</span><span class="o">,</span><span class="n">6</span><span class="o">]</span><span class="n">之间的成员</span>
</span></span><span class="line"><span class="cl"><span class="n">1</span><span class="o">)</span> <span class="s">&#34;m4&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">2</span><span class="o">)</span> <span class="s">&#34;m3&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">3</span><span class="o">)</span> <span class="s">&#34;m2&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">127</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">1</span><span class="o">:</span><span class="n">6379</span><span class="o">&gt;</span> <span class="n">ZREVRANGEBYLEX</span> <span class="n">testset</span> <span class="o">[</span><span class="n">java</span> <span class="o">(</span><span class="n">add</span> <span class="err">#</span> <span class="n">按字典倒序</span> <span class="nf">返回集合中</span><span class="o">(</span><span class="n">add</span><span class="o">,</span><span class="n">java</span><span class="o">]</span><span class="n">字典区间的成员</span>
</span></span><span class="line"><span class="cl"><span class="n">1</span><span class="o">)</span> <span class="s">&#34;java&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">2</span><span class="o">)</span> <span class="s">&#34;back&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">3</span><span class="o">)</span> <span class="s">&#34;apple&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">4</span><span class="o">)</span> <span class="s">&#34;amaze&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">-------------------------</span><span class="n">ZREVRANK</span><span class="o">------------------------------</span>
</span></span><span class="line"><span class="cl"><span class="n">127</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">1</span><span class="o">:</span><span class="n">6379</span><span class="o">&gt;</span> <span class="n">ZREVRANK</span> <span class="n">myzset</span> <span class="n">m7</span> <span class="err">#</span> <span class="n">按score递减顺序</span><span class="err">，</span><span class="n">返回成员m7索引</span>
</span></span><span class="line"><span class="cl"><span class="o">(</span><span class="n">integer</span><span class="o">)</span> <span class="n">1</span>
</span></span><span class="line"><span class="cl"><span class="n">127</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">1</span><span class="o">:</span><span class="n">6379</span><span class="o">&gt;</span> <span class="n">ZREVRANK</span> <span class="n">myzset</span> <span class="nf">m2</span>
</span></span><span class="line"><span class="cl"><span class="o">(</span><span class="n">integer</span><span class="o">)</span> <span class="n">4</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="err">#</span> <span class="n">mathscore</span><span class="o">=&gt;{(</span><span class="n">xm</span><span class="o">,</span><span class="n">90</span><span class="o">),(</span><span class="n">xh</span><span class="o">,</span><span class="n">95</span><span class="o">),(</span><span class="n">xg</span><span class="o">,</span><span class="n">87</span><span class="o">)}</span> <span class="n">小明</span><span class="err">、</span><span class="n">小红</span><span class="err">、</span><span class="n">小刚的数学成绩</span>
</span></span><span class="line"><span class="cl"><span class="err">#</span> <span class="n">enscore</span><span class="o">=&gt;{(</span><span class="n">xm</span><span class="o">,</span><span class="n">70</span><span class="o">),(</span><span class="n">xh</span><span class="o">,</span><span class="n">93</span><span class="o">),(</span><span class="n">xg</span><span class="o">,</span><span class="n">90</span><span class="o">)}</span> <span class="n">小明</span><span class="err">、</span><span class="n">小红</span><span class="err">、</span><span class="n">小刚的英语成绩</span>
</span></span><span class="line"><span class="cl"><span class="o">-------------------</span><span class="n">ZINTERSTORE</span><span class="o">--</span><span class="n">ZUNIONSTORE</span><span class="o">-----------------------------------</span>
</span></span><span class="line"><span class="cl"><span class="n">127</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">1</span><span class="o">:</span><span class="n">6379</span><span class="o">&gt;</span> <span class="n">ZINTERSTORE</span> <span class="n">sumscore</span> <span class="n">2</span> <span class="n">mathscore</span> <span class="n">enscore</span> <span class="err">#</span> <span class="n">将mathscore</span> <span class="n">enscore进行合并</span> <span class="nf">结果存放到sumscore</span>
</span></span><span class="line"><span class="cl"><span class="o">(</span><span class="n">integer</span><span class="o">)</span> <span class="n">3</span>
</span></span><span class="line"><span class="cl"><span class="n">127</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">1</span><span class="o">:</span><span class="n">6379</span><span class="o">&gt;</span> <span class="n">ZRANGE</span> <span class="n">sumscore</span> <span class="n">0</span> <span class="o">-</span><span class="n">1</span> <span class="n">withscores</span> <span class="err">#</span> <span class="n">合并后的score是之前集合中所有score的和</span>
</span></span><span class="line"><span class="cl"><span class="n">1</span><span class="o">)</span> <span class="s">&#34;xm&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">2</span><span class="o">)</span> <span class="s">&#34;160&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">3</span><span class="o">)</span> <span class="s">&#34;xg&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">4</span><span class="o">)</span> <span class="s">&#34;177&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">5</span><span class="o">)</span> <span class="s">&#34;xh&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">6</span><span class="o">)</span> <span class="s">&#34;188&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">127</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">1</span><span class="o">:</span><span class="n">6379</span><span class="o">&gt;</span> <span class="n">ZUNIONSTORE</span> <span class="n">lowestscore</span> <span class="n">2</span> <span class="n">mathscore</span> <span class="n">enscore</span> <span class="n">AGGREGATE</span> <span class="n">MIN</span> <span class="err">#</span> <span class="n">取两个集合的成员score最小值作为结果的</span>
</span></span><span class="line"><span class="cl"><span class="o">(</span><span class="n">integer</span><span class="o">)</span> <span class="n">3</span>
</span></span><span class="line"><span class="cl"><span class="n">127</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">1</span><span class="o">:</span><span class="n">6379</span><span class="o">&gt;</span> <span class="n">ZRANGE</span> <span class="n">lowestscore</span> <span class="n">0</span> <span class="o">-</span><span class="n">1</span> <span class="n">withscores</span>
</span></span><span class="line"><span class="cl"><span class="n">1</span><span class="o">)</span> <span class="s">&#34;xm&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">2</span><span class="o">)</span> <span class="s">&#34;70&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">3</span><span class="o">)</span> <span class="s">&#34;xg&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">4</span><span class="o">)</span> <span class="s">&#34;87&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">5</span><span class="o">)</span> <span class="s">&#34;xh&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">6</span><span class="o">)</span> <span class="s">&#34;93&#34;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h1 id="三种特殊类型">三种特殊类型</h1>
<h2 id="geospatial地理位置">Geospatial(地理位置)</h2>
<h3 id="命令代码-5">命令代码：</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="o">----------------</span><span class="n">georadius</span><span class="o">---------------------</span>
</span></span><span class="line"><span class="cl"><span class="n">127</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">1</span><span class="o">:</span><span class="n">6379</span><span class="o">&gt;</span> <span class="n">GEORADIUS</span> <span class="n">china</span><span class="o">:</span><span class="n">city</span> <span class="n">120</span> <span class="n">30</span> <span class="n">500</span> <span class="n">km</span> <span class="n">withcoord</span> <span class="n">withdist</span> <span class="err">#</span> <span class="n">查询经纬度</span><span class="o">(</span><span class="n">120</span><span class="o">,</span><span class="n">30</span><span class="o">)</span><span class="n">坐标500km半径内的成员</span>
</span></span><span class="line"><span class="cl"><span class="n">1</span><span class="o">)</span> <span class="n">1</span><span class="o">)</span> <span class="s">&#34;hangzhou&#34;</span>
</span></span><span class="line"><span class="cl">   <span class="n">2</span><span class="o">)</span> <span class="s">&#34;29.4151&#34;</span>
</span></span><span class="line"><span class="cl">   <span class="n">3</span><span class="o">)</span> <span class="n">1</span><span class="o">)</span> <span class="s">&#34;120.20000249147415&#34;</span>
</span></span><span class="line"><span class="cl">      <span class="n">2</span><span class="o">)</span> <span class="s">&#34;30.199999888333501&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">2</span><span class="o">)</span> <span class="n">1</span><span class="o">)</span> <span class="s">&#34;shanghai&#34;</span>
</span></span><span class="line"><span class="cl">   <span class="n">2</span><span class="o">)</span> <span class="s">&#34;205.3611&#34;</span>
</span></span><span class="line"><span class="cl">   <span class="n">3</span><span class="o">)</span> <span class="n">1</span><span class="o">)</span> <span class="s">&#34;121.40000134706497&#34;</span>
</span></span><span class="line"><span class="cl">      <span class="n">2</span><span class="o">)</span> <span class="s">&#34;31.400000253193539&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">------------</span><span class="n">geohash</span><span class="o">---------------------------</span>
</span></span><span class="line"><span class="cl"><span class="n">127</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">1</span><span class="o">:</span><span class="n">6379</span><span class="o">&gt;</span> <span class="n">geohash</span> <span class="n">china</span><span class="o">:</span><span class="n">city</span> <span class="n">yichang</span> <span class="n">shanghai</span> <span class="err">#</span> <span class="n">获取成员经纬坐标的geohash表示</span>
</span></span><span class="line"><span class="cl"><span class="n">1</span><span class="o">)</span> <span class="s">&#34;wmrjwbr5250&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">2</span><span class="o">)</span> <span class="s">&#34;wtw6ds0y300&#34;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="hyperloglog基数统计">Hyperloglog(基数统计)</h2>
<h3 id="命令代码-6">命令代码：</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="o">----------</span><span class="n">PFADD</span><span class="o">--</span><span class="n">PFCOUNT</span><span class="o">---------------------</span>
</span></span><span class="line"><span class="cl"><span class="n">127</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">1</span><span class="o">:</span><span class="n">6379</span><span class="o">&gt;</span> <span class="n">PFADD</span> <span class="n">myelemx</span> <span class="n">a</span> <span class="n">b</span> <span class="n">c</span> <span class="n">d</span> <span class="n">e</span> <span class="n">f</span> <span class="n">g</span> <span class="n">h</span> <span class="n">i</span> <span class="n">j</span> <span class="n">k</span> <span class="err">#</span> <span class="n">添加元素</span>
</span></span><span class="line"><span class="cl"><span class="o">(</span><span class="n">integer</span><span class="o">)</span> <span class="n">1</span>
</span></span><span class="line"><span class="cl"><span class="n">127</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">1</span><span class="o">:</span><span class="n">6379</span><span class="o">&gt;</span> <span class="n">type</span> <span class="n">myelemx</span> <span class="err">#</span> <span class="n">hyperloglog底层使用String</span>
</span></span><span class="line"><span class="cl"><span class="n">string</span>
</span></span><span class="line"><span class="cl"><span class="n">127</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">1</span><span class="o">:</span><span class="n">6379</span><span class="o">&gt;</span> <span class="n">PFCOUNT</span> <span class="n">myelemx</span> <span class="err">#</span> <span class="n">估算myelemx的基数</span>
</span></span><span class="line"><span class="cl"><span class="o">(</span><span class="n">integer</span><span class="o">)</span> <span class="n">11</span>
</span></span><span class="line"><span class="cl"><span class="n">127</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">1</span><span class="o">:</span><span class="n">6379</span><span class="o">&gt;</span> <span class="n">PFADD</span> <span class="n">myelemy</span> <span class="n">i</span> <span class="n">j</span> <span class="n">k</span> <span class="n">z</span> <span class="n">m</span> <span class="n">c</span> <span class="n">b</span> <span class="n">v</span> <span class="n">p</span> <span class="n">q</span> <span class="nf">s</span>
</span></span><span class="line"><span class="cl"><span class="o">(</span><span class="n">integer</span><span class="o">)</span> <span class="n">1</span>
</span></span><span class="line"><span class="cl"><span class="n">127</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">1</span><span class="o">:</span><span class="n">6379</span><span class="o">&gt;</span> <span class="n">PFCOUNT</span> <span class="nf">myelemy</span>
</span></span><span class="line"><span class="cl"><span class="o">(</span><span class="n">integer</span><span class="o">)</span> <span class="n">11</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">----------------</span><span class="n">PFMERGE</span><span class="o">-----------------------</span>
</span></span><span class="line"><span class="cl"><span class="n">127</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">1</span><span class="o">:</span><span class="n">6379</span><span class="o">&gt;</span> <span class="n">PFMERGE</span> <span class="n">myelemz</span> <span class="n">myelemx</span> <span class="n">myelemy</span> <span class="err">#</span> <span class="n">合并myelemx和myelemy</span> <span class="n">成为myelemz</span>
</span></span><span class="line"><span class="cl"><span class="n">OK</span>
</span></span><span class="line"><span class="cl"><span class="n">127</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">1</span><span class="o">:</span><span class="n">6379</span><span class="o">&gt;</span> <span class="n">PFCOUNT</span> <span class="n">myelemz</span> <span class="err">#</span> <span class="n">估算基数</span>
</span></span><span class="line"><span class="cl"><span class="o">(</span><span class="n">integer</span><span class="o">)</span> <span class="n">17</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="bitmap位图">BitMap(位图)</h2>
<h3 id="命令代码-7">命令代码：</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="o">------------</span><span class="n">setbit</span><span class="o">--</span><span class="n">getbit</span><span class="o">--------------</span>
</span></span><span class="line"><span class="cl"><span class="n">127</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">1</span><span class="o">:</span><span class="n">6379</span><span class="o">&gt;</span> <span class="n">setbit</span> <span class="n">sign</span> <span class="n">0</span> <span class="n">1</span> <span class="err">#</span> <span class="n">设置sign的第0位为</span> <span class="nf">1</span> 
</span></span><span class="line"><span class="cl"><span class="o">(</span><span class="n">integer</span><span class="o">)</span> <span class="n">0</span>
</span></span><span class="line"><span class="cl"><span class="n">127</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">1</span><span class="o">:</span><span class="n">6379</span><span class="o">&gt;</span> <span class="n">setbit</span> <span class="n">sign</span> <span class="n">2</span> <span class="n">1</span> <span class="err">#</span> <span class="n">设置sign的第2位为</span> <span class="n">1</span>  <span class="n">不设置默认</span> <span class="nf">是0</span>
</span></span><span class="line"><span class="cl"><span class="o">(</span><span class="n">integer</span><span class="o">)</span> <span class="n">0</span>
</span></span><span class="line"><span class="cl"><span class="n">127</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">1</span><span class="o">:</span><span class="n">6379</span><span class="o">&gt;</span> <span class="n">setbit</span> <span class="n">sign</span> <span class="n">3</span> <span class="nf">1</span>
</span></span><span class="line"><span class="cl"><span class="o">(</span><span class="n">integer</span><span class="o">)</span> <span class="n">0</span>
</span></span><span class="line"><span class="cl"><span class="n">127</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">1</span><span class="o">:</span><span class="n">6379</span><span class="o">&gt;</span> <span class="n">setbit</span> <span class="n">sign</span> <span class="n">5</span> <span class="nf">1</span>
</span></span><span class="line"><span class="cl"><span class="o">(</span><span class="n">integer</span><span class="o">)</span> <span class="n">0</span>
</span></span><span class="line"><span class="cl"><span class="n">127</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">1</span><span class="o">:</span><span class="n">6379</span><span class="o">&gt;</span> <span class="n">type</span> <span class="n">sign</span>
</span></span><span class="line"><span class="cl"><span class="n">string</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">127</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">1</span><span class="o">:</span><span class="n">6379</span><span class="o">&gt;</span> <span class="n">getbit</span> <span class="n">sign</span> <span class="n">2</span> <span class="err">#</span> <span class="n">获取第2位的数值</span>
</span></span><span class="line"><span class="cl"><span class="o">(</span><span class="n">integer</span><span class="o">)</span> <span class="n">1</span>
</span></span><span class="line"><span class="cl"><span class="n">127</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">1</span><span class="o">:</span><span class="n">6379</span><span class="o">&gt;</span> <span class="n">getbit</span> <span class="n">sign</span> <span class="nf">3</span>
</span></span><span class="line"><span class="cl"><span class="o">(</span><span class="n">integer</span><span class="o">)</span> <span class="n">1</span>
</span></span><span class="line"><span class="cl"><span class="n">127</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">1</span><span class="o">:</span><span class="n">6379</span><span class="o">&gt;</span> <span class="n">getbit</span> <span class="n">sign</span> <span class="n">4</span> <span class="err">#</span> <span class="n">未设置默认是0</span>
</span></span><span class="line"><span class="cl"><span class="o">(</span><span class="n">integer</span><span class="o">)</span> <span class="n">0</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">-----------</span><span class="n">bitcount</span><span class="o">----------------------------</span>
</span></span><span class="line"><span class="cl"><span class="n">127</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">1</span><span class="o">:</span><span class="n">6379</span><span class="o">&gt;</span> <span class="n">BITCOUNT</span> <span class="n">sign</span> <span class="err">#</span> <span class="n">统计sign中为1的位数</span>
</span></span><span class="line"><span class="cl"><span class="o">(</span><span class="n">integer</span><span class="o">)</span> <span class="n">4</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h1 id="redis事务">Redis事务</h1>
<h2 id="事务">事务：</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">Redis的单条命令是保证原子性的</span><span class="err">，</span><span class="n">但是redis事务不能保证原子性</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">Redis事务本质</span><span class="err">：</span><span class="n">一组命令的集合</span><span class="err">。</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">-----------------</span> <span class="n">队列</span> <span class="n">set</span> <span class="n">set</span> <span class="n">set</span> <span class="n">执行</span> <span class="o">-------------------</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">事务中每条命令都会被序列化</span><span class="err">，</span><span class="n">执行过程中按顺序执行</span><span class="err">，</span><span class="n">不允许其他命令进行干扰</span><span class="err">。</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">一次性</span>
</span></span><span class="line"><span class="cl"><span class="n">顺序性</span>
</span></span><span class="line"><span class="cl"><span class="n">排他性</span>
</span></span><span class="line"><span class="cl"><span class="n">Redis事务没有隔离级别的概念</span>
</span></span><span class="line"><span class="cl"><span class="n">Redis单条命令是保证原子性的</span><span class="err">，</span><span class="n">但是事务不保证原子性</span><span class="err">！</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="redis事务过程">Redis事务过程：</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">开启事务</span><span class="err">（</span><span class="n">multi</span><span class="err">）</span>
</span></span><span class="line"><span class="cl"><span class="n">命令入队</span>
</span></span><span class="line"><span class="cl"><span class="n">执行事务</span><span class="err">（</span><span class="n">exec</span><span class="err">）</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">所以事务中的命令在加入时都没有被执行</span><span class="err">，</span><span class="n">直到提交时才会开始执行</span><span class="o">(</span><span class="n">Exec</span><span class="o">)</span><span class="n">一次性完成</span><span class="err">。</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">127</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">1</span><span class="o">:</span><span class="n">6379</span><span class="o">&gt;</span> <span class="n">multi</span> <span class="err">#</span> <span class="n">开启事务</span>
</span></span><span class="line"><span class="cl"><span class="n">OK</span>
</span></span><span class="line"><span class="cl"><span class="n">127</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">1</span><span class="o">:</span><span class="n">6379</span><span class="o">&gt;</span> <span class="n">set</span> <span class="n">k1</span> <span class="n">v1</span> <span class="err">#</span> <span class="n">命令入队</span>
</span></span><span class="line"><span class="cl"><span class="n">QUEUED</span>
</span></span><span class="line"><span class="cl"><span class="n">127</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">1</span><span class="o">:</span><span class="n">6379</span><span class="o">&gt;</span> <span class="n">set</span> <span class="n">k2</span> <span class="n">v2</span> <span class="err">#</span> <span class="o">..</span>
</span></span><span class="line"><span class="cl"><span class="n">QUEUED</span>
</span></span><span class="line"><span class="cl"><span class="n">127</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">1</span><span class="o">:</span><span class="n">6379</span><span class="o">&gt;</span> <span class="n">get</span> <span class="n">k1</span>
</span></span><span class="line"><span class="cl"><span class="n">QUEUED</span>
</span></span><span class="line"><span class="cl"><span class="n">127</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">1</span><span class="o">:</span><span class="n">6379</span><span class="o">&gt;</span> <span class="n">set</span> <span class="n">k3</span> <span class="n">v3</span>
</span></span><span class="line"><span class="cl"><span class="n">QUEUED</span>
</span></span><span class="line"><span class="cl"><span class="n">127</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">1</span><span class="o">:</span><span class="n">6379</span><span class="o">&gt;</span> <span class="n">keys</span> <span class="o">*</span>
</span></span><span class="line"><span class="cl"><span class="n">QUEUED</span>
</span></span><span class="line"><span class="cl"><span class="n">127</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">1</span><span class="o">:</span><span class="n">6379</span><span class="o">&gt;</span> <span class="n">exec</span> <span class="err">#</span> <span class="n">事务执行</span>
</span></span><span class="line"><span class="cl"><span class="n">1</span><span class="o">)</span> <span class="n">OK</span>
</span></span><span class="line"><span class="cl"><span class="n">2</span><span class="o">)</span> <span class="n">OK</span>
</span></span><span class="line"><span class="cl"><span class="n">3</span><span class="o">)</span> <span class="s">&#34;v1&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">4</span><span class="o">)</span> <span class="n">OK</span>
</span></span><span class="line"><span class="cl"><span class="n">5</span><span class="o">)</span> <span class="n">1</span><span class="o">)</span> <span class="s">&#34;k3&#34;</span>
</span></span><span class="line"><span class="cl">   <span class="n">2</span><span class="o">)</span> <span class="s">&#34;k2&#34;</span>
</span></span><span class="line"><span class="cl">   <span class="n">3</span><span class="o">)</span> <span class="s">&#34;k1&#34;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="取消事务discard">取消事务(DISCARD)：</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">127</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">1</span><span class="o">:</span><span class="n">6379</span><span class="o">&gt;</span> <span class="n">multi</span>
</span></span><span class="line"><span class="cl"><span class="n">OK</span>
</span></span><span class="line"><span class="cl"><span class="n">127</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">1</span><span class="o">:</span><span class="n">6379</span><span class="o">&gt;</span> <span class="n">set</span> <span class="n">k1</span> <span class="n">v1</span>
</span></span><span class="line"><span class="cl"><span class="n">QUEUED</span>
</span></span><span class="line"><span class="cl"><span class="n">127</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">1</span><span class="o">:</span><span class="n">6379</span><span class="o">&gt;</span> <span class="n">set</span> <span class="n">k2</span> <span class="n">v2</span>
</span></span><span class="line"><span class="cl"><span class="n">QUEUED</span>
</span></span><span class="line"><span class="cl"><span class="n">127</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">1</span><span class="o">:</span><span class="n">6379</span><span class="o">&gt;</span> <span class="n">DISCARD</span> <span class="err">#</span> <span class="n">放弃事务</span>
</span></span><span class="line"><span class="cl"><span class="n">OK</span>
</span></span><span class="line"><span class="cl"><span class="n">127</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">1</span><span class="o">:</span><span class="n">6379</span><span class="o">&gt;</span> <span class="nf">EXEC</span> 
</span></span><span class="line"><span class="cl"><span class="o">(</span><span class="n">error</span><span class="o">)</span> <span class="n">ERR</span> <span class="n">EXEC</span> <span class="n">without</span> <span class="n">MULTI</span> <span class="err">#</span> <span class="n">当前未开启事务</span>
</span></span><span class="line"><span class="cl"><span class="n">127</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">1</span><span class="o">:</span><span class="n">6379</span><span class="o">&gt;</span> <span class="n">get</span> <span class="n">k1</span> <span class="err">#</span> <span class="n">被放弃事务中命令并未执行</span>
</span></span><span class="line"><span class="cl"><span class="o">(</span><span class="n">nil</span><span class="o">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="事务错误">事务错误</h2>
<h3 id="1代码语法错误编译时异常所有的命令都不执行">1.代码语法错误（编译时异常）所有的命令都不执行</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">127</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">1</span><span class="o">:</span><span class="n">6379</span><span class="o">&gt;</span> <span class="n">multi</span>
</span></span><span class="line"><span class="cl"><span class="n">OK</span>
</span></span><span class="line"><span class="cl"><span class="n">127</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">1</span><span class="o">:</span><span class="n">6379</span><span class="o">&gt;</span> <span class="n">set</span> <span class="n">k1</span> <span class="n">v1</span>
</span></span><span class="line"><span class="cl"><span class="n">QUEUED</span>
</span></span><span class="line"><span class="cl"><span class="n">127</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">1</span><span class="o">:</span><span class="n">6379</span><span class="o">&gt;</span> <span class="n">set</span> <span class="n">k2</span> <span class="n">v2</span>
</span></span><span class="line"><span class="cl"><span class="n">QUEUED</span>
</span></span><span class="line"><span class="cl"><span class="n">127</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">1</span><span class="o">:</span><span class="n">6379</span><span class="o">&gt;</span> <span class="n">error</span> <span class="n">k1</span> <span class="err">#</span> <span class="n">这是一条语法错误命令</span>
</span></span><span class="line"><span class="cl"><span class="o">(</span><span class="n">error</span><span class="o">)</span> <span class="n">ERR</span> <span class="n">unknown</span> <span class="n">command</span> <span class="err">`</span><span class="n">error</span><span class="err">`</span><span class="o">,</span> <span class="n">with</span> <span class="n">args</span> <span class="n">beginning</span> <span class="n">with</span><span class="o">:</span> <span class="err">`</span><span class="n">k1</span><span class="err">`</span><span class="o">,</span> <span class="err">#</span> <span class="n">会报错但是不影响后续命令入队</span> 
</span></span><span class="line"><span class="cl"><span class="n">127</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">1</span><span class="o">:</span><span class="n">6379</span><span class="o">&gt;</span> <span class="n">get</span> <span class="n">k2</span>
</span></span><span class="line"><span class="cl"><span class="n">QUEUED</span>
</span></span><span class="line"><span class="cl"><span class="n">127</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">1</span><span class="o">:</span><span class="n">6379</span><span class="o">&gt;</span> <span class="nf">EXEC</span>
</span></span><span class="line"><span class="cl"><span class="o">(</span><span class="n">error</span><span class="o">)</span> <span class="n">EXECABORT</span> <span class="n">Transaction</span> <span class="n">discarded</span> <span class="n">because</span> <span class="n">of</span> <span class="n">previous</span> <span class="n">errors</span><span class="o">.</span> <span class="err">#</span> <span class="n">执行报错</span>
</span></span><span class="line"><span class="cl"><span class="n">127</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">1</span><span class="o">:</span><span class="n">6379</span><span class="o">&gt;</span> <span class="n">get</span> <span class="nf">k1</span> 
</span></span><span class="line"><span class="cl"><span class="o">(</span><span class="n">nil</span><span class="o">)</span> <span class="err">#</span> <span class="n">其他命令并没有被执行</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="2代码逻辑错误-运行时异常-其他命令可以正常执行---所以不保证事务原子性">2.代码逻辑错误 (运行时异常) **其他命令可以正常执行 ** &raquo;&gt; 所以不保证事务原子性</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">127</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">1</span><span class="o">:</span><span class="n">6379</span><span class="o">&gt;</span> <span class="n">multi</span>
</span></span><span class="line"><span class="cl"><span class="n">OK</span>
</span></span><span class="line"><span class="cl"><span class="n">127</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">1</span><span class="o">:</span><span class="n">6379</span><span class="o">&gt;</span> <span class="n">set</span> <span class="n">k1</span> <span class="n">v1</span>
</span></span><span class="line"><span class="cl"><span class="n">QUEUED</span>
</span></span><span class="line"><span class="cl"><span class="n">127</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">1</span><span class="o">:</span><span class="n">6379</span><span class="o">&gt;</span> <span class="n">set</span> <span class="n">k2</span> <span class="n">v2</span>
</span></span><span class="line"><span class="cl"><span class="n">QUEUED</span>
</span></span><span class="line"><span class="cl"><span class="n">127</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">1</span><span class="o">:</span><span class="n">6379</span><span class="o">&gt;</span> <span class="n">INCR</span> <span class="n">k1</span> <span class="err">#</span> <span class="n">这条命令逻辑错误</span><span class="err">（</span><span class="n">对字符串进行增量</span><span class="err">）</span>
</span></span><span class="line"><span class="cl"><span class="n">QUEUED</span>
</span></span><span class="line"><span class="cl"><span class="n">127</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">1</span><span class="o">:</span><span class="n">6379</span><span class="o">&gt;</span> <span class="n">get</span> <span class="n">k2</span>
</span></span><span class="line"><span class="cl"><span class="n">QUEUED</span>
</span></span><span class="line"><span class="cl"><span class="n">127</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">1</span><span class="o">:</span><span class="n">6379</span><span class="o">&gt;</span> <span class="n">exec</span>
</span></span><span class="line"><span class="cl"><span class="n">1</span><span class="o">)</span> <span class="n">OK</span>
</span></span><span class="line"><span class="cl"><span class="n">2</span><span class="o">)</span> <span class="n">OK</span>
</span></span><span class="line"><span class="cl"><span class="n">3</span><span class="o">)</span> <span class="o">(</span><span class="n">error</span><span class="o">)</span> <span class="n">ERR</span> <span class="n">value</span> <span class="n">is</span> <span class="n">not</span> <span class="n">an</span> <span class="n">integer</span> <span class="n">or</span> <span class="n">out</span> <span class="n">of</span> <span class="n">range</span> <span class="err">#</span> <span class="n">运行时报错</span>
</span></span><span class="line"><span class="cl"><span class="n">4</span><span class="o">)</span> <span class="s">&#34;v2&#34;</span> <span class="err">#</span> <span class="n">其他命令正常执行</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="err">#</span> <span class="n">虽然中间有一条命令报错了</span><span class="err">，</span><span class="n">但是后面的指令依旧正常执行成功了</span><span class="err">。</span>
</span></span><span class="line"><span class="cl"><span class="err">#</span> <span class="n">所以说Redis单条指令保证原子性</span><span class="err">，</span><span class="n">但是Redis事务不能保证原子性</span><span class="err">。</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h1 id="监控">监控</h1>
<h2 id="乐观锁">乐观锁：</h2>
<p>使用watch key监控指定数据，相当于乐观锁加锁。</p>
<h3 id="1-正常执行">1. 正常执行</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">127</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">1</span><span class="o">:</span><span class="n">6379</span><span class="o">&gt;</span> <span class="n">set</span> <span class="n">money</span> <span class="n">100</span> <span class="err">#</span> <span class="n">设置余额</span><span class="o">:</span><span class="n">100</span>
</span></span><span class="line"><span class="cl"><span class="n">OK</span>
</span></span><span class="line"><span class="cl"><span class="n">127</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">1</span><span class="o">:</span><span class="n">6379</span><span class="o">&gt;</span> <span class="n">set</span> <span class="n">use</span> <span class="n">0</span> <span class="err">#</span> <span class="n">支出使用</span><span class="o">:</span><span class="n">0</span>
</span></span><span class="line"><span class="cl"><span class="n">OK</span>
</span></span><span class="line"><span class="cl"><span class="n">127</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">1</span><span class="o">:</span><span class="n">6379</span><span class="o">&gt;</span> <span class="n">watch</span> <span class="n">money</span> <span class="err">#</span> <span class="n">监视money</span> <span class="o">(</span><span class="n">上锁</span><span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="n">OK</span>
</span></span><span class="line"><span class="cl"><span class="n">127</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">1</span><span class="o">:</span><span class="n">6379</span><span class="o">&gt;</span> <span class="n">multi</span>
</span></span><span class="line"><span class="cl"><span class="n">OK</span>
</span></span><span class="line"><span class="cl"><span class="n">127</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">1</span><span class="o">:</span><span class="n">6379</span><span class="o">&gt;</span> <span class="n">DECRBY</span> <span class="n">money</span> <span class="n">20</span>
</span></span><span class="line"><span class="cl"><span class="n">QUEUED</span>
</span></span><span class="line"><span class="cl"><span class="n">127</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">1</span><span class="o">:</span><span class="n">6379</span><span class="o">&gt;</span> <span class="n">INCRBY</span> <span class="n">use</span> <span class="n">20</span>
</span></span><span class="line"><span class="cl"><span class="n">QUEUED</span>
</span></span><span class="line"><span class="cl"><span class="n">127</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">1</span><span class="o">:</span><span class="n">6379</span><span class="o">&gt;</span> <span class="n">exec</span> <span class="err">#</span> <span class="n">监视值没有被中途修改</span><span class="err">，</span><span class="n">事务正常执行</span>
</span></span><span class="line"><span class="cl"><span class="n">1</span><span class="o">)</span> <span class="o">(</span><span class="n">integer</span><span class="o">)</span> <span class="n">80</span>
</span></span><span class="line"><span class="cl"><span class="n">2</span><span class="o">)</span> <span class="o">(</span><span class="n">integer</span><span class="o">)</span> <span class="n">20</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="2多线程测试">2.多线程测试</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">线程1</span><span class="err">：</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">127</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">1</span><span class="o">:</span><span class="n">6379</span><span class="o">&gt;</span> <span class="n">watch</span> <span class="n">money</span> <span class="err">#</span> <span class="n">money上锁</span>
</span></span><span class="line"><span class="cl"><span class="n">OK</span>
</span></span><span class="line"><span class="cl"><span class="n">127</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">1</span><span class="o">:</span><span class="n">6379</span><span class="o">&gt;</span> <span class="n">multi</span>
</span></span><span class="line"><span class="cl"><span class="n">OK</span>
</span></span><span class="line"><span class="cl"><span class="n">127</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">1</span><span class="o">:</span><span class="n">6379</span><span class="o">&gt;</span> <span class="n">DECRBY</span> <span class="n">money</span> <span class="n">20</span>
</span></span><span class="line"><span class="cl"><span class="n">QUEUED</span>
</span></span><span class="line"><span class="cl"><span class="n">127</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">1</span><span class="o">:</span><span class="n">6379</span><span class="o">&gt;</span> <span class="n">INCRBY</span> <span class="n">use</span> <span class="n">20</span>
</span></span><span class="line"><span class="cl"><span class="n">QUEUED</span>
</span></span><span class="line"><span class="cl"><span class="n">127</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">1</span><span class="o">:</span><span class="n">6379</span><span class="o">&gt;</span>     <span class="err">#</span> <span class="n">此时事务并没有执行</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">模拟线程插队</span><span class="err">，</span><span class="n">线程2</span><span class="err">：</span>
</span></span><span class="line"><span class="cl"><span class="n">127</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">1</span><span class="o">:</span><span class="n">6379</span><span class="o">&gt;</span> <span class="n">INCRBY</span> <span class="n">money</span> <span class="n">500</span> <span class="err">#</span> <span class="n">修改了线程一中监视的money</span>
</span></span><span class="line"><span class="cl"><span class="o">(</span><span class="n">integer</span><span class="o">)</span> <span class="n">600</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">回到线程1</span><span class="err">，</span><span class="n">执行事务</span><span class="err">：</span>
</span></span><span class="line"><span class="cl"><span class="n">127</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">1</span><span class="o">:</span><span class="n">6379</span><span class="o">&gt;</span> <span class="n">EXEC</span> <span class="err">#</span> <span class="n">执行之前</span><span class="err">，</span><span class="n">另一个线程修改了我们的值</span><span class="err">，</span><span class="n">这个时候就会导致事务执行失败</span>
</span></span><span class="line"><span class="cl"><span class="o">(</span><span class="n">nil</span><span class="o">)</span> <span class="err">#</span> <span class="n">没有结果</span><span class="err">，</span><span class="n">说明事务执行失败</span>
</span></span><span class="line"><span class="cl"><span class="n">127</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">1</span><span class="o">:</span><span class="n">6379</span><span class="o">&gt;</span> <span class="n">get</span> <span class="n">money</span> <span class="err">#</span> <span class="n">线程2</span> <span class="n">修改生效</span>
</span></span><span class="line"><span class="cl"><span class="s">&#34;600&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">127</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">1</span><span class="o">:</span><span class="n">6379</span><span class="o">&gt;</span> <span class="n">get</span> <span class="n">use</span> <span class="err">#</span> <span class="n">线程1事务执行失败</span><span class="err">，</span><span class="n">数值没有被修改</span>
</span></span><span class="line"><span class="cl"><span class="s">&#34;0&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">解锁获取最新值</span><span class="err">，</span><span class="n">然后再加锁进行事务</span><span class="err">。</span>
</span></span><span class="line"><span class="cl"><span class="n">unwatch进行解锁</span><span class="err">。</span>
</span></span><span class="line"><span class="cl"><span class="n">注意</span><span class="err">：</span><span class="n">每次提交执行exec后都会自动释放锁</span><span class="err">，</span><span class="n">不管是否成功</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h1 id="缓存穿透缓存击穿缓存雪崩">缓存穿透、缓存击穿、缓存雪崩</h1>
<h2 id="缓存穿透">缓存穿透</h2>
<h3 id="概念">概念：</h3>
<p>在默认情况下，用户请求数据时，会先在缓存(Redis)中查找，若没找到即缓存未命中，再在数据库中进行查找，数量少可能问题不大，可是一旦大量的请求数据（例如秒杀场景）缓存都没有命中的话，就会全部转移到数据库上，造成数据库极大的压力，就有可能导致数据库崩溃。网络安全中也有人恶意使用这种手段进行攻击被称为洪水攻击。</p>
<h3 id="解决方案">解决方案：</h3>
<h4 id="1布隆过滤器">1.布隆过滤器</h4>
<p><strong>布隆过滤器解决方法：</strong></p>
<p>将数据库中所有的查询条件，放入布隆过滤器中，当一个查询请求过来时，先经过布隆过滤器进行查，如果判断请求查询值存在，则继续查；如果判断请求查询不存在，直接丢弃。</p>
<p><strong>布隆过滤器原理</strong></p>
<p>原理就是一个对一个key进行k个hash算法获取k个值，在比特数组中将这k个值散列后设定为1，然后查的时候如果特定的这几个位置都为1，那么布隆过滤器判断该key存在。布隆过滤器可能会误判，如果它说不存在那肯定不存在，如果它说存在，那数据有可能实际不存在；Redis的bitmap只支持2^32大小，对应到内存也就是512MB，误判率万分之一，可以放下2亿左右的数据，性能高，空间占用率及小，省去了大量无效的数据库连接。</p>
<p>因此我们可以通过布隆过滤器，将Redis缓存穿透控制在一个可容范围内。布隆过滤器可以判断某个数据一定不存在，但是无法判断一定存在。</p>
<h2 id="缓存击穿">缓存击穿</h2>
<h3 id="概念-1">概念：</h3>
<p>相较于缓存穿透，缓存击穿的目的性更强，一个存在的key，在缓存过期的一刻，同时有大量的请求，这些请求都会击穿到DB，造成瞬时DB请求量大、压力骤增。这就是缓存被击穿，只是针对其中某个key的缓存不可用而导致击穿，但是其他的key依然可以使用缓存响应。 比如热搜排行上，一个热点新闻被同时大量访问就可能导致缓存击穿。</p>
<h3 id="解决方案-1">解决方案：</h3>
<h4 id="1设置热点数据永不过期">1.设置热点数据永不过期</h4>
<p>这样就不会出现热点数据过期的情况，但是当Redis内存空间满的时候也会清理部分数据，而且此种方案会占用空间，一旦热点数据多了起来，就会占用部分空间。</p>
<p>在访问key之前，采用SETNX（set if not exists）来设置另一个短期key来锁住当前key的访问，访问结束再删除该短期key。保证同时刻只有一个线程访问。这样对锁的要求就十分高。</p>
<h2 id="缓存雪崩">缓存雪崩</h2>
<h3 id="概念-2">概念：</h3>
<p>大量的key设置了相同的过期时间，导致在缓存在同一时刻全部失效，造成瞬时DB请求量大、压力骤增，引起雪崩。</p>
<h3 id="解决方案-2">解决方案：</h3>
<h4 id="1redis高可用">1.redis高可用</h4>
<p>这个思想的含义是，既然redis有可能挂掉，那我多增设几台redis，这样一台挂掉之后其他的还可以继续工作，其实就是搭建的集群</p>
<h4 id="2限流降级">2.限流降级</h4>
<p>这个解决方案的思想是，在缓存失效后，通过加锁或者队列来控制读数据库写缓存的线程数量。比如对某个key只允许一个线程查询数据和写缓存，其他线程等待。</p>
<h4 id="3数据预热">3.数据预热</h4>
<p>数据加热的含义就是在正式部署之前，我先把可能的数据先预先访问一遍，这样部分可能大量访问的数据就会加载到缓存中。在即将发生大并发访问前手动触发加载缓存不同的key，设置不同的过期时间，让缓存失效的时间点尽量均匀。</p>
<h1 id="redis主从复制">Redis主从复制</h1>
<h2 id="概念-3">概念</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">主从复制，是指将一台Redis服务器的数据，复制到其他的Redis服务器。前者称为主节点（Master/Leader）,后者称为从节点（Slave/Follower）， 数据的复制是单向的！只能由主节点复制到从节点（主节点以写为主、从节点以读为主）。
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">默认情况下，每台Redis服务器都是主节点，一个主节点可以有0个或者多个从节点，但每个从节点只能由一个主节点。
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="开启多个redis服务一主二从">开启多个redis服务（一主二从）</h2>
<h3 id="1去阿里云添加安全组规则开放637963806381端口号开放linux防火墙端口号">1.去阿里云添加安全组规则，开放6379/6380/6381端口号，开放linux防火墙端口号</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="c1"># 开放linux防火墙（6379/6380/6381）端口号：</span>
</span></span><span class="line"><span class="cl">firewall-cmd --permanent --add-port<span class="o">=</span>6379/tcp
</span></span><span class="line"><span class="cl">firewall-cmd --permanent --add-port<span class="o">=</span>6380/tcp
</span></span><span class="line"><span class="cl">firewall-cmd --permanent --add-port<span class="o">=</span>6381/tcp
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="2复制redisconf-到-redis-6380confredis-6381conf">2.复制redis.conf 到 redis-6380.conf，redis-6381.conf</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="c1"># 首先进入redis.conf的目录下，使用以下两个命令可以找到redis.conf的目录 </span>
</span></span><span class="line"><span class="cl">  ps -aux<span class="p">|</span>grep redis
</span></span><span class="line"><span class="cl">  ls -l /proc/进程号/cwd
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 然后复制redis.conf，命令如下</span>
</span></span><span class="line"><span class="cl">  cp redis.conf redis-6380.conf
</span></span><span class="line"><span class="cl">  cp redis.conf redis-6381.conf
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="3修改-redis-6380confredis-6381conf信息主要三个信息">3.修改 redis-6380.conf，redis-6381.conf信息（主要三个信息）</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">分别是</span> <span class="n">pid</span><span class="err">，</span><span class="n">port端口号和slaveof</span> <span class="n">127</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">1</span> <span class="n">6379</span>
</span></span><span class="line"><span class="cl"><span class="n">用vim命令进入</span> <span class="n">redis</span><span class="o">-</span><span class="n">6380</span><span class="o">.</span><span class="na">conf配置文件后</span><span class="err">，</span><span class="n">命令模式下输入</span><span class="o">/</span><span class="n">pid查找pid并修改</span><span class="err">，</span><span class="n">slaveof</span> <span class="n">xxx需要手动填写</span>   
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">pidfile</span> <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">run</span><span class="o">/</span><span class="n">redis</span><span class="o">-</span><span class="n">6380</span><span class="o">.</span><span class="na">pid</span>
</span></span><span class="line"><span class="cl"><span class="n">port</span> <span class="n">6380</span>
</span></span><span class="line"><span class="cl"><span class="n">slaveof</span> <span class="n">127</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">1</span> <span class="n">6379</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="4启动redis服务三个端口号">4.启动redis服务（三个端口号）</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">启动6379服务</span><span class="err">：</span><span class="n">redis</span><span class="o">-</span><span class="n">server</span> <span class="n">redis</span><span class="o">.</span><span class="na">conf</span>          <span class="n">redis</span><span class="o">-</span><span class="n">cli</span> <span class="o">-</span><span class="n">p</span> <span class="n">6379</span>
</span></span><span class="line"><span class="cl"><span class="n">启动6380服务</span><span class="err">：</span><span class="n">redis</span><span class="o">-</span><span class="n">server</span> <span class="n">redis</span><span class="o">-</span><span class="n">6380</span><span class="o">.</span><span class="na">conf</span>     <span class="n">redis</span><span class="o">-</span><span class="n">cli</span> <span class="o">-</span><span class="n">p</span> <span class="n">6380</span>
</span></span><span class="line"><span class="cl"><span class="n">启动6381服务</span><span class="err">：</span><span class="n">redis</span><span class="o">-</span><span class="n">server</span> <span class="n">redis</span><span class="o">-</span><span class="n">6381</span><span class="o">.</span><span class="na">conf</span>     <span class="n">redis</span><span class="o">-</span><span class="n">cli</span> <span class="o">-</span><span class="n">p</span> <span class="n">6381</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="5查看信息">5.查看信息</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">info</span> <span class="n">replication</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="6遇到master_link_status为down情况">6.遇到master_link_status为down情况</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">进入redis</span><span class="o">-</span><span class="n">6380</span><span class="o">.</span><span class="na">conf</span><span class="err">，</span><span class="n">redis</span><span class="o">-</span><span class="n">6381</span><span class="o">.</span><span class="na">conf配置文件中</span><span class="err">，</span><span class="n">修改如下两个配置</span>
</span></span><span class="line"><span class="cl"><span class="n">1</span><span class="o">.</span><span class="na">修改replicaof</span> <span class="o">&lt;</span><span class="n">masterip</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">masterport</span><span class="o">&gt;</span><span class="n">为</span><span class="err">（</span><span class="n">主机IP和端口号</span><span class="err">）</span>
</span></span><span class="line"><span class="cl">  <span class="n">replicaof</span> <span class="n">127</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">1</span> <span class="n">6379</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">2</span><span class="o">.</span><span class="na">修改masterauth</span> <span class="o">&lt;</span><span class="n">master</span><span class="o">-</span><span class="n">password</span><span class="o">&gt;</span><span class="n">为</span>
</span></span><span class="line"><span class="cl">  <span class="n">masterauth</span> <span class="nf">redis123</span> <span class="o">(</span><span class="n">主机密码和从机密码设置相同</span><span class="o">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h1 id="redis哨兵模式">Redis哨兵模式</h1>
<h2 id="复制sentinelconf到自己目录下">复制sentinel.conf到自己目录下</h2>
<h3 id="安装好的redis源码默认含有redisconf文件和sentinelconf文件">安装好的redis源码默认含有redis.conf文件和sentinel.conf文件</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">将</span><span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">redis</span><span class="o">-</span><span class="n">6</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">6下的两个配置文件复制到自己的目录下</span><span class="err">（</span><span class="n">ycconfig</span><span class="err">）</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">cp</span> <span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">redis</span><span class="o">-</span><span class="n">6</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">6</span><span class="o">/</span><span class="n">redis</span><span class="o">.</span><span class="na">conf</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">ycconfig</span><span class="o">/</span>
</span></span><span class="line"><span class="cl"><span class="n">cp</span> <span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">redis</span><span class="o">-</span><span class="n">6</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">6</span><span class="o">/</span><span class="n">sentinel</span><span class="o">.</span><span class="na">conf</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">ycconfig</span><span class="o">/</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="复制sentinelconf到sentinel-26380confsentinel-23681conf">复制sentinel.conf到sentinel-26380.conf，sentinel-23681.conf</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">cp</span> <span class="n">sentinel</span><span class="o">.</span><span class="na">conf</span> <span class="n">sentinel</span><span class="o">-</span><span class="n">26380</span><span class="o">.</span><span class="na">conf</span>
</span></span><span class="line"><span class="cl"><span class="n">cp</span> <span class="n">sentinel</span><span class="o">.</span><span class="na">conf</span> <span class="n">sentinel</span><span class="o">-</span><span class="n">26381</span><span class="o">.</span><span class="na">conf</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="修改sentinelconf配置文件主要修改5处其他redis默认的一般不修改">修改sentinel.conf配置文件（主要修改5处，其他redis默认的一般不修改）</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">port</span> <span class="n">26379</span>  
</span></span><span class="line"><span class="cl"><span class="n">哨兵sentinel实例运行的端口</span><span class="err">，</span><span class="n">默认26379</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">daemonize</span> <span class="nf">yes</span><span class="o">(</span><span class="n">默认是no</span><span class="o">)</span>  
</span></span><span class="line"><span class="cl"><span class="n">redis默认不是以守护进程的方式运行</span><span class="err">，</span><span class="n">可以通过该配置项修改</span><span class="err">，</span><span class="n">使用yes启用守护进程</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">pidfile</span> <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">run</span><span class="o">/</span><span class="n">redis</span><span class="o">-</span><span class="n">sentinel</span><span class="o">.</span><span class="na">pid</span>
</span></span><span class="line"><span class="cl"><span class="n">当redis以守护进程方式运行时</span><span class="err">，</span><span class="n">redis默认会把pid写入</span><span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">run</span><span class="o">/</span><span class="n">redis</span><span class="o">-</span><span class="n">sentinel</span><span class="o">.</span><span class="na">pid文件</span><span class="err">，</span><span class="n">可以通过pidfile指定</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">logfile</span> <span class="s">&#34;/usr/local/bin/ycconfig/sentinel-26379.log&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">指定日志文件名</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">sentinel</span> <span class="n">auth</span><span class="o">-</span><span class="n">pass</span> <span class="n">mymaster</span> <span class="n">redis123</span>
</span></span><span class="line"><span class="cl"><span class="n">设置主的密码</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">sentinel</span> <span class="n">monitor</span> <span class="n">mymaster</span> <span class="n">127</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">1</span> <span class="n">6379</span> <span class="n">2</span> <span class="err">（</span><span class="n">redis默认配置</span><span class="err">）</span>
</span></span><span class="line"><span class="cl"><span class="n">mymaster名字可以自定义</span><span class="err">，</span><span class="n">ip地址为master节点的地址</span> <span class="n">后边的</span> <span class="n">2</span> <span class="n">代表的是</span><span class="err">，</span><span class="n">如果有俩个哨兵判断这个主节点挂了那这个主节点就挂了</span><span class="err">，</span><span class="n">通常设置为哨兵个数一半加一</span><span class="err">。</span>
</span></span><span class="line"><span class="cl"><span class="n">只有当半数以上的slave节点认为master节点宕机了</span><span class="o">,</span><span class="n">才会进行选举master节点</span><span class="o">,</span><span class="n">否则不会进行选举</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">sentinel</span> <span class="n">down</span><span class="o">-</span><span class="n">after</span><span class="o">-</span><span class="n">milliseconds</span> <span class="n">mymaster</span> <span class="nf">30000</span> <span class="o">(</span><span class="n">redis默认配置</span><span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="n">哨兵连接主节点多长时间没有响应就代表挂了</span><span class="err">。</span><span class="n">后边</span> <span class="n">30000</span> <span class="n">是毫秒</span><span class="err">，</span><span class="n">也就是</span> <span class="n">30</span> <span class="n">秒</span><span class="err">。</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">sentinel</span> <span class="n">parallel</span><span class="o">-</span><span class="n">syncs</span> <span class="n">mymaster</span> <span class="n">1</span> <span class="err">（</span><span class="n">redis默认配置</span><span class="err">）</span>
</span></span><span class="line"><span class="cl"><span class="n">这个配置项是指在故障转移时</span><span class="err">，</span><span class="n">最多有多少个从节点对新的主节点进行同步</span><span class="o">,</span><span class="n">这个值越小完成故障转移的时间就越长</span><span class="err">，</span><span class="n">这个值越大就意味着越多的从节点因为同步数据而不可用</span><span class="o">,</span><span class="n">可以通过将这个值设为</span> <span class="n">1</span> <span class="n">来保证每次只有一个slave</span> <span class="n">处于不能处理命令请求的状态</span><span class="err">。</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">sentinel</span> <span class="n">failover</span><span class="o">-</span><span class="n">timeout</span> <span class="n">mymaster</span> <span class="n">180000</span>  <span class="err">（</span><span class="n">redis默认配置</span><span class="err">）</span>
</span></span><span class="line"><span class="cl"><span class="n">1</span><span class="o">.</span> <span class="n">同一个sentinel对同一个master两次failover之间的间隔时间</span><span class="err">。</span>
</span></span><span class="line"><span class="cl"><span class="n">2</span><span class="o">.</span> <span class="n">当一个slave从一个错误的master那里同步数据开始计算时间</span><span class="err">。</span><span class="n">直到slave被纠正为向正确的master那里同步数据时</span><span class="err">。</span>
</span></span><span class="line"><span class="cl"><span class="n">3</span><span class="o">.</span><span class="na">当想要取消一个正在进行的failover所需要的时间</span><span class="err">。</span>
</span></span><span class="line"><span class="cl"><span class="n">4</span><span class="o">.</span><span class="na">当进行failover时</span><span class="err">，</span><span class="n">配置所有slaves指向新的master所需的最大时间</span><span class="err">。</span><span class="n">不过</span><span class="err">，</span><span class="n">即使过了这个超时</span><span class="err">，</span><span class="n">slaves依然会被正确配置为指向master</span><span class="err">，</span><span class="n">但是就不按parallel</span><span class="o">-</span><span class="n">syncs所配置的规则来了</span><span class="err">。</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="启动redis哨兵服务">启动redis哨兵服务</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">redis-sentinel sentienl.conf        <span class="o">(</span>启动26379端口哨兵，两个步骤<span class="o">)</span>
</span></span><span class="line"><span class="cl">    redis-cli -p <span class="m">26379</span>
</span></span><span class="line"><span class="cl">redis-sentinel sentienl-26380.conf  <span class="o">(</span>启动26380端口哨兵，两个步骤<span class="o">)</span>
</span></span><span class="line"><span class="cl">    redis-cli -p <span class="m">26380</span>
</span></span><span class="line"><span class="cl">redis-sentinel sentienl-26381.conf  <span class="o">(</span>启动26381端口哨兵，两个步骤<span class="o">)</span>
</span></span><span class="line"><span class="cl">    redis-cli -p <span class="m">26381</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="查看哨兵信息">查看哨兵信息</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">info sentinel
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">127.0.0.1:26379&gt; info sentinel
</span></span><span class="line"><span class="cl"><span class="c1"># Sentinel</span>
</span></span><span class="line"><span class="cl">sentinel_masters:1
</span></span><span class="line"><span class="cl">sentinel_tilt:0
</span></span><span class="line"><span class="cl">sentinel_running_scripts:0
</span></span><span class="line"><span class="cl">sentinel_scripts_queue_length:0
</span></span><span class="line"><span class="cl">sentinel_simulate_failure_flags:0
</span></span><span class="line"><span class="cl">master0:name<span class="o">=</span>mymaster,status<span class="o">=</span>ok,address<span class="o">=</span>127.0.0.1:6379,slaves<span class="o">=</span>2,sentinels<span class="o">=</span><span class="m">1</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="测试哨兵模式">测试哨兵模式</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="o">[</span>root@yc ~<span class="o">]</span><span class="c1"># ps -ef|grep redis  （找到主机进程号）</span>
</span></span><span class="line"><span class="cl">root      <span class="m">7390</span>     <span class="m">1</span>  <span class="m">0</span> Mar17 ?        00:04:03 redis-server 127.0.0.1:6380
</span></span><span class="line"><span class="cl">root      <span class="m">7647</span>     <span class="m">1</span>  <span class="m">0</span> Mar17 ?        00:04:28 redis-server 127.0.0.1:6379
</span></span><span class="line"><span class="cl">root      <span class="m">7837</span>     <span class="m">1</span>  <span class="m">0</span> Mar17 ?        00:04:03 redis-server 127.0.0.1:6381
</span></span><span class="line"><span class="cl">root     <span class="m">14885</span>     <span class="m">1</span>  <span class="m">0</span> 11:06 ?        00:00:03 redis-sentinel *:26379 <span class="o">[</span>sentinel<span class="o">]</span>
</span></span><span class="line"><span class="cl">root     <span class="m">15311</span>     <span class="m">1</span>  <span class="m">0</span> 11:14 ?        00:00:02 redis-sentinel *:26380 <span class="o">[</span>sentinel<span class="o">]</span>
</span></span><span class="line"><span class="cl">root     <span class="m">15323</span>  <span class="m">9975</span>  <span class="m">0</span> 11:14 pts/0    00:00:00 redis-cli -p <span class="m">26380</span>
</span></span><span class="line"><span class="cl">root     <span class="m">15436</span>     <span class="m">1</span>  <span class="m">0</span> 11:16 ?        00:00:01 redis-sentinel *:26381 <span class="o">[</span>sentinel<span class="o">]</span>
</span></span><span class="line"><span class="cl">root     <span class="m">15449</span>  <span class="m">9997</span>  <span class="m">0</span> 11:16 pts/2    00:00:00 redis-cli -p <span class="m">26381</span>
</span></span><span class="line"><span class="cl">root     <span class="m">15874</span>  <span class="m">9069</span>  <span class="m">0</span> 11:25 pts/1    00:00:00 redis-cli -p <span class="m">6379</span>
</span></span><span class="line"><span class="cl">root     <span class="m">15921</span> <span class="m">15892</span>  <span class="m">0</span> 11:26 pts/3    00:00:00 grep --color<span class="o">=</span>auto redis
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">[</span>root@yc ~<span class="o">]</span><span class="c1"># kill -9 7647  （杀死主机进程）</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">127.0.0.1:6381&gt; info replication  （查看6381端口信息，发现角色从slave变为master）
</span></span><span class="line"><span class="cl"><span class="c1"># Replication</span>
</span></span><span class="line"><span class="cl">role:master
</span></span><span class="line"><span class="cl">connected_slaves:1
</span></span><span class="line"><span class="cl">slave0:ip<span class="o">=</span>127.0.0.1,port<span class="o">=</span>6380,state<span class="o">=</span>online,offset<span class="o">=</span>417612,lag<span class="o">=</span><span class="m">0</span>
</span></span><span class="line"><span class="cl">master_replid:d3597e4133704dfe6b60c8103b5fc7174d480a4b
</span></span><span class="line"><span class="cl">master_replid2:1447d768216f7530d3f885ae67f6529cfc593d02
</span></span><span class="line"><span class="cl">master_repl_offset:417745
</span></span><span class="line"><span class="cl">second_repl_offset:409820
</span></span><span class="line"><span class="cl">repl_backlog_active:1
</span></span><span class="line"><span class="cl">repl_backlog_size:1048576
</span></span><span class="line"><span class="cl">repl_backlog_first_byte_offset:4840
</span></span><span class="line"><span class="cl">repl_backlog_histlen:412906
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">127.0.0.1:26380&gt; info sentinel （查看哨兵信息，发现127.0.0.1:6381成为新的master）
</span></span><span class="line"><span class="cl"><span class="c1"># Sentinel</span>
</span></span><span class="line"><span class="cl">sentinel_masters:1
</span></span><span class="line"><span class="cl">sentinel_tilt:0
</span></span><span class="line"><span class="cl">sentinel_running_scripts:0
</span></span><span class="line"><span class="cl">sentinel_scripts_queue_length:0
</span></span><span class="line"><span class="cl">sentinel_simulate_failure_flags:0
</span></span><span class="line"><span class="cl">master0:name<span class="o">=</span>mymaster,status<span class="o">=</span>ok,address<span class="o">=</span>127.0.0.1:6381,slaves<span class="o">=</span>2,sentinels<span class="o">=</span><span class="m">3</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="遇到的问题">遇到的问题</h2>
<h3 id="启动sentinelconf报错">启动sentinel.conf报错</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">No</span> <span class="n">such</span> <span class="n">master</span> <span class="n">with</span> <span class="n">specified</span> <span class="n">name</span><span class="o">.</span>
</span></span><span class="line"><span class="cl"><span class="n">原因是配置的顺序</span><span class="err">，</span><span class="n">也就是我们监听的时候</span><span class="err">，</span><span class="n">是需要先配置监听master</span><span class="err">，</span><span class="n">给master取一个名字叫mymaster</span><span class="err">，</span><span class="n">才能配置这个认证节点的密码</span><span class="err">。</span><span class="n">但是默认配置是密码在前面</span><span class="err">，</span><span class="n">监听配置在后面</span><span class="err">，</span><span class="n">这样就会报这个错</span><span class="err">，</span><span class="n">调整一下即可</span><span class="err">。</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">sentinel</span> <span class="n">monitor</span> <span class="n">mymaster</span> <span class="n">127</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">1</span> <span class="n">6379</span> <span class="n">2</span>
</span></span><span class="line"><span class="cl"><span class="n">sentinel</span> <span class="n">auth</span><span class="o">-</span><span class="n">pass</span> <span class="n">mymaster</span> <span class="n">redis123</span>
</span></span><span class="line"><span class="cl"><span class="n">顺序这样就能正常启动</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="主机杀死重连后master_link_statusdown">主机杀死重连后，master_link_status:down</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">这是因为从机设置了密码</span><span class="err">，</span><span class="n">当主机重连后会自动变为slave</span><span class="err">，</span><span class="n">在redis</span><span class="o">.</span><span class="na">conf配置文件中需要配置添加</span>
</span></span><span class="line"><span class="cl"><span class="n">masterauth</span> <span class="n">redis123</span>
</span></span><span class="line"><span class="cl"><span class="nl">
</span></span></span><span class="line"><span class="cl"><span class="nl">这样再次重启后master_link_status:</span><span class="n">up</span> <span class="n">显示正常</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="sentinel监视redismaster节点挂了不自动选举的问题next-failover-delay-i-will-not-start-a-failover-before-sat-mar-19-003923-2022">sentinel监视redis，master节点挂了不自动选举的问题，Next failover delay: I will not start a failover before Sat Mar 19 00:39:23 2022</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1">#修改redis.conf、redis-6380.conf、redis-6381.conf 中bind配置后 重启自动选举生效 </span>
</span></span><span class="line"><span class="cl">1、bind 0.0.0.0
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">2、protected-mode no（这个我本来设置的就是no）
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#修改了#sentinel leader-epoch mymaster后重启（不知道有没有影响）</span>
</span></span><span class="line"><span class="cl"><span class="c1">#sentinel leader-epoch mymaster 44 这个我修改成2 重启后自动修改成44了，之前是184</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h1 id="spirngboot集成redis">SpirngBoot集成Redis</h1>
<h2 id="1添加依赖">1.添加依赖</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-data-redis<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/dependency&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="2yml配置">2.yml配置</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">spring</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">redis</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">host</span><span class="p">:</span><span class="w"> </span><span class="m">8.140.1.39</span><span class="w">   </span><span class="c">#linux对应主机号IP</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="m">6381</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">password</span><span class="p">:</span><span class="w"> </span><span class="l">redis123</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">database</span><span class="p">:</span><span class="w"> </span><span class="m">0</span><span class="w">   </span><span class="c">#默认使用redis第0个数据库</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">lettuce</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">shutdown-timeout</span><span class="p">:</span><span class="w"> </span><span class="m">0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">pool</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">max-active</span><span class="p">:</span><span class="w"> </span><span class="m">8</span><span class="w">  </span><span class="c"># 最大活跃连接</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">max-wait</span><span class="p">:</span><span class="w"> </span>-<span class="m">1</span><span class="w">   </span><span class="c"># 最大阻塞时间</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">max-idle</span><span class="p">:</span><span class="w"> </span><span class="m">8</span><span class="w">    </span><span class="c"># 最大空闲连接</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">min-idle</span><span class="p">:</span><span class="w"> </span><span class="m">0</span><span class="w">    </span><span class="c"># 最小空闲连接</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">connect-timeout</span><span class="p">:</span><span class="w"> </span><span class="m">10000</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kn">package</span> <span class="nn">com.yc.redis</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">org.junit.jupiter.api.Test</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">org.springframework.boot.test.context.SpringBootTest</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">org.springframework.data.geo.Point</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">org.springframework.data.redis.connection.RedisGeoCommands</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">org.springframework.data.redis.core.RedisTemplate</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">java.util.HashMap</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@SpringBootTest</span>
</span></span><span class="line"><span class="cl"><span class="kd">class</span> <span class="nc">RedisSpringbootApplicationTests</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@Autowired</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="n">RedisTemplate</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="n">redisTemplate</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@Test</span>
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="nf">contextLoads</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">redisTemplate</span><span class="o">.</span><span class="na">opsForValue</span><span class="o">().</span><span class="na">get</span><span class="o">(</span><span class="s">&#34;name&#34;</span><span class="o">));</span>
</span></span><span class="line"><span class="cl">        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">redisTemplate</span><span class="o">.</span><span class="na">opsForList</span><span class="o">().</span><span class="na">range</span><span class="o">(</span><span class="s">&#34;list&#34;</span><span class="o">,</span> <span class="n">0</span><span class="o">,</span> <span class="o">-</span><span class="n">1</span><span class="o">));</span>
</span></span><span class="line"><span class="cl">        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">redisTemplate</span><span class="o">.</span><span class="na">hasKey</span><span class="o">(</span><span class="s">&#34;name&#34;</span><span class="o">)</span> <span class="o">+</span> <span class="s">&#34;  &#34;</span> <span class="o">+</span> <span class="n">redisTemplate</span><span class="o">.</span><span class="na">hasKey</span><span class="o">(</span><span class="s">&#34;list&#34;</span><span class="o">));</span>
</span></span><span class="line"><span class="cl">        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">redisTemplate</span><span class="o">.</span><span class="na">opsForValue</span><span class="o">().</span><span class="na">get</span><span class="o">(</span><span class="s">&#34;who&#34;</span><span class="o">));</span>
</span></span><span class="line"><span class="cl">        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">redisTemplate</span><span class="o">.</span><span class="na">keys</span><span class="o">(</span><span class="s">&#34;*&#34;</span><span class="o">));</span>
</span></span><span class="line"><span class="cl">        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">redisTemplate</span><span class="o">.</span><span class="na">opsForList</span><span class="o">().</span><span class="na">index</span><span class="o">(</span><span class="s">&#34;list&#34;</span><span class="o">,</span> <span class="n">3</span><span class="o">));</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;===============================================&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">HashMap</span> <span class="n">hashMap</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">        <span class="n">hashMap</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">&#34;name&#34;</span><span class="o">,</span> <span class="s">&#34;yc&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">hashMap</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">&#34;age&#34;</span><span class="o">,</span> <span class="s">&#34;22&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">hashMap</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">&#34;sex&#34;</span><span class="o">,</span> <span class="s">&#34;男&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">redisTemplate</span><span class="o">.</span><span class="na">opsForHash</span><span class="o">().</span><span class="na">putIfAbsent</span><span class="o">(</span><span class="s">&#34;hash&#34;</span><span class="o">,</span> <span class="s">&#34;name&#34;</span><span class="o">,</span> <span class="s">&#34;yc&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">redisTemplate</span><span class="o">.</span><span class="na">opsForHash</span><span class="o">().</span><span class="na">get</span><span class="o">(</span><span class="s">&#34;hash&#34;</span><span class="o">,</span> <span class="s">&#34;name&#34;</span><span class="o">));</span>
</span></span><span class="line"><span class="cl">        <span class="n">redisTemplate</span><span class="o">.</span><span class="na">opsForHash</span><span class="o">().</span><span class="na">putAll</span><span class="o">(</span><span class="s">&#34;hashmap&#34;</span><span class="o">,</span> <span class="n">hashMap</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@Test</span>
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="nf">geospatial</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">redisTemplate</span><span class="o">.</span><span class="na">opsForGeo</span><span class="o">().</span><span class="na">add</span><span class="o">(</span><span class="s">&#34;china:city&#34;</span><span class="o">,</span> <span class="k">new</span> <span class="n">Point</span><span class="o">(</span><span class="n">116</span><span class="o">.</span><span class="na">512885</span><span class="o">,</span> <span class="n">39</span><span class="o">.</span><span class="na">847469</span><span class="o">),</span> <span class="s">&#34;北京&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">redisTemplate</span><span class="o">.</span><span class="na">opsForGeo</span><span class="o">().</span><span class="na">add</span><span class="o">(</span><span class="s">&#34;china:city&#34;</span><span class="o">,</span> <span class="k">new</span> <span class="n">Point</span><span class="o">(</span><span class="n">121</span><span class="o">.</span><span class="na">486801</span><span class="o">,</span> <span class="n">31</span><span class="o">.</span><span class="na">24257</span><span class="o">),</span> <span class="s">&#34;上海&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">redisTemplate</span><span class="o">.</span><span class="na">opsForGeo</span><span class="o">().</span><span class="na">add</span><span class="o">(</span><span class="s">&#34;china:city&#34;</span><span class="o">,</span> <span class="k">new</span> <span class="n">Point</span><span class="o">(</span><span class="n">114</span><span class="o">.</span><span class="na">064552</span><span class="o">,</span> <span class="n">22</span><span class="o">.</span><span class="na">548457</span><span class="o">),</span> <span class="s">&#34;深圳&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">redisTemplate</span><span class="o">.</span><span class="na">opsForGeo</span><span class="o">().</span><span class="na">add</span><span class="o">(</span><span class="s">&#34;china:city&#34;</span><span class="o">,</span> <span class="k">new</span> <span class="n">Point</span><span class="o">(</span><span class="n">121</span><span class="o">.</span><span class="na">621631</span><span class="o">,</span> <span class="n">38</span><span class="o">.</span><span class="na">918954</span><span class="o">),</span> <span class="s">&#34;大连&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">redisTemplate</span><span class="o">.</span><span class="na">opsForGeo</span><span class="o">().</span><span class="na">add</span><span class="o">(</span><span class="s">&#34;china:city&#34;</span><span class="o">,</span> <span class="k">new</span> <span class="n">Point</span><span class="o">(</span><span class="n">120</span><span class="o">.</span><span class="na">215512</span><span class="o">,</span> <span class="n">30</span><span class="o">.</span><span class="na">253083</span><span class="o">),</span> <span class="s">&#34;杭州&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">redisTemplate</span><span class="o">.</span><span class="na">opsForGeo</span><span class="o">().</span><span class="na">add</span><span class="o">(</span><span class="s">&#34;china:city&#34;</span><span class="o">,</span> <span class="k">new</span> <span class="n">Point</span><span class="o">(</span><span class="n">100</span><span class="o">.</span><span class="na">626621</span><span class="o">,</span> <span class="n">36</span><span class="o">.</span><span class="na">292102</span><span class="o">),</span> <span class="s">&#34;海南&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">redisTemplate</span><span class="o">.</span><span class="na">opsForGeo</span><span class="o">().</span><span class="na">position</span><span class="o">(</span><span class="s">&#34;china:city&#34;</span><span class="o">,</span> <span class="s">&#34;北京&#34;</span><span class="o">,</span> <span class="s">&#34;上海&#34;</span><span class="o">,</span> <span class="s">&#34;深圳&#34;</span><span class="o">,</span> <span class="s">&#34;大连&#34;</span><span class="o">));</span>
</span></span><span class="line"><span class="cl">        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;===========================================================&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;北京与上海之间的距离：&#34;</span> <span class="o">+</span> <span class="n">redisTemplate</span><span class="o">.</span><span class="na">opsForGeo</span><span class="o">().</span><span class="na">distance</span><span class="o">(</span><span class="s">&#34;china:city&#34;</span><span class="o">,</span> <span class="s">&#34;北京&#34;</span><span class="o">,</span> <span class="s">&#34;上海&#34;</span><span class="o">,</span> <span class="n">RedisGeoCommands</span><span class="o">.</span><span class="na">DistanceUnit</span><span class="o">.</span><span class="na">KILOMETERS</span><span class="o">));</span>
</span></span><span class="line"><span class="cl">        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;北京的地理坐标：&#34;</span> <span class="o">+</span> <span class="n">redisTemplate</span><span class="o">.</span><span class="na">opsForGeo</span><span class="o">().</span><span class="na">position</span><span class="o">(</span><span class="s">&#34;china:city&#34;</span><span class="o">,</span> <span class="s">&#34;北京&#34;</span><span class="o">));</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@Test</span>
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="nf">hyperLogLog</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">redisTemplate</span><span class="o">.</span><span class="na">opsForHyperLogLog</span><span class="o">().</span><span class="na">size</span><span class="o">(</span><span class="s">&#34;day&#34;</span><span class="o">));</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="4遇到的问题">4.遇到的问题</h2>
<h3 id="41-启动项目显示unable-to-connect-to-81401396381">4.1 启动项目显示Unable to connect to 8.140.1.39:6381</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="c1"># protected-mode yes 改为 protected-mode no (即该配置项表示是否开启保护模式，默认是开启，开启后Redis只会本地进行访问，拒绝外部访问)。</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 注释掉bind 127.0.0.1 即 #bind 127.0.0.1 (ps: 不注释掉，表示指定 redis 只接收来自于该 IP 地址的请求，注释掉后，则表示将处理所有请求)。</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#开启防火墙（我的错误最后发现是6381防火墙没开）</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 开放6381端口</span>
</span></span><span class="line"><span class="cl">firewall-cmd --permanent --add-port<span class="o">=</span>6381/tcp
</span></span><span class="line"><span class="cl"><span class="c1">#重启防火墙(修改配置后要重启防火墙)</span>
</span></span><span class="line"><span class="cl">firewall-cmd --reload
</span></span></code></pre></td></tr></table>
</div>
</div>
    </div>

    <div class="post-copyright">
  <p class="copyright-item">
    <span class="item-title">文章作者</span>
    <span class="item-content">chengtry</span>
  </p>
  <p class="copyright-item">
    <span class="item-title">上次更新</span>
    <span class="item-content">
        2023-02-28
        
    </span>
  </p>
  
  
</div>
<footer class="post-footer">
      <div class="post-tags">
          <a href="/tags/redis/">Redis</a>
          </div>
      <nav class="post-nav">
        <a class="prev" href="/post/java/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">Java</span>
            <span class="prev-text nav-mobile">上一篇</span>
          </a>
        
      </nav>
    </footer>
  </article>
        </div>
        

  

  

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
      <a href="mailto:412307724@qq.com" class="iconfont icon-email" title="email"></a>
      <a href="https://github.com/chengtry" class="iconfont icon-github" title="github"></a>
  <a href="https://chengtry.github.io/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    由 <a class="hexo-link" href="https://gohugo.io">Hugo</a> 强力驱动
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    主题 - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
    2023<span class="heart"><i class="iconfont icon-heart"></i></span><span>chengtry</span>
  </span>
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js" integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js" integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin="anonymous"></script>



<script type="text/javascript" src="/js/main.min.64437849d125a2d603b3e71d6de5225d641a32d17168a58106e0b61852079683.js"></script>








</body>
</html>
