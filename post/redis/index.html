<!DOCTYPE html>
<html lang="zh-cn">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>Redis - chengtry</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<meta name="author" content="chengtry" /><meta name="description" content="Redis基础 Redis的安装： 安装redis 1 2 3 4 5 #下载redis的安装包并用Xftp上传到服务器，用tar命令解压安装包 1. tar -xzvf redis-6.0.6.tar.gz #进" /><meta name="keywords" content="Hugo, theme, even" />






<meta name="generator" content="Hugo 0.98.0 with theme even" />


<link rel="canonical" href="https://chengtry.github.io/post/redis/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">



<link href="/sass/main.min.f4f3850fc1de83dad6ea2e076bd92fabda928cb902ec9662f80aad35fb865d2d.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css" integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin="anonymous">


<meta property="og:title" content="Redis" />
<meta property="og:description" content="Redis基础 Redis的安装： 安装redis 1 2 3 4 5 #下载redis的安装包并用Xftp上传到服务器，用tar命令解压安装包 1. tar -xzvf redis-6.0.6.tar.gz #进" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://chengtry.github.io/post/redis/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2023-02-14T19:48:43+08:00" />
<meta property="article:modified_time" content="2023-04-23T16:58:31+08:00" />

<meta itemprop="name" content="Redis">
<meta itemprop="description" content="Redis基础 Redis的安装： 安装redis 1 2 3 4 5 #下载redis的安装包并用Xftp上传到服务器，用tar命令解压安装包 1. tar -xzvf redis-6.0.6.tar.gz #进"><meta itemprop="datePublished" content="2023-02-14T19:48:43+08:00" />
<meta itemprop="dateModified" content="2023-04-23T16:58:31+08:00" />
<meta itemprop="wordCount" content="11375">
<meta itemprop="keywords" content="Redis," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Redis"/>
<meta name="twitter:description" content="Redis基础 Redis的安装： 安装redis 1 2 3 4 5 #下载redis的安装包并用Xftp上传到服务器，用tar命令解压安装包 1. tar -xzvf redis-6.0.6.tar.gz #进"/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">chengtry</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">首页</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">归档</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">标签</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">目录</li>
      </a><a href="/about/">
        <li class="mobile-menu-item">关于</li>
      </a>
  </ul>

  


</nav>

  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">chengtry</a>
  
  <br>
  <span id="jinrishici-sentence">正在加载今日诗词....</span>
  <script src="https://sdk.jinrishici.com/v2/browser/jinrishici.js" charset="utf-8"></script>
</div>





<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">首页</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">归档</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">标签</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">目录</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/about/">关于</a>
      </li>
  </ul>
</nav>

    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">Redis</h1>

      <div class="post-meta">
        <span class="post-time"> 2023-02-14 19:48:43 </span>
        <div class="post-category">
            <a href="/categories/study/"> Study </a>
            <a href="/categories/note/"> Note </a>
            </div>
          <span class="more-meta"> 约 11375 字 </span>
          <span class="more-meta"> 预计阅读 23 分钟 </span>
        
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">文章目录</h2>
  <div class="post-toc-content always-active">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#redis基础">Redis基础</a>
      <ul>
        <li><a href="#redis的安装">Redis的安装：</a>
          <ul>
            <li><a href="#安装redis">安装redis</a></li>
            <li><a href="#安装过程中出现的问题">安装过程中出现的问题</a></li>
          </ul>
        </li>
        <li><a href="#redis中文乱码">Redis中文乱码：</a>
          <ul>
            <li><a href="#解决方案启动时加上--raw">解决方案：启动时加上&ndash;raw</a></li>
          </ul>
        </li>
        <li><a href="#查看redis安装目录">查看Redis安装目录：</a>
          <ul>
            <li><a href="#用whereis和which命令找不到安装目录可以使用以下方法">用whereis和which命令找不到安装目录可以使用以下方法：</a></li>
          </ul>
        </li>
        <li><a href="#查看redis版本号">查看Redis版本号：</a>
          <ul>
            <li><a href="#1-redis-server---version">1. redis-server &ndash;version</a></li>
            <li><a href="#2-redis-cli--v">2. redis-cli -v</a></li>
            <li><a href="#3-启动redis后用info命令">3. 启动redis后，用info命令</a></li>
          </ul>
        </li>
        <li><a href="#redis启动停止重启设置密码进入">Redis启动、停止、重启、设置密码、进入</a>
          <ul>
            <li><a href="#redis启动">Redis启动:</a></li>
            <li><a href="#redis关闭">Redis关闭：</a></li>
            <li><a href="#redis重启">Redis重启：</a></li>
            <li><a href="#redis设置密码">Redis设置密码：</a></li>
            <li><a href="#redis进入">Redis进入</a></li>
          </ul>
        </li>
        <li><a href="#为什么-redis-是单线程还这么快">为什么 Redis 是单线程还这么快？</a></li>
      </ul>
    </li>
    <li><a href="#五种基本类型">五种基本类型</a>
      <ul>
        <li><a href="#string类型">String类型</a>
          <ul>
            <li><a href="#常见命令">常见命令：</a></li>
            <li><a href="#ttl命令">TTL命令：</a></li>
            <li><a href="#设置和取消过期时间">设置和取消过期时间</a></li>
            <li><a href="#rename-和-renamex-命令">rename 和 renamex 命令：</a></li>
            <li><a href="#命令代码">命令代码：</a></li>
          </ul>
        </li>
        <li><a href="#list类型">List类型</a>
          <ul>
            <li><a href="#命令代码-1">命令代码：</a></li>
          </ul>
        </li>
        <li><a href="#set类型">Set类型</a>
          <ul>
            <li><a href="#命令代码-2">命令代码：</a></li>
          </ul>
        </li>
        <li><a href="#hash类型">Hash类型</a>
          <ul>
            <li><a href="#命令代码-3">命令代码：</a></li>
          </ul>
        </li>
        <li><a href="#zset类型">Zset类型</a>
          <ul>
            <li><a href="#命令代码-4">命令代码:</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#三种特殊类型">三种特殊类型</a>
      <ul>
        <li><a href="#geospatial地理位置">Geospatial(地理位置)</a>
          <ul>
            <li><a href="#命令代码-5">命令代码：</a></li>
          </ul>
        </li>
        <li><a href="#hyperloglog基数统计">Hyperloglog(基数统计)</a>
          <ul>
            <li><a href="#命令代码-6">命令代码：</a></li>
          </ul>
        </li>
        <li><a href="#bitmap位图">BitMap(位图)</a>
          <ul>
            <li><a href="#命令代码-7">命令代码：</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#redis事务">Redis事务</a>
      <ul>
        <li><a href="#事务">事务：</a></li>
        <li><a href="#redis事务过程">Redis事务过程：</a></li>
        <li><a href="#取消事务discard">取消事务(DISCARD)：</a></li>
        <li><a href="#事务错误">事务错误</a>
          <ul>
            <li><a href="#1代码语法错误编译时异常所有的命令都不执行">1.代码语法错误（编译时异常）所有的命令都不执行</a></li>
            <li><a href="#2代码逻辑错误-运行时异常-其他命令可以正常执行---所以不保证事务原子性">2.代码逻辑错误 (运行时异常) **其他命令可以正常执行 ** &raquo;&gt; 所以不保证事务原子性</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#监控">监控</a>
      <ul>
        <li><a href="#乐观锁">乐观锁：</a>
          <ul>
            <li><a href="#1-正常执行">1. 正常执行</a></li>
            <li><a href="#2多线程测试">2.多线程测试</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#缓存穿透缓存击穿缓存雪崩">缓存穿透、缓存击穿、缓存雪崩</a>
      <ul>
        <li><a href="#缓存穿透">缓存穿透</a>
          <ul>
            <li><a href="#概念">概念：</a></li>
            <li><a href="#解决方案">解决方案：</a></li>
          </ul>
        </li>
        <li><a href="#缓存击穿">缓存击穿</a>
          <ul>
            <li><a href="#概念-1">概念：</a></li>
            <li><a href="#解决方案-1">解决方案：</a></li>
          </ul>
        </li>
        <li><a href="#缓存雪崩">缓存雪崩</a>
          <ul>
            <li><a href="#概念-2">概念：</a></li>
            <li><a href="#解决方案-2">解决方案：</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#redis主从复制">Redis主从复制</a>
      <ul>
        <li><a href="#概念-3">概念</a></li>
        <li><a href="#开启多个redis服务一主二从">开启多个redis服务（一主二从）</a>
          <ul>
            <li><a href="#1去阿里云添加安全组规则开放637963806381端口号开放linux防火墙端口号">1.去阿里云添加安全组规则，开放6379/6380/6381端口号，开放linux防火墙端口号</a></li>
            <li><a href="#2复制redisconf-到-redis-6380confredis-6381conf">2.复制redis.conf 到 redis-6380.conf，redis-6381.conf</a></li>
            <li><a href="#3修改-redis-6380confredis-6381conf信息主要三个信息">3.修改 redis-6380.conf，redis-6381.conf信息（主要三个信息）</a></li>
            <li><a href="#4启动redis服务三个端口号">4.启动redis服务（三个端口号）</a></li>
            <li><a href="#5查看信息">5.查看信息</a></li>
            <li><a href="#6遇到master_link_status为down情况">6.遇到master_link_status为down情况</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#redis哨兵模式">Redis哨兵模式</a>
      <ul>
        <li><a href="#复制sentinelconf到自己目录下">复制sentinel.conf到自己目录下</a>
          <ul>
            <li><a href="#安装好的redis源码默认含有redisconf文件和sentinelconf文件">安装好的redis源码默认含有redis.conf文件和sentinel.conf文件</a></li>
          </ul>
        </li>
        <li><a href="#复制sentinelconf到sentinel-26380confsentinel-23681conf">复制sentinel.conf到sentinel-26380.conf，sentinel-23681.conf</a></li>
        <li><a href="#修改sentinelconf配置文件主要修改5处其他redis默认的一般不修改">修改sentinel.conf配置文件（主要修改5处，其他redis默认的一般不修改）</a></li>
        <li><a href="#启动redis哨兵服务">启动redis哨兵服务</a></li>
        <li><a href="#查看哨兵信息">查看哨兵信息</a></li>
        <li><a href="#测试哨兵模式">测试哨兵模式</a></li>
        <li><a href="#遇到的问题">遇到的问题</a>
          <ul>
            <li><a href="#启动sentinelconf报错">启动sentinel.conf报错</a></li>
            <li><a href="#主机杀死重连后master_link_statusdown">主机杀死重连后，master_link_status:down</a></li>
            <li><a href="#sentinel监视redismaster节点挂了不自动选举的问题next-failover-delay-i-will-not-start-a-failover-before-sat-mar-19-003923-2022">sentinel监视redis，master节点挂了不自动选举的问题，Next failover delay: I will not start a failover before Sat Mar 19 00:39:23 2022</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#spirngboot集成redis">SpirngBoot集成Redis</a>
      <ul>
        <li><a href="#1添加依赖">1.添加依赖</a></li>
        <li><a href="#2yml配置">2.yml配置</a></li>
        <li><a href="#4遇到的问题">4.遇到的问题</a>
          <ul>
            <li><a href="#41-启动项目显示unable-to-connect-to-81401396381">4.1 启动项目显示Unable to connect to 8.140.1.39:6381</a></li>
          </ul>
        </li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</div>
    <div class="post-content">
      <h1 id="redis基础">Redis基础</h1>
<h2 id="redis的安装">Redis的安装：</h2>
<h3 id="安装redis">安装redis</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="c1">#下载redis的安装包并用Xftp上传到服务器，用tar命令解压安装包</span>
</span></span><span class="line"><span class="cl">1. tar -xzvf redis-6.0.6.tar.gz
</span></span><span class="line"><span class="cl"><span class="c1">#进入redis安装目录使用make命令</span>
</span></span><span class="line"><span class="cl">2. <span class="nb">cd</span> redis-6.0.6
</span></span><span class="line"><span class="cl">   make
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="安装过程中出现的问题">安装过程中出现的问题</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">1.#使用make命令发生错误，查明原因发现未安装gcc，使用以下命令
</span></span><span class="line"><span class="cl">yum install cpp
</span></span><span class="line"><span class="cl">yum install binutils
</span></span><span class="line"><span class="cl">yum install glibc
</span></span><span class="line"><span class="cl">yum install glibc-kernheaders
</span></span><span class="line"><span class="cl">yum install glibc-common
</span></span><span class="line"><span class="cl">yum install glibc-devel
</span></span><span class="line"><span class="cl">yum install gcc
</span></span><span class="line"><span class="cl">yum install make
</span></span><span class="line"><span class="cl">yum -y install gcc-c++
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">2.#再次使用make命令还是报错，查明原因发现gcc版本太低（只针对redis6.0版本及以上）
</span></span><span class="line"><span class="cl"><span class="c1">#redis6.0版本以上需要将gcc升级到5.3以上，而CentOS 7默认安装的gcc版本是4.8.5</span>
</span></span><span class="line"><span class="cl">gcc -v <span class="c1">#查看gcc版本号</span>
</span></span><span class="line"><span class="cl"><span class="c1">#升级gcc到 5.3及以上版本</span>
</span></span><span class="line"><span class="cl">yum -y install centos-release-scl
</span></span><span class="line"><span class="cl">yum -y install devtoolset-9-gcc devtoolset-9-gcc-c++ devtoolset-9-binutils
</span></span><span class="line"><span class="cl">scl <span class="nb">enable</span> devtoolset-9 bash
</span></span><span class="line"><span class="cl"><span class="c1">#再次使用make命令（可以先重新安装redis--&gt;先删除解压好的redis--&gt;用tar -xzvf 命令重新解压）</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">3.#redis启动出现三个警告
</span></span><span class="line"><span class="cl">第一个警告：The TCP backlog setting of <span class="m">511</span> cannot be enforced because /proc/sys/net/core/somaxconn is <span class="nb">set</span> to the lower value of 128.
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">第二个警告：overcommit_memory is <span class="nb">set</span> to 0! Background save may fail under low memory condition. To fix this issue add <span class="s1">&#39;vm.overcommit_memory = 1&#39;</span> to/etc/sysctl.conf and <span class="k">then</span> reboot or run the <span class="nb">command</span> <span class="s1">&#39;sysctl vm.overcommit_memory=1&#39;</span> <span class="k">for</span> this to take effect.
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">第三个警告：you have Transparent Huge Pages <span class="o">(</span>THP<span class="o">)</span> support enabled in your kernel. This will create latency and memory usage issues with Redis. To fix thisissue run the <span class="nb">command</span> <span class="s1">&#39;echo never &gt; /sys/kernel/mm/transparent_hugepage/enabled&#39;</span> as root, and add it to your /etc/rc.local in order to retain thesetting after a reboot. Redis must be restarted after THP is disabled.
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#解决方案</span>
</span></span><span class="line"><span class="cl">第一个警告
</span></span><span class="line"><span class="cl">将net.core.somaxconn <span class="o">=</span> 1024添加到/etc/sysctl.conf中，然后执行sysctl -p生效配置。
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">第二个警告
</span></span><span class="line"><span class="cl">将vm.overcommit_memory <span class="o">=</span> 1添加到/etc/sysctl.conf中，然后执行sysctl -p生效配置。
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">第三个警告
</span></span><span class="line"><span class="cl">将echo never &gt; /sys/kernel/mm/transparent_hugepage/enabled添加到/etc/rc.local中，然后执行source /etc/rc.local生效配置。
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">重新启动redis正常
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="redis中文乱码">Redis中文乱码：</h2>
<h3 id="解决方案启动时加上--raw">解决方案：启动时加上&ndash;raw</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">redis-cli -p <span class="m">6379</span> --raw
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="查看redis安装目录">查看Redis安装目录：</h2>
<h3 id="用whereis和which命令找不到安装目录可以使用以下方法">用whereis和which命令找不到安装目录可以使用以下方法：</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">第一步：ps -ef<span class="p">|</span>grep redis       得到进程号信息
</span></span><span class="line"><span class="cl">第二步：ls -l /proc/进程号/cwd   得到安装目录信息
</span></span></code></pre></td></tr></table>
</div>
</div><p><img src="https://raw.githubusercontent.com/chengtry/my-picture/main/img/image-20210310095730403.png" alt=""></p>
<h2 id="查看redis版本号">查看Redis版本号：</h2>
<h3 id="1-redis-server---version">1. redis-server &ndash;version</h3>
<h3 id="2-redis-cli--v">2. redis-cli -v</h3>
<p><img src="https://raw.githubusercontent.com/chengtry/my-picture/main/img/image-20210310101418280.png" alt=""></p>
<h3 id="3-启动redis后用info命令">3. 启动redis后，用info命令</h3>
<p><img src="https://raw.githubusercontent.com/chengtry/my-picture/main/img/image-20210310101443498.png" alt=""></p>
<h2 id="redis启动停止重启设置密码进入">Redis启动、停止、重启、设置密码、进入</h2>
<h3 id="redis启动">Redis启动:</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">启动redis服务
</span></span><span class="line"><span class="cl">redis-server redis.conf
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="redis关闭">Redis关闭：</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">redis-cli -h 127.0.0.1 -p <span class="m">6379</span> shutdown
</span></span><span class="line"><span class="cl">redis-cli shutdown
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="redis重启">Redis重启：</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">使用关闭+启动组合命令：redis-cli shutdown 、 redis-server redis.conf
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="redis设置密码">Redis设置密码：</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">1. 修改配置文件，永久生效<span class="o">(</span>修改后需要重启redis才能生效<span class="o">)</span>
</span></span><span class="line"><span class="cl">    进入redis.conf配置文件，添加 requirepass redis123 <span class="o">(</span>密码：redis123<span class="o">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">2. 临时添加密码<span class="o">(</span>重启redis密码失效<span class="o">)</span>
</span></span><span class="line"><span class="cl">    config <span class="nb">set</span> requirepass redis123 
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="redis进入">Redis进入</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">使用密码进入并解决中文乱码 
</span></span><span class="line"><span class="cl">redis-cli -a redis123 --raw
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="为什么-redis-是单线程还这么快">为什么 Redis 是单线程还这么快？</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">Redis 所有的数据都是存放在内存中的，单线程的操作没有上下文的切换，从而达到很高的效率。
</span></span></code></pre></td></tr></table>
</div>
</div><h1 id="五种基本类型">五种基本类型</h1>
<h2 id="string类型">String类型</h2>
<h3 id="常见命令">常见命令：</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">exists key：判断键是否存在
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">del key：删除键值对
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">move key db：将键值对移动到指定数据库
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">expire key second：设置键值对的过期时间
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">type</span> key：查看value的数据类型
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="ttl命令">TTL命令：</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">Redis的key，通过TTL命令返回key的过期时间，一般来说有3种：
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">1.当前key没有设置过期时间，所以会返回-1.
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">2.当前key有设置过期时间，而且key已经过期，所以会返回-2.
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">3.当前key有设置过期时间，且key还没有过期，故会返回key的正常剩余时间.
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="设置和取消过期时间">设置和取消过期时间</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="c1">#设置 name 的过期时间为6000秒</span>
</span></span><span class="line"><span class="cl">expire name <span class="m">6000</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#取消 name 的过期时间</span>
</span></span><span class="line"><span class="cl">persist name
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#查看 name 过期时间</span>
</span></span><span class="line"><span class="cl">ttl name
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="rename-和-renamex-命令">rename 和 renamex 命令：</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="sb">`</span>RENAME key newkey<span class="sb">`</span> 修改 key 的名称
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="sb">`</span>RENAMENX key newkey<span class="sb">`</span> 仅当 newkey 不存在时，将 key 改名为 newkey 
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="命令代码">命令代码：</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">127.0.0.1:6379&gt; keys * <span class="c1"># 查看当前数据库所有key</span>
</span></span><span class="line"><span class="cl"><span class="o">(</span>empty list or <span class="nb">set</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; <span class="nb">set</span> name qinjiang <span class="c1"># set key</span>
</span></span><span class="line"><span class="cl">OK
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; <span class="nb">set</span> age <span class="m">20</span>
</span></span><span class="line"><span class="cl">OK
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; keys *
</span></span><span class="line"><span class="cl">1<span class="o">)</span> <span class="s2">&#34;age&#34;</span>
</span></span><span class="line"><span class="cl">2<span class="o">)</span> <span class="s2">&#34;name&#34;</span>
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; move age <span class="m">1</span> <span class="c1"># 将键值对移动到指定数据库</span>
</span></span><span class="line"><span class="cl"><span class="o">(</span>integer<span class="o">)</span> <span class="m">1</span>
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; EXISTS age <span class="c1"># 判断键是否存在</span>
</span></span><span class="line"><span class="cl"><span class="o">(</span>integer<span class="o">)</span> <span class="m">0</span> <span class="c1"># 不存在</span>
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; EXISTS name
</span></span><span class="line"><span class="cl"><span class="o">(</span>integer<span class="o">)</span> <span class="m">1</span> <span class="c1"># 存在</span>
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; SELECT <span class="m">1</span>
</span></span><span class="line"><span class="cl">OK
</span></span><span class="line"><span class="cl">127.0.0.1:6379<span class="o">[</span>1<span class="o">]</span>&gt; keys *
</span></span><span class="line"><span class="cl">1<span class="o">)</span> <span class="s2">&#34;age&#34;</span>
</span></span><span class="line"><span class="cl">127.0.0.1:6379<span class="o">[</span>1<span class="o">]</span>&gt; del age <span class="c1"># 删除键值对</span>
</span></span><span class="line"><span class="cl"><span class="o">(</span>integer<span class="o">)</span> <span class="m">1</span> <span class="c1"># 删除个数</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; <span class="nb">set</span> age <span class="m">20</span>
</span></span><span class="line"><span class="cl">OK
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; EXPIRE age <span class="m">15</span> <span class="c1"># 设置键值对的过期时间</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">(</span>integer<span class="o">)</span> <span class="m">1</span> <span class="c1"># 设置成功 开始计数</span>
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; ttl age <span class="c1"># 查看key的过期剩余时间</span>
</span></span><span class="line"><span class="cl"><span class="o">(</span>integer<span class="o">)</span> <span class="m">13</span>
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; ttl age
</span></span><span class="line"><span class="cl"><span class="o">(</span>integer<span class="o">)</span> <span class="m">11</span>
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; ttl age
</span></span><span class="line"><span class="cl"><span class="o">(</span>integer<span class="o">)</span> <span class="m">9</span>
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; ttl age
</span></span><span class="line"><span class="cl"><span class="o">(</span>integer<span class="o">)</span> -2 <span class="c1"># -2 表示key过期，-1表示key未设置过期时间</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; get age <span class="c1"># 过期的key 会被自动delete</span>
</span></span><span class="line"><span class="cl"><span class="o">(</span>nil<span class="o">)</span>
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; keys *
</span></span><span class="line"><span class="cl">1<span class="o">)</span> <span class="s2">&#34;name&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; <span class="nb">type</span> name <span class="c1"># 查看value的数据类型</span>
</span></span><span class="line"><span class="cl">string
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="list类型">List类型</h2>
<h3 id="命令代码-1">命令代码：</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">---------------------------LPUSH---RPUSH---LRANGE--------------------------------
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; LPUSH mylist k1 <span class="c1"># LPUSH mylist=&gt;{1}</span>
</span></span><span class="line"><span class="cl"><span class="o">(</span>integer<span class="o">)</span> <span class="m">1</span>
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; LPUSH mylist k2 <span class="c1"># LPUSH mylist=&gt;{2,1}</span>
</span></span><span class="line"><span class="cl"><span class="o">(</span>integer<span class="o">)</span> <span class="m">2</span>
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; RPUSH mylist k3 <span class="c1"># RPUSH mylist=&gt;{2,1,3}</span>
</span></span><span class="line"><span class="cl"><span class="o">(</span>integer<span class="o">)</span> <span class="m">3</span>
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; get mylist <span class="c1"># 普通的get是无法获取list值的</span>
</span></span><span class="line"><span class="cl"><span class="o">(</span>error<span class="o">)</span> WRONGTYPE Operation against a key holding the wrong kind of value
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; LRANGE mylist <span class="m">0</span> <span class="m">4</span> <span class="c1"># LRANGE 获取起止位置范围内的元素</span>
</span></span><span class="line"><span class="cl">1<span class="o">)</span> <span class="s2">&#34;k2&#34;</span>
</span></span><span class="line"><span class="cl">2<span class="o">)</span> <span class="s2">&#34;k1&#34;</span>
</span></span><span class="line"><span class="cl">3<span class="o">)</span> <span class="s2">&#34;k3&#34;</span>
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; LRANGE mylist <span class="m">0</span> <span class="m">2</span>
</span></span><span class="line"><span class="cl">1<span class="o">)</span> <span class="s2">&#34;k2&#34;</span>
</span></span><span class="line"><span class="cl">2<span class="o">)</span> <span class="s2">&#34;k1&#34;</span>
</span></span><span class="line"><span class="cl">3<span class="o">)</span> <span class="s2">&#34;k3&#34;</span>
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; LRANGE mylist <span class="m">0</span> <span class="m">1</span>
</span></span><span class="line"><span class="cl">1<span class="o">)</span> <span class="s2">&#34;k2&#34;</span>
</span></span><span class="line"><span class="cl">2<span class="o">)</span> <span class="s2">&#34;k1&#34;</span>
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; LRANGE mylist <span class="m">0</span> -1 <span class="c1"># 获取全部元素</span>
</span></span><span class="line"><span class="cl">1<span class="o">)</span> <span class="s2">&#34;k2&#34;</span>
</span></span><span class="line"><span class="cl">2<span class="o">)</span> <span class="s2">&#34;k1&#34;</span>
</span></span><span class="line"><span class="cl">3<span class="o">)</span> <span class="s2">&#34;k3&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">---------------------------LPUSHX---RPUSHX-----------------------------------
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; LPUSHX list v1 <span class="c1"># list不存在 LPUSHX失败</span>
</span></span><span class="line"><span class="cl"><span class="o">(</span>integer<span class="o">)</span> <span class="m">0</span>
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; LPUSHX list v1 v2  
</span></span><span class="line"><span class="cl"><span class="o">(</span>integer<span class="o">)</span> <span class="m">0</span>
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; LPUSHX mylist k4 k5 <span class="c1"># 向mylist中 左边 PUSH k4 k5</span>
</span></span><span class="line"><span class="cl"><span class="o">(</span>integer<span class="o">)</span> <span class="m">5</span>
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; LRANGE mylist <span class="m">0</span> -1
</span></span><span class="line"><span class="cl">1<span class="o">)</span> <span class="s2">&#34;k5&#34;</span>
</span></span><span class="line"><span class="cl">2<span class="o">)</span> <span class="s2">&#34;k4&#34;</span>
</span></span><span class="line"><span class="cl">3<span class="o">)</span> <span class="s2">&#34;k2&#34;</span>
</span></span><span class="line"><span class="cl">4<span class="o">)</span> <span class="s2">&#34;k1&#34;</span>
</span></span><span class="line"><span class="cl">5<span class="o">)</span> <span class="s2">&#34;k3&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">---------------------------LINSERT--LLEN--LINDEX--LSET----------------------------
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; LINSERT mylist after k2 ins_key1 <span class="c1"># 在k2元素后 插入ins_key1</span>
</span></span><span class="line"><span class="cl"><span class="o">(</span>integer<span class="o">)</span> <span class="m">6</span>
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; LRANGE mylist <span class="m">0</span> -1
</span></span><span class="line"><span class="cl">1<span class="o">)</span> <span class="s2">&#34;k5&#34;</span>
</span></span><span class="line"><span class="cl">2<span class="o">)</span> <span class="s2">&#34;k4&#34;</span>
</span></span><span class="line"><span class="cl">3<span class="o">)</span> <span class="s2">&#34;k2&#34;</span>
</span></span><span class="line"><span class="cl">4<span class="o">)</span> <span class="s2">&#34;ins_key1&#34;</span>
</span></span><span class="line"><span class="cl">5<span class="o">)</span> <span class="s2">&#34;k1&#34;</span>
</span></span><span class="line"><span class="cl">6<span class="o">)</span> <span class="s2">&#34;k3&#34;</span>
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; LLEN mylist <span class="c1"># 查看mylist的长度</span>
</span></span><span class="line"><span class="cl"><span class="o">(</span>integer<span class="o">)</span> <span class="m">6</span>
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; LINDEX mylist <span class="m">3</span> <span class="c1"># 获取下标为3的元素</span>
</span></span><span class="line"><span class="cl"><span class="s2">&#34;ins_key1&#34;</span>
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; LINDEX mylist <span class="m">0</span>
</span></span><span class="line"><span class="cl"><span class="s2">&#34;k5&#34;</span>
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; LSET mylist <span class="m">3</span> k6 <span class="c1"># 将下标3的元素 set值为k6</span>
</span></span><span class="line"><span class="cl">OK
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; LRANGE mylist <span class="m">0</span> -1
</span></span><span class="line"><span class="cl">1<span class="o">)</span> <span class="s2">&#34;k5&#34;</span>
</span></span><span class="line"><span class="cl">2<span class="o">)</span> <span class="s2">&#34;k4&#34;</span>
</span></span><span class="line"><span class="cl">3<span class="o">)</span> <span class="s2">&#34;k2&#34;</span>
</span></span><span class="line"><span class="cl">4<span class="o">)</span> <span class="s2">&#34;k6&#34;</span>
</span></span><span class="line"><span class="cl">5<span class="o">)</span> <span class="s2">&#34;k1&#34;</span>
</span></span><span class="line"><span class="cl">6<span class="o">)</span> <span class="s2">&#34;k3&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">---------------------------LPOP--RPOP--------------------------
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; LPOP mylist <span class="c1"># 左侧(头部)弹出</span>
</span></span><span class="line"><span class="cl"><span class="s2">&#34;k5&#34;</span>
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; RPOP mylist <span class="c1"># 右侧(尾部)弹出</span>
</span></span><span class="line"><span class="cl"><span class="s2">&#34;k3&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">---------------------------RPOPLPUSH--------------------------
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; LRANGE mylist <span class="m">0</span> -1
</span></span><span class="line"><span class="cl">1<span class="o">)</span> <span class="s2">&#34;k4&#34;</span>
</span></span><span class="line"><span class="cl">2<span class="o">)</span> <span class="s2">&#34;k2&#34;</span>
</span></span><span class="line"><span class="cl">3<span class="o">)</span> <span class="s2">&#34;k6&#34;</span>
</span></span><span class="line"><span class="cl">4<span class="o">)</span> <span class="s2">&#34;k1&#34;</span>
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; RPOPLPUSH mylist newlist <span class="c1"># 将mylist的最后一个值(k1)弹出，加入到newlist的头部</span>
</span></span><span class="line"><span class="cl"><span class="s2">&#34;k1&#34;</span>
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; LRANGE newlist <span class="m">0</span> -1
</span></span><span class="line"><span class="cl">1<span class="o">)</span> <span class="s2">&#34;k1&#34;</span>
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; LRANGE mylist <span class="m">0</span> -1
</span></span><span class="line"><span class="cl">1<span class="o">)</span> <span class="s2">&#34;k4&#34;</span>
</span></span><span class="line"><span class="cl">2<span class="o">)</span> <span class="s2">&#34;k2&#34;</span>
</span></span><span class="line"><span class="cl">3<span class="o">)</span> <span class="s2">&#34;k6&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">---------------------------LTRIM--------------------------
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; LTRIM mylist <span class="m">0</span> <span class="m">1</span> <span class="c1"># 截取mylist中的 0~1部分</span>
</span></span><span class="line"><span class="cl">OK
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; LRANGE mylist <span class="m">0</span> -1
</span></span><span class="line"><span class="cl">1<span class="o">)</span> <span class="s2">&#34;k4&#34;</span>
</span></span><span class="line"><span class="cl">2<span class="o">)</span> <span class="s2">&#34;k2&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 初始 mylist: k2,k2,k2,k2,k2,k2,k4,k2,k2,k2,k2</span>
</span></span><span class="line"><span class="cl">---------------------------LREM--------------------------
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; LREM mylist <span class="m">3</span> k2 <span class="c1"># 从头部开始搜索 至多删除3个 k2</span>
</span></span><span class="line"><span class="cl"><span class="o">(</span>integer<span class="o">)</span> <span class="m">3</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 删除后：mylist: k2,k2,k2,k4,k2,k2,k2,k2</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; LREM mylist -2 k2 <span class="c1">#从尾部开始搜索 至多删除2个 k2</span>
</span></span><span class="line"><span class="cl"><span class="o">(</span>integer<span class="o">)</span> <span class="m">2</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 删除后：mylist: k2,k2,k2,k4,k2,k2</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">---------------------------BLPOP--BRPOP--------------------------
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">mylist: k2,k2,k2,k4,k2,k2
</span></span><span class="line"><span class="cl">newlist: k1
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; BLPOP newlist mylist <span class="m">30</span> <span class="c1"># 从newlist中弹出第一个值，mylist作为候选</span>
</span></span><span class="line"><span class="cl">1<span class="o">)</span> <span class="s2">&#34;newlist&#34;</span> <span class="c1"># 弹出</span>
</span></span><span class="line"><span class="cl">2<span class="o">)</span> <span class="s2">&#34;k1&#34;</span>
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; BLPOP newlist mylist <span class="m">30</span>
</span></span><span class="line"><span class="cl">1<span class="o">)</span> <span class="s2">&#34;mylist&#34;</span> <span class="c1"># 由于newlist空了 从mylist中弹出</span>
</span></span><span class="line"><span class="cl">2<span class="o">)</span> <span class="s2">&#34;k2&#34;</span>
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; BLPOP newlist <span class="m">30</span>
</span></span><span class="line"><span class="cl"><span class="o">(</span>30.10s<span class="o">)</span> <span class="c1"># 超时了</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; BLPOP newlist <span class="m">30</span> <span class="c1"># 我们连接另一个客户端向newlist中push了test, 阻塞被解决。</span>
</span></span><span class="line"><span class="cl">1<span class="o">)</span> <span class="s2">&#34;newlist&#34;</span>
</span></span><span class="line"><span class="cl">2<span class="o">)</span> <span class="s2">&#34;test&#34;</span>
</span></span><span class="line"><span class="cl"><span class="o">(</span>12.54s<span class="o">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="set类型">Set类型</h2>
<h3 id="命令代码-2">命令代码：</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span><span class="lnt">79
</span><span class="lnt">80
</span><span class="lnt">81
</span><span class="lnt">82
</span><span class="lnt">83
</span><span class="lnt">84
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">---------------SADD--SCARD--SMEMBERS--SISMEMBER--------------------
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; SADD myset m1 m2 m3 m4 <span class="c1"># 向myset中增加成员 m1~m4</span>
</span></span><span class="line"><span class="cl"><span class="o">(</span>integer<span class="o">)</span> <span class="m">4</span>
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; SCARD myset <span class="c1"># 获取集合的成员数目</span>
</span></span><span class="line"><span class="cl"><span class="o">(</span>integer<span class="o">)</span> <span class="m">4</span>
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; smembers myset <span class="c1"># 获取集合中所有成员</span>
</span></span><span class="line"><span class="cl">1<span class="o">)</span> <span class="s2">&#34;m4&#34;</span>
</span></span><span class="line"><span class="cl">2<span class="o">)</span> <span class="s2">&#34;m3&#34;</span>
</span></span><span class="line"><span class="cl">3<span class="o">)</span> <span class="s2">&#34;m2&#34;</span>
</span></span><span class="line"><span class="cl">4<span class="o">)</span> <span class="s2">&#34;m1&#34;</span>
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; SISMEMBER myset m5 <span class="c1"># 查询m5是否是myset的成员</span>
</span></span><span class="line"><span class="cl"><span class="o">(</span>integer<span class="o">)</span> <span class="m">0</span> <span class="c1"># 不是，返回0</span>
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; SISMEMBER myset m2
</span></span><span class="line"><span class="cl"><span class="o">(</span>integer<span class="o">)</span> <span class="m">1</span> <span class="c1"># 是，返回1</span>
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; SISMEMBER myset m3
</span></span><span class="line"><span class="cl"><span class="o">(</span>integer<span class="o">)</span> <span class="m">1</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">---------------------SRANDMEMBER--SPOP----------------------------------
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; SRANDMEMBER myset <span class="m">3</span> <span class="c1"># 随机返回3个成员</span>
</span></span><span class="line"><span class="cl">1<span class="o">)</span> <span class="s2">&#34;m2&#34;</span>
</span></span><span class="line"><span class="cl">2<span class="o">)</span> <span class="s2">&#34;m3&#34;</span>
</span></span><span class="line"><span class="cl">3<span class="o">)</span> <span class="s2">&#34;m4&#34;</span>
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; SRANDMEMBER myset <span class="c1"># 随机返回1个成员</span>
</span></span><span class="line"><span class="cl"><span class="s2">&#34;m3&#34;</span>
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; SPOP myset <span class="m">2</span> <span class="c1"># 随机移除并返回2个成员</span>
</span></span><span class="line"><span class="cl">1<span class="o">)</span> <span class="s2">&#34;m1&#34;</span>
</span></span><span class="line"><span class="cl">2<span class="o">)</span> <span class="s2">&#34;m4&#34;</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 将set还原到{m1,m2,m3,m4}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">---------------------SMOVE--SREM----------------------------------------
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; SMOVE myset newset m3 <span class="c1"># 将myset中m3成员移动到newset集合</span>
</span></span><span class="line"><span class="cl"><span class="o">(</span>integer<span class="o">)</span> <span class="m">1</span>
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; SMEMBERS myset
</span></span><span class="line"><span class="cl">1<span class="o">)</span> <span class="s2">&#34;m4&#34;</span>
</span></span><span class="line"><span class="cl">2<span class="o">)</span> <span class="s2">&#34;m2&#34;</span>
</span></span><span class="line"><span class="cl">3<span class="o">)</span> <span class="s2">&#34;m1&#34;</span>
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; SMEMBERS newset
</span></span><span class="line"><span class="cl">1<span class="o">)</span> <span class="s2">&#34;m3&#34;</span>
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; SREM newset m3 <span class="c1"># 从newset中移除m3元素</span>
</span></span><span class="line"><span class="cl"><span class="o">(</span>integer<span class="o">)</span> <span class="m">1</span>
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; SMEMBERS newset
</span></span><span class="line"><span class="cl"><span class="o">(</span>empty list or <span class="nb">set</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 下面开始是多集合操作,多集合操作中若只有一个参数默认和自身进行运算</span>
</span></span><span class="line"><span class="cl"><span class="c1"># setx=&gt;{m1,m2,m4,m6}, sety=&gt;{m2,m5,m6}, setz=&gt;{m1,m3,m6}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">-----------------------------SDIFF------------------------------------
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; SDIFF setx sety setz <span class="c1"># 等价于setx-sety-setz</span>
</span></span><span class="line"><span class="cl">1<span class="o">)</span> <span class="s2">&#34;m4&#34;</span>
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; SDIFF setx sety <span class="c1"># setx - sety</span>
</span></span><span class="line"><span class="cl">1<span class="o">)</span> <span class="s2">&#34;m4&#34;</span>
</span></span><span class="line"><span class="cl">2<span class="o">)</span> <span class="s2">&#34;m1&#34;</span>
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; SDIFF sety setx <span class="c1"># sety - setx</span>
</span></span><span class="line"><span class="cl">1<span class="o">)</span> <span class="s2">&#34;m5&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">-------------------------SINTER---------------------------------------
</span></span><span class="line"><span class="cl"><span class="c1"># 共同关注（交集）</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; SINTER setx sety setz <span class="c1"># 求 setx、sety、setx的交集</span>
</span></span><span class="line"><span class="cl">1<span class="o">)</span> <span class="s2">&#34;m6&#34;</span>
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; SINTER setx sety <span class="c1"># 求setx sety的交集</span>
</span></span><span class="line"><span class="cl">1<span class="o">)</span> <span class="s2">&#34;m2&#34;</span>
</span></span><span class="line"><span class="cl">2<span class="o">)</span> <span class="s2">&#34;m6&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">-------------------------SUNION---------------------------------------
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; SUNION setx sety setz <span class="c1"># setx sety setz的并集</span>
</span></span><span class="line"><span class="cl">1<span class="o">)</span> <span class="s2">&#34;m4&#34;</span>
</span></span><span class="line"><span class="cl">2<span class="o">)</span> <span class="s2">&#34;m6&#34;</span>
</span></span><span class="line"><span class="cl">3<span class="o">)</span> <span class="s2">&#34;m3&#34;</span>
</span></span><span class="line"><span class="cl">4<span class="o">)</span> <span class="s2">&#34;m2&#34;</span>
</span></span><span class="line"><span class="cl">5<span class="o">)</span> <span class="s2">&#34;m1&#34;</span>
</span></span><span class="line"><span class="cl">6<span class="o">)</span> <span class="s2">&#34;m5&#34;</span>
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; SUNION setx sety <span class="c1"># setx sety 并集</span>
</span></span><span class="line"><span class="cl">1<span class="o">)</span> <span class="s2">&#34;m4&#34;</span>
</span></span><span class="line"><span class="cl">2<span class="o">)</span> <span class="s2">&#34;m6&#34;</span>
</span></span><span class="line"><span class="cl">3<span class="o">)</span> <span class="s2">&#34;m2&#34;</span>
</span></span><span class="line"><span class="cl">4<span class="o">)</span> <span class="s2">&#34;m1&#34;</span>
</span></span><span class="line"><span class="cl">5<span class="o">)</span> <span class="s2">&#34;m5&#34;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="hash类型">Hash类型</h2>
<h3 id="命令代码-3">命令代码：</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">------------------------HSET--HMSET--HSETNX----------------
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; HSET studentx name sakura <span class="c1"># 将studentx哈希表作为一个对象，设置name为sakura</span>
</span></span><span class="line"><span class="cl"><span class="o">(</span>integer<span class="o">)</span> <span class="m">1</span>
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; HSET studentx name gyc <span class="c1"># 重复设置field进行覆盖，并返回0</span>
</span></span><span class="line"><span class="cl"><span class="o">(</span>integer<span class="o">)</span> <span class="m">0</span>
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; HSET studentx age <span class="m">20</span> <span class="c1"># 设置studentx的age为20</span>
</span></span><span class="line"><span class="cl"><span class="o">(</span>integer<span class="o">)</span> <span class="m">1</span>
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; HMSET studentx sex <span class="m">1</span> tel <span class="m">15623667886</span> <span class="c1"># 设置sex为1，tel为15623667886</span>
</span></span><span class="line"><span class="cl">OK
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; HSETNX studentx name gyc <span class="c1"># HSETNX 设置已存在的field</span>
</span></span><span class="line"><span class="cl"><span class="o">(</span>integer<span class="o">)</span> <span class="m">0</span> <span class="c1"># 失败</span>
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; HSETNX studentx email 12345@qq.com
</span></span><span class="line"><span class="cl"><span class="o">(</span>integer<span class="o">)</span> <span class="m">1</span> <span class="c1"># 成功</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">----------------------HEXISTS--------------------------------
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; HEXISTS studentx name <span class="c1"># name字段在studentx中是否存在</span>
</span></span><span class="line"><span class="cl"><span class="o">(</span>integer<span class="o">)</span> <span class="m">1</span> <span class="c1"># 存在</span>
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; HEXISTS studentx addr
</span></span><span class="line"><span class="cl"><span class="o">(</span>integer<span class="o">)</span> <span class="m">0</span> <span class="c1"># 不存在</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">-------------------HGET--HMGET--HGETALL-----------
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; HGET studentx name <span class="c1"># 获取studentx中name字段的value</span>
</span></span><span class="line"><span class="cl"><span class="s2">&#34;gyc&#34;</span>
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; HMGET studentx name age tel <span class="c1"># 获取studentx中name、age、tel字段的value</span>
</span></span><span class="line"><span class="cl">1<span class="o">)</span> <span class="s2">&#34;gyc&#34;</span>
</span></span><span class="line"><span class="cl">2<span class="o">)</span> <span class="s2">&#34;20&#34;</span>
</span></span><span class="line"><span class="cl">3<span class="o">)</span> <span class="s2">&#34;15623667886&#34;</span>
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; HGETALL studentx <span class="c1"># 获取studentx中所有的field及其value</span>
</span></span><span class="line"><span class="cl"> 1<span class="o">)</span> <span class="s2">&#34;name&#34;</span>
</span></span><span class="line"><span class="cl"> 2<span class="o">)</span> <span class="s2">&#34;gyc&#34;</span>
</span></span><span class="line"><span class="cl"> 3<span class="o">)</span> <span class="s2">&#34;age&#34;</span>
</span></span><span class="line"><span class="cl"> 4<span class="o">)</span> <span class="s2">&#34;20&#34;</span>
</span></span><span class="line"><span class="cl"> 5<span class="o">)</span> <span class="s2">&#34;sex&#34;</span>
</span></span><span class="line"><span class="cl"> 6<span class="o">)</span> <span class="s2">&#34;1&#34;</span>
</span></span><span class="line"><span class="cl"> 7<span class="o">)</span> <span class="s2">&#34;tel&#34;</span>
</span></span><span class="line"><span class="cl"> 8<span class="o">)</span> <span class="s2">&#34;15623667886&#34;</span>
</span></span><span class="line"><span class="cl"> 9<span class="o">)</span> <span class="s2">&#34;email&#34;</span>
</span></span><span class="line"><span class="cl">10<span class="o">)</span> <span class="s2">&#34;12345@qq.com&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">--------------------HKEYS--HLEN--HVALS--------------
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; HKEYS studentx <span class="c1"># 查看studentx中所有的field</span>
</span></span><span class="line"><span class="cl">1<span class="o">)</span> <span class="s2">&#34;name&#34;</span>
</span></span><span class="line"><span class="cl">2<span class="o">)</span> <span class="s2">&#34;age&#34;</span>
</span></span><span class="line"><span class="cl">3<span class="o">)</span> <span class="s2">&#34;sex&#34;</span>
</span></span><span class="line"><span class="cl">4<span class="o">)</span> <span class="s2">&#34;tel&#34;</span>
</span></span><span class="line"><span class="cl">5<span class="o">)</span> <span class="s2">&#34;email&#34;</span>
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; HLEN studentx <span class="c1"># 查看studentx中的字段数量</span>
</span></span><span class="line"><span class="cl"><span class="o">(</span>integer<span class="o">)</span> <span class="m">5</span>
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; HVALS studentx <span class="c1"># 查看studentx中所有的value</span>
</span></span><span class="line"><span class="cl">1<span class="o">)</span> <span class="s2">&#34;gyc&#34;</span>
</span></span><span class="line"><span class="cl">2<span class="o">)</span> <span class="s2">&#34;20&#34;</span>
</span></span><span class="line"><span class="cl">3<span class="o">)</span> <span class="s2">&#34;1&#34;</span>
</span></span><span class="line"><span class="cl">4<span class="o">)</span> <span class="s2">&#34;15623667886&#34;</span>
</span></span><span class="line"><span class="cl">5<span class="o">)</span> <span class="s2">&#34;12345@qq.com&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">-------------------------HDEL--------------------------
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; HDEL studentx sex tel <span class="c1"># 删除studentx 中的sex、tel字段</span>
</span></span><span class="line"><span class="cl"><span class="o">(</span>integer<span class="o">)</span> <span class="m">2</span>
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; HKEYS studentx
</span></span><span class="line"><span class="cl">1<span class="o">)</span> <span class="s2">&#34;name&#34;</span>
</span></span><span class="line"><span class="cl">2<span class="o">)</span> <span class="s2">&#34;age&#34;</span>
</span></span><span class="line"><span class="cl">3<span class="o">)</span> <span class="s2">&#34;email&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">-------------HINCRBY--HINCRBYFLOAT------------------------
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; HINCRBY studentx age <span class="m">1</span> <span class="c1"># studentx的age字段数值+1</span>
</span></span><span class="line"><span class="cl"><span class="o">(</span>integer<span class="o">)</span> <span class="m">21</span>
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; HINCRBY studentx name <span class="m">1</span> <span class="c1"># 非整数字型字段不可用</span>
</span></span><span class="line"><span class="cl"><span class="o">(</span>error<span class="o">)</span> ERR <span class="nb">hash</span> value is not an integer
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; HINCRBYFLOAT studentx weight 0.6 <span class="c1"># weight字段增加0.6</span>
</span></span><span class="line"><span class="cl"><span class="s2">&#34;90.8&#34;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="zset类型">Zset类型</h2>
<h3 id="命令代码-4">命令代码:</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">-------------------ZADD--ZCARD--ZCOUNT--------------
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; ZADD myzset <span class="m">1</span> m1 <span class="m">2</span> m2 <span class="m">3</span> m3 <span class="c1"># 向有序集合myzset中添加成员m1 score=1 以及成员m2 score=2..</span>
</span></span><span class="line"><span class="cl"><span class="o">(</span>integer<span class="o">)</span> <span class="m">2</span>
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; ZCARD myzset <span class="c1"># 获取有序集合的成员数</span>
</span></span><span class="line"><span class="cl"><span class="o">(</span>integer<span class="o">)</span> <span class="m">2</span>
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; ZCOUNT myzset <span class="m">0</span> <span class="m">1</span> <span class="c1"># 获取score在 [0,1]区间的成员数量</span>
</span></span><span class="line"><span class="cl"><span class="o">(</span>integer<span class="o">)</span> <span class="m">1</span>
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; ZCOUNT myzset <span class="m">0</span> <span class="m">2</span>
</span></span><span class="line"><span class="cl"><span class="o">(</span>integer<span class="o">)</span> <span class="m">2</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">----------------ZINCRBY--ZSCORE--------------------------
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; ZINCRBY myzset <span class="m">5</span> m2 <span class="c1"># 将成员m2的score +5</span>
</span></span><span class="line"><span class="cl"><span class="s2">&#34;7&#34;</span>
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; ZSCORE myzset m1 <span class="c1"># 获取成员m1的score</span>
</span></span><span class="line"><span class="cl"><span class="s2">&#34;1&#34;</span>
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; ZSCORE myzset m2
</span></span><span class="line"><span class="cl"><span class="s2">&#34;7&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">--------------ZRANK--ZRANGE-----------------------------------
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; ZRANK myzset m1 <span class="c1"># 获取成员m1的索引，索引按照score排序，score相同索引值按字典顺序顺序增加</span>
</span></span><span class="line"><span class="cl"><span class="o">(</span>integer<span class="o">)</span> <span class="m">0</span>
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; ZRANK myzset m2
</span></span><span class="line"><span class="cl"><span class="o">(</span>integer<span class="o">)</span> <span class="m">2</span>
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; ZRANGE myzset <span class="m">0</span> <span class="m">1</span> <span class="c1"># 获取索引在 0~1的成员</span>
</span></span><span class="line"><span class="cl">1<span class="o">)</span> <span class="s2">&#34;m1&#34;</span>
</span></span><span class="line"><span class="cl">2<span class="o">)</span> <span class="s2">&#34;m3&#34;</span>
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; ZRANGE myzset <span class="m">0</span> -1 <span class="c1"># 获取全部成员</span>
</span></span><span class="line"><span class="cl">1<span class="o">)</span> <span class="s2">&#34;m1&#34;</span>
</span></span><span class="line"><span class="cl">2<span class="o">)</span> <span class="s2">&#34;m3&#34;</span>
</span></span><span class="line"><span class="cl">3<span class="o">)</span> <span class="s2">&#34;m2&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#testset=&gt;{abc,add,amaze,apple,back,java,redis} score均为0</span>
</span></span><span class="line"><span class="cl">------------------ZRANGEBYLEX---------------------------------
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; ZRANGEBYLEX testset - + <span class="c1"># 返回所有成员</span>
</span></span><span class="line"><span class="cl">1<span class="o">)</span> <span class="s2">&#34;abc&#34;</span>
</span></span><span class="line"><span class="cl">2<span class="o">)</span> <span class="s2">&#34;add&#34;</span>
</span></span><span class="line"><span class="cl">3<span class="o">)</span> <span class="s2">&#34;amaze&#34;</span>
</span></span><span class="line"><span class="cl">4<span class="o">)</span> <span class="s2">&#34;apple&#34;</span>
</span></span><span class="line"><span class="cl">5<span class="o">)</span> <span class="s2">&#34;back&#34;</span>
</span></span><span class="line"><span class="cl">6<span class="o">)</span> <span class="s2">&#34;java&#34;</span>
</span></span><span class="line"><span class="cl">7<span class="o">)</span> <span class="s2">&#34;redis&#34;</span>
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; ZRANGEBYLEX testset - + LIMIT <span class="m">0</span> <span class="m">3</span> <span class="c1"># 分页 按索引显示查询结果的 0,1,2条记录</span>
</span></span><span class="line"><span class="cl">1<span class="o">)</span> <span class="s2">&#34;abc&#34;</span>
</span></span><span class="line"><span class="cl">2<span class="o">)</span> <span class="s2">&#34;add&#34;</span>
</span></span><span class="line"><span class="cl">3<span class="o">)</span> <span class="s2">&#34;amaze&#34;</span>
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; ZRANGEBYLEX testset - + LIMIT <span class="m">3</span> <span class="m">3</span> <span class="c1"># 显示 3,4,5条记录</span>
</span></span><span class="line"><span class="cl">1<span class="o">)</span> <span class="s2">&#34;apple&#34;</span>
</span></span><span class="line"><span class="cl">2<span class="o">)</span> <span class="s2">&#34;back&#34;</span>
</span></span><span class="line"><span class="cl">3<span class="o">)</span> <span class="s2">&#34;java&#34;</span>
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; ZRANGEBYLEX testset <span class="o">(</span>- <span class="o">[</span>apple <span class="c1"># 显示 (-,apple] 区间内的成员</span>
</span></span><span class="line"><span class="cl">1<span class="o">)</span> <span class="s2">&#34;abc&#34;</span>
</span></span><span class="line"><span class="cl">2<span class="o">)</span> <span class="s2">&#34;add&#34;</span>
</span></span><span class="line"><span class="cl">3<span class="o">)</span> <span class="s2">&#34;amaze&#34;</span>
</span></span><span class="line"><span class="cl">4<span class="o">)</span> <span class="s2">&#34;apple&#34;</span>
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; ZRANGEBYLEX testset <span class="o">[</span>apple <span class="o">[</span>java <span class="c1"># 显示 [apple,java]字典区间的成员</span>
</span></span><span class="line"><span class="cl">1<span class="o">)</span> <span class="s2">&#34;apple&#34;</span>
</span></span><span class="line"><span class="cl">2<span class="o">)</span> <span class="s2">&#34;back&#34;</span>
</span></span><span class="line"><span class="cl">3<span class="o">)</span> <span class="s2">&#34;java&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">-----------------------ZRANGEBYSCORE---------------------
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; ZRANGEBYSCORE myzset <span class="m">1</span> <span class="m">10</span> <span class="c1"># 返回score在 [1,10]之间的的成员</span>
</span></span><span class="line"><span class="cl">1<span class="o">)</span> <span class="s2">&#34;m1&#34;</span>
</span></span><span class="line"><span class="cl">2<span class="o">)</span> <span class="s2">&#34;m3&#34;</span>
</span></span><span class="line"><span class="cl">3<span class="o">)</span> <span class="s2">&#34;m2&#34;</span>
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; ZRANGEBYSCORE myzset <span class="m">1</span> <span class="m">5</span>
</span></span><span class="line"><span class="cl">1<span class="o">)</span> <span class="s2">&#34;m1&#34;</span>
</span></span><span class="line"><span class="cl">2<span class="o">)</span> <span class="s2">&#34;m3&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">--------------------ZLEXCOUNT-----------------------------
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; ZLEXCOUNT testset - +
</span></span><span class="line"><span class="cl"><span class="o">(</span>integer<span class="o">)</span> <span class="m">7</span>
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; ZLEXCOUNT testset <span class="o">[</span>apple <span class="o">[</span>java
</span></span><span class="line"><span class="cl"><span class="o">(</span>integer<span class="o">)</span> <span class="m">3</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">------------------ZREM--ZREMRANGEBYLEX--ZREMRANGBYRANK--ZREMRANGEBYSCORE--------------------------------
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; ZREM testset abc <span class="c1"># 移除成员abc</span>
</span></span><span class="line"><span class="cl"><span class="o">(</span>integer<span class="o">)</span> <span class="m">1</span>
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; ZREMRANGEBYLEX testset <span class="o">[</span>apple <span class="o">[</span>java <span class="c1"># 移除字典区间[apple,java]中的所有成员</span>
</span></span><span class="line"><span class="cl"><span class="o">(</span>integer<span class="o">)</span> <span class="m">3</span>
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; ZREMRANGEBYRANK testset <span class="m">0</span> <span class="m">1</span> <span class="c1"># 移除排名0~1的所有成员</span>
</span></span><span class="line"><span class="cl"><span class="o">(</span>integer<span class="o">)</span> <span class="m">2</span>
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; ZREMRANGEBYSCORE myzset <span class="m">0</span> <span class="m">3</span> <span class="c1"># 移除score在 [0,3]的成员</span>
</span></span><span class="line"><span class="cl"><span class="o">(</span>integer<span class="o">)</span> <span class="m">2</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># testset=&gt; {abc,add,apple,amaze,back,java,redis} score均为0</span>
</span></span><span class="line"><span class="cl"><span class="c1"># myzset=&gt; {(m1,1),(m2,2),(m3,3),(m4,4),(m7,7),(m9,9)}</span>
</span></span><span class="line"><span class="cl">----------------ZREVRANGE--ZREVRANGEBYSCORE--ZREVRANGEBYLEX-----------
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; ZREVRANGE myzset <span class="m">0</span> <span class="m">3</span> <span class="c1"># 按score递减排序，然后按索引，返回结果的 0~3</span>
</span></span><span class="line"><span class="cl">1<span class="o">)</span> <span class="s2">&#34;m9&#34;</span>
</span></span><span class="line"><span class="cl">2<span class="o">)</span> <span class="s2">&#34;m7&#34;</span>
</span></span><span class="line"><span class="cl">3<span class="o">)</span> <span class="s2">&#34;m4&#34;</span>
</span></span><span class="line"><span class="cl">4<span class="o">)</span> <span class="s2">&#34;m3&#34;</span>
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; ZREVRANGE myzset <span class="m">2</span> <span class="m">4</span> <span class="c1"># 返回排序结果的 索引的2~4</span>
</span></span><span class="line"><span class="cl">1<span class="o">)</span> <span class="s2">&#34;m4&#34;</span>
</span></span><span class="line"><span class="cl">2<span class="o">)</span> <span class="s2">&#34;m3&#34;</span>
</span></span><span class="line"><span class="cl">3<span class="o">)</span> <span class="s2">&#34;m2&#34;</span>
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; ZREVRANGEBYSCORE myzset <span class="m">6</span> <span class="m">2</span> <span class="c1"># 按score递减顺序 返回集合中分数在[2,6]之间的成员</span>
</span></span><span class="line"><span class="cl">1<span class="o">)</span> <span class="s2">&#34;m4&#34;</span>
</span></span><span class="line"><span class="cl">2<span class="o">)</span> <span class="s2">&#34;m3&#34;</span>
</span></span><span class="line"><span class="cl">3<span class="o">)</span> <span class="s2">&#34;m2&#34;</span>
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; ZREVRANGEBYLEX testset <span class="o">[</span>java <span class="o">(</span>add <span class="c1"># 按字典倒序 返回集合中(add,java]字典区间的成员</span>
</span></span><span class="line"><span class="cl">1<span class="o">)</span> <span class="s2">&#34;java&#34;</span>
</span></span><span class="line"><span class="cl">2<span class="o">)</span> <span class="s2">&#34;back&#34;</span>
</span></span><span class="line"><span class="cl">3<span class="o">)</span> <span class="s2">&#34;apple&#34;</span>
</span></span><span class="line"><span class="cl">4<span class="o">)</span> <span class="s2">&#34;amaze&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">-------------------------ZREVRANK------------------------------
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; ZREVRANK myzset m7 <span class="c1"># 按score递减顺序，返回成员m7索引</span>
</span></span><span class="line"><span class="cl"><span class="o">(</span>integer<span class="o">)</span> <span class="m">1</span>
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; ZREVRANK myzset m2
</span></span><span class="line"><span class="cl"><span class="o">(</span>integer<span class="o">)</span> <span class="m">4</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># mathscore=&gt;{(xm,90),(xh,95),(xg,87)} 小明、小红、小刚的数学成绩</span>
</span></span><span class="line"><span class="cl"><span class="c1"># enscore=&gt;{(xm,70),(xh,93),(xg,90)} 小明、小红、小刚的英语成绩</span>
</span></span><span class="line"><span class="cl">-------------------ZINTERSTORE--ZUNIONSTORE-----------------------------------
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; ZINTERSTORE sumscore <span class="m">2</span> mathscore enscore <span class="c1"># 将mathscore enscore进行合并 结果存放到sumscore</span>
</span></span><span class="line"><span class="cl"><span class="o">(</span>integer<span class="o">)</span> <span class="m">3</span>
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; ZRANGE sumscore <span class="m">0</span> -1 withscores <span class="c1"># 合并后的score是之前集合中所有score的和</span>
</span></span><span class="line"><span class="cl">1<span class="o">)</span> <span class="s2">&#34;xm&#34;</span>
</span></span><span class="line"><span class="cl">2<span class="o">)</span> <span class="s2">&#34;160&#34;</span>
</span></span><span class="line"><span class="cl">3<span class="o">)</span> <span class="s2">&#34;xg&#34;</span>
</span></span><span class="line"><span class="cl">4<span class="o">)</span> <span class="s2">&#34;177&#34;</span>
</span></span><span class="line"><span class="cl">5<span class="o">)</span> <span class="s2">&#34;xh&#34;</span>
</span></span><span class="line"><span class="cl">6<span class="o">)</span> <span class="s2">&#34;188&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; ZUNIONSTORE lowestscore <span class="m">2</span> mathscore enscore AGGREGATE MIN <span class="c1"># 取两个集合的成员score最小值作为结果的</span>
</span></span><span class="line"><span class="cl"><span class="o">(</span>integer<span class="o">)</span> <span class="m">3</span>
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; ZRANGE lowestscore <span class="m">0</span> -1 withscores
</span></span><span class="line"><span class="cl">1<span class="o">)</span> <span class="s2">&#34;xm&#34;</span>
</span></span><span class="line"><span class="cl">2<span class="o">)</span> <span class="s2">&#34;70&#34;</span>
</span></span><span class="line"><span class="cl">3<span class="o">)</span> <span class="s2">&#34;xg&#34;</span>
</span></span><span class="line"><span class="cl">4<span class="o">)</span> <span class="s2">&#34;87&#34;</span>
</span></span><span class="line"><span class="cl">5<span class="o">)</span> <span class="s2">&#34;xh&#34;</span>
</span></span><span class="line"><span class="cl">6<span class="o">)</span> <span class="s2">&#34;93&#34;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h1 id="三种特殊类型">三种特殊类型</h1>
<h2 id="geospatial地理位置">Geospatial(地理位置)</h2>
<h3 id="命令代码-5">命令代码：</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">----------------georadius---------------------
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; GEORADIUS china:city <span class="m">120</span> <span class="m">30</span> <span class="m">500</span> km withcoord withdist <span class="c1"># 查询经纬度(120,30)坐标500km半径内的成员</span>
</span></span><span class="line"><span class="cl">1<span class="o">)</span> 1<span class="o">)</span> <span class="s2">&#34;hangzhou&#34;</span>
</span></span><span class="line"><span class="cl">   2<span class="o">)</span> <span class="s2">&#34;29.4151&#34;</span>
</span></span><span class="line"><span class="cl">   3<span class="o">)</span> 1<span class="o">)</span> <span class="s2">&#34;120.20000249147415&#34;</span>
</span></span><span class="line"><span class="cl">      2<span class="o">)</span> <span class="s2">&#34;30.199999888333501&#34;</span>
</span></span><span class="line"><span class="cl">2<span class="o">)</span> 1<span class="o">)</span> <span class="s2">&#34;shanghai&#34;</span>
</span></span><span class="line"><span class="cl">   2<span class="o">)</span> <span class="s2">&#34;205.3611&#34;</span>
</span></span><span class="line"><span class="cl">   3<span class="o">)</span> 1<span class="o">)</span> <span class="s2">&#34;121.40000134706497&#34;</span>
</span></span><span class="line"><span class="cl">      2<span class="o">)</span> <span class="s2">&#34;31.400000253193539&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">------------geohash---------------------------
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; geohash china:city yichang shanghai <span class="c1"># 获取成员经纬坐标的geohash表示</span>
</span></span><span class="line"><span class="cl">1<span class="o">)</span> <span class="s2">&#34;wmrjwbr5250&#34;</span>
</span></span><span class="line"><span class="cl">2<span class="o">)</span> <span class="s2">&#34;wtw6ds0y300&#34;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="hyperloglog基数统计">Hyperloglog(基数统计)</h2>
<h3 id="命令代码-6">命令代码：</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">----------PFADD--PFCOUNT---------------------
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; PFADD myelemx a b c d e f g h i j k <span class="c1"># 添加元素</span>
</span></span><span class="line"><span class="cl"><span class="o">(</span>integer<span class="o">)</span> <span class="m">1</span>
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; <span class="nb">type</span> myelemx <span class="c1"># hyperloglog底层使用String</span>
</span></span><span class="line"><span class="cl">string
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; PFCOUNT myelemx <span class="c1"># 估算myelemx的基数</span>
</span></span><span class="line"><span class="cl"><span class="o">(</span>integer<span class="o">)</span> <span class="m">11</span>
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; PFADD myelemy i j k z m c b v p q s
</span></span><span class="line"><span class="cl"><span class="o">(</span>integer<span class="o">)</span> <span class="m">1</span>
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; PFCOUNT myelemy
</span></span><span class="line"><span class="cl"><span class="o">(</span>integer<span class="o">)</span> <span class="m">11</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">----------------PFMERGE-----------------------
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; PFMERGE myelemz myelemx myelemy <span class="c1"># 合并myelemx和myelemy 成为myelemz</span>
</span></span><span class="line"><span class="cl">OK
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; PFCOUNT myelemz <span class="c1"># 估算基数</span>
</span></span><span class="line"><span class="cl"><span class="o">(</span>integer<span class="o">)</span> <span class="m">17</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="bitmap位图">BitMap(位图)</h2>
<h3 id="命令代码-7">命令代码：</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">------------setbit--getbit--------------
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; setbit sign <span class="m">0</span> <span class="m">1</span> <span class="c1"># 设置sign的第0位为 1 </span>
</span></span><span class="line"><span class="cl"><span class="o">(</span>integer<span class="o">)</span> <span class="m">0</span>
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; setbit sign <span class="m">2</span> <span class="m">1</span> <span class="c1"># 设置sign的第2位为 1  不设置默认 是0</span>
</span></span><span class="line"><span class="cl"><span class="o">(</span>integer<span class="o">)</span> <span class="m">0</span>
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; setbit sign <span class="m">3</span> <span class="m">1</span>
</span></span><span class="line"><span class="cl"><span class="o">(</span>integer<span class="o">)</span> <span class="m">0</span>
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; setbit sign <span class="m">5</span> <span class="m">1</span>
</span></span><span class="line"><span class="cl"><span class="o">(</span>integer<span class="o">)</span> <span class="m">0</span>
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; <span class="nb">type</span> sign
</span></span><span class="line"><span class="cl">string
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; getbit sign <span class="m">2</span> <span class="c1"># 获取第2位的数值</span>
</span></span><span class="line"><span class="cl"><span class="o">(</span>integer<span class="o">)</span> <span class="m">1</span>
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; getbit sign <span class="m">3</span>
</span></span><span class="line"><span class="cl"><span class="o">(</span>integer<span class="o">)</span> <span class="m">1</span>
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; getbit sign <span class="m">4</span> <span class="c1"># 未设置默认是0</span>
</span></span><span class="line"><span class="cl"><span class="o">(</span>integer<span class="o">)</span> <span class="m">0</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">-----------bitcount----------------------------
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; BITCOUNT sign <span class="c1"># 统计sign中为1的位数</span>
</span></span><span class="line"><span class="cl"><span class="o">(</span>integer<span class="o">)</span> <span class="m">4</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h1 id="redis事务">Redis事务</h1>
<h2 id="事务">事务：</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">Redis的单条命令是保证原子性的，但是redis事务不能保证原子性
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Redis事务本质：一组命令的集合。
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">----------------- 队列 set set set 执行 -------------------
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">事务中每条命令都会被序列化，执行过程中按顺序执行，不允许其他命令进行干扰。
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">一次性
</span></span><span class="line"><span class="cl">顺序性
</span></span><span class="line"><span class="cl">排他性
</span></span><span class="line"><span class="cl">Redis事务没有隔离级别的概念
</span></span><span class="line"><span class="cl">Redis单条命令是保证原子性的，但是事务不保证原子性！
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="redis事务过程">Redis事务过程：</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">开启事务（multi）
</span></span><span class="line"><span class="cl">命令入队
</span></span><span class="line"><span class="cl">执行事务（exec）
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">所以事务中的命令在加入时都没有被执行，直到提交时才会开始执行<span class="o">(</span>Exec<span class="o">)</span>一次性完成。
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; multi <span class="c1"># 开启事务</span>
</span></span><span class="line"><span class="cl">OK
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; <span class="nb">set</span> k1 v1 <span class="c1"># 命令入队</span>
</span></span><span class="line"><span class="cl">QUEUED
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; <span class="nb">set</span> k2 v2 <span class="c1"># ..</span>
</span></span><span class="line"><span class="cl">QUEUED
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; get k1
</span></span><span class="line"><span class="cl">QUEUED
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; <span class="nb">set</span> k3 v3
</span></span><span class="line"><span class="cl">QUEUED
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; keys *
</span></span><span class="line"><span class="cl">QUEUED
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; <span class="nb">exec</span> <span class="c1"># 事务执行</span>
</span></span><span class="line"><span class="cl">1<span class="o">)</span> OK
</span></span><span class="line"><span class="cl">2<span class="o">)</span> OK
</span></span><span class="line"><span class="cl">3<span class="o">)</span> <span class="s2">&#34;v1&#34;</span>
</span></span><span class="line"><span class="cl">4<span class="o">)</span> OK
</span></span><span class="line"><span class="cl">5<span class="o">)</span> 1<span class="o">)</span> <span class="s2">&#34;k3&#34;</span>
</span></span><span class="line"><span class="cl">   2<span class="o">)</span> <span class="s2">&#34;k2&#34;</span>
</span></span><span class="line"><span class="cl">   3<span class="o">)</span> <span class="s2">&#34;k1&#34;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="取消事务discard">取消事务(DISCARD)：</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">127.0.0.1:6379&gt; multi
</span></span><span class="line"><span class="cl">OK
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; <span class="nb">set</span> k1 v1
</span></span><span class="line"><span class="cl">QUEUED
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; <span class="nb">set</span> k2 v2
</span></span><span class="line"><span class="cl">QUEUED
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; DISCARD <span class="c1"># 放弃事务</span>
</span></span><span class="line"><span class="cl">OK
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; EXEC 
</span></span><span class="line"><span class="cl"><span class="o">(</span>error<span class="o">)</span> ERR EXEC without MULTI <span class="c1"># 当前未开启事务</span>
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; get k1 <span class="c1"># 被放弃事务中命令并未执行</span>
</span></span><span class="line"><span class="cl"><span class="o">(</span>nil<span class="o">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="事务错误">事务错误</h2>
<h3 id="1代码语法错误编译时异常所有的命令都不执行">1.代码语法错误（编译时异常）所有的命令都不执行</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">127.0.0.1:6379&gt; multi
</span></span><span class="line"><span class="cl">OK
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; <span class="nb">set</span> k1 v1
</span></span><span class="line"><span class="cl">QUEUED
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; <span class="nb">set</span> k2 v2
</span></span><span class="line"><span class="cl">QUEUED
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; error k1 <span class="c1"># 这是一条语法错误命令</span>
</span></span><span class="line"><span class="cl"><span class="o">(</span>error<span class="o">)</span> ERR unknown <span class="nb">command</span> <span class="sb">`</span>error<span class="sb">`</span>, with args beginning with: <span class="sb">`</span>k1<span class="sb">`</span>, <span class="c1"># 会报错但是不影响后续命令入队 </span>
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; get k2
</span></span><span class="line"><span class="cl">QUEUED
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; EXEC
</span></span><span class="line"><span class="cl"><span class="o">(</span>error<span class="o">)</span> EXECABORT Transaction discarded because of previous errors. <span class="c1"># 执行报错</span>
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; get k1 
</span></span><span class="line"><span class="cl"><span class="o">(</span>nil<span class="o">)</span> <span class="c1"># 其他命令并没有被执行</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="2代码逻辑错误-运行时异常-其他命令可以正常执行---所以不保证事务原子性">2.代码逻辑错误 (运行时异常) **其他命令可以正常执行 ** &raquo;&gt; 所以不保证事务原子性</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">127.0.0.1:6379&gt; multi
</span></span><span class="line"><span class="cl">OK
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; <span class="nb">set</span> k1 v1
</span></span><span class="line"><span class="cl">QUEUED
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; <span class="nb">set</span> k2 v2
</span></span><span class="line"><span class="cl">QUEUED
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; INCR k1 <span class="c1"># 这条命令逻辑错误（对字符串进行增量）</span>
</span></span><span class="line"><span class="cl">QUEUED
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; get k2
</span></span><span class="line"><span class="cl">QUEUED
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; <span class="nb">exec</span>
</span></span><span class="line"><span class="cl">1<span class="o">)</span> OK
</span></span><span class="line"><span class="cl">2<span class="o">)</span> OK
</span></span><span class="line"><span class="cl">3<span class="o">)</span> <span class="o">(</span>error<span class="o">)</span> ERR value is not an integer or out of range <span class="c1"># 运行时报错</span>
</span></span><span class="line"><span class="cl">4<span class="o">)</span> <span class="s2">&#34;v2&#34;</span> <span class="c1"># 其他命令正常执行</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 虽然中间有一条命令报错了，但是后面的指令依旧正常执行成功了。</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 所以说Redis单条指令保证原子性，但是Redis事务不能保证原子性。</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h1 id="监控">监控</h1>
<h2 id="乐观锁">乐观锁：</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">使用watch key监控指定数据，相当于乐观锁加锁。
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="1-正常执行">1. 正常执行</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">127.0.0.1:6379&gt; <span class="nb">set</span> money <span class="m">100</span> <span class="c1"># 设置余额:100</span>
</span></span><span class="line"><span class="cl">OK
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; <span class="nb">set</span> use <span class="m">0</span> <span class="c1"># 支出使用:0</span>
</span></span><span class="line"><span class="cl">OK
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; watch money <span class="c1"># 监视money (上锁)</span>
</span></span><span class="line"><span class="cl">OK
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; multi
</span></span><span class="line"><span class="cl">OK
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; DECRBY money <span class="m">20</span>
</span></span><span class="line"><span class="cl">QUEUED
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; INCRBY use <span class="m">20</span>
</span></span><span class="line"><span class="cl">QUEUED
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; <span class="nb">exec</span> <span class="c1"># 监视值没有被中途修改，事务正常执行</span>
</span></span><span class="line"><span class="cl">1<span class="o">)</span> <span class="o">(</span>integer<span class="o">)</span> <span class="m">80</span>
</span></span><span class="line"><span class="cl">2<span class="o">)</span> <span class="o">(</span>integer<span class="o">)</span> <span class="m">20</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="2多线程测试">2.多线程测试</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">线程1：
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; watch money <span class="c1"># money上锁</span>
</span></span><span class="line"><span class="cl">OK
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; multi
</span></span><span class="line"><span class="cl">OK
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; DECRBY money <span class="m">20</span>
</span></span><span class="line"><span class="cl">QUEUED
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; INCRBY use <span class="m">20</span>
</span></span><span class="line"><span class="cl">QUEUED
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt;     <span class="c1"># 此时事务并没有执行</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">模拟线程插队，线程2：
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; INCRBY money <span class="m">500</span> <span class="c1"># 修改了线程一中监视的money</span>
</span></span><span class="line"><span class="cl"><span class="o">(</span>integer<span class="o">)</span> <span class="m">600</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">回到线程1，执行事务：
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; EXEC <span class="c1"># 执行之前，另一个线程修改了我们的值，这个时候就会导致事务执行失败</span>
</span></span><span class="line"><span class="cl"><span class="o">(</span>nil<span class="o">)</span> <span class="c1"># 没有结果，说明事务执行失败</span>
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; get money <span class="c1"># 线程2 修改生效</span>
</span></span><span class="line"><span class="cl"><span class="s2">&#34;600&#34;</span>
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; get use <span class="c1"># 线程1事务执行失败，数值没有被修改</span>
</span></span><span class="line"><span class="cl"><span class="s2">&#34;0&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">解锁获取最新值，然后再加锁进行事务。
</span></span><span class="line"><span class="cl">unwatch进行解锁。
</span></span><span class="line"><span class="cl">注意：每次提交执行exec后都会自动释放锁，不管是否成功
</span></span></code></pre></td></tr></table>
</div>
</div><h1 id="缓存穿透缓存击穿缓存雪崩">缓存穿透、缓存击穿、缓存雪崩</h1>
<h2 id="缓存穿透">缓存穿透</h2>
<h3 id="概念">概念：</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">在默认情况下，用户请求数据时，会先在缓存(Redis)中查找，若没找到即缓存未命中，再在数据库中进行查找，数量少可能问题不大，可是一旦大量的请求数据（例如秒杀场景）缓存都没有命中的话，就会全部转移到数据库上，造成数据库极大的压力，就有可能导致数据库崩溃。网络安全中也有人恶意使用这种手段进行攻击被称为洪水攻击。
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="解决方案">解决方案：</h3>
<h4 id="1布隆过滤器">1.布隆过滤器</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">布隆过滤器解决方法：
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">将数据库中所有的查询条件，放入布隆过滤器中，当一个查询请求过来时，先经过布隆过滤器进行查，如果判断请求查询值存在，则继续查；如果判断请求查询不存在，直接丢弃。
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">**布隆过滤器原理**
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">原理就是一个对一个key进行k个hash算法获取k个值，在比特数组中将这k个值散列后设定为1，然后查的时候如果特定的这几个位置都为1，那么布隆过滤器判断该key存在。布隆过滤器可能会误判，如果它说不存在那肯定不存在，如果它说存在，那数据有可能实际不存在；Redis的bitmap只支持2^32大小，对应到内存也就是512MB，误判率万分之一，可以放下2亿左右的数据，性能高，空间占用率及小，省去了大量无效的数据库连接。
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">因此我们可以通过布隆过滤器，将Redis缓存穿透控制在一个可容范围内。布隆过滤器可以判断某个数据一定不存在，但是无法判断一定存在。
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="缓存击穿">缓存击穿</h2>
<h3 id="概念-1">概念：</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">相较于缓存穿透，缓存击穿的目的性更强，一个存在的key，在缓存过期的一刻，同时有大量的请求，这些请求都会击穿到DB，造成瞬时DB请求量大、压力骤增。这就是缓存被击穿，只是针对其中某个key的缓存不可用而导致击穿，但是其他的key依然可以使用缓存响应。 比如热搜排行上，一个热点新闻被同时大量访问就可能导致缓存击穿。
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="解决方案-1">解决方案：</h3>
<h4 id="1设置热点数据永不过期">1.设置热点数据永不过期</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">这样就不会出现热点数据过期的情况，但是当Redis内存空间满的时候也会清理部分数据，而且此种方案会占用空间，一旦热点数据多了起来，就会占用部分空间。
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">在访问key之前，采用SETNX（set if not exists）来设置另一个短期key来锁住当前key的访问，访问结束再删除该短期key。保证同时刻只有一个线程访问。这样对锁的要求就十分高。
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="缓存雪崩">缓存雪崩</h2>
<h3 id="概念-2">概念：</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">大量的key设置了相同的过期时间，导致在缓存在同一时刻全部失效，造成瞬时DB请求量大、压力骤增，引起雪崩。
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="解决方案-2">解决方案：</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">1.redis高可用
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">这个思想的含义是，既然redis有可能挂掉，那我多增设几台redis，这样一台挂掉之后其他的还可以继续工作，其实就是搭建的集群
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">2.限流降级
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">这个解决方案的思想是，在缓存失效后，通过加锁或者队列来控制读数据库写缓存的线程数量。比如对某个key只允许一个线程查询数据和写缓存，其他线程等待。
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">3.数据预热
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">数据加热的含义就是在正式部署之前，我先把可能的数据先预先访问一遍，这样部分可能大量访问的数据就会加载到缓存中。在即将发生大并发访问前手动触发加载缓存不同的key，设置不同的过期时间，让缓存失效的时间点尽量均匀。
</span></span></code></pre></td></tr></table>
</div>
</div><h1 id="redis主从复制">Redis主从复制</h1>
<h2 id="概念-3">概念</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">主从复制，是指将一台Redis服务器的数据，复制到其他的Redis服务器。前者称为主节点（Master/Leader）,后者称为从节点（Slave/Follower）， 数据的复制是单向的！只能由主节点复制到从节点（主节点以写为主、从节点以读为主）。
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">默认情况下，每台Redis服务器都是主节点，一个主节点可以有0个或者多个从节点，但每个从节点只能由一个主节点。
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="开启多个redis服务一主二从">开启多个redis服务（一主二从）</h2>
<h3 id="1去阿里云添加安全组规则开放637963806381端口号开放linux防火墙端口号">1.去阿里云添加安全组规则，开放6379/6380/6381端口号，开放linux防火墙端口号</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="c1"># 开放linux防火墙（6379/6380/6381）端口号：</span>
</span></span><span class="line"><span class="cl">firewall-cmd --permanent --add-port<span class="o">=</span>6379/tcp
</span></span><span class="line"><span class="cl">firewall-cmd --permanent --add-port<span class="o">=</span>6380/tcp
</span></span><span class="line"><span class="cl">firewall-cmd --permanent --add-port<span class="o">=</span>6381/tcp
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="2复制redisconf-到-redis-6380confredis-6381conf">2.复制redis.conf 到 redis-6380.conf，redis-6381.conf</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="c1"># 首先进入redis.conf的目录下，使用以下两个命令可以找到redis.conf的目录 </span>
</span></span><span class="line"><span class="cl">  ps -aux<span class="p">|</span>grep redis
</span></span><span class="line"><span class="cl">  ls -l /proc/进程号/cwd
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 然后复制redis.conf，命令如下</span>
</span></span><span class="line"><span class="cl">  cp redis.conf redis-6380.conf
</span></span><span class="line"><span class="cl">  cp redis.conf redis-6381.conf
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="3修改-redis-6380confredis-6381conf信息主要三个信息">3.修改 redis-6380.conf，redis-6381.conf信息（主要三个信息）</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">分别是 pid，port端口号和slaveof 127.0.0.1 <span class="m">6379</span>
</span></span><span class="line"><span class="cl">用vim命令进入 redis-6380.conf配置文件后，命令模式下输入/pid查找pid并修改，slaveof xxx需要手动填写   
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">pidfile /var/run/redis-6380.pid
</span></span><span class="line"><span class="cl">port <span class="m">6380</span>
</span></span><span class="line"><span class="cl">slaveof 127.0.0.1 <span class="m">6379</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="4启动redis服务三个端口号">4.启动redis服务（三个端口号）</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">启动6379服务：redis-server redis.conf          redis-cli -p <span class="m">6379</span>
</span></span><span class="line"><span class="cl">启动6380服务：redis-server redis-6380.conf     redis-cli -p <span class="m">6380</span>
</span></span><span class="line"><span class="cl">启动6381服务：redis-server redis-6381.conf     redis-cli -p <span class="m">6381</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="5查看信息">5.查看信息</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">info replication
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="6遇到master_link_status为down情况">6.遇到master_link_status为down情况</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">进入redis-6380.conf，redis-6381.conf配置文件中，修改如下两个配置
</span></span><span class="line"><span class="cl">1.修改replicaof &lt;masterip&gt; &lt;masterport&gt;为（主机IP和端口号）
</span></span><span class="line"><span class="cl">  replicaof 127.0.0.1 <span class="m">6379</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">2.修改masterauth &lt;master-password&gt;为
</span></span><span class="line"><span class="cl">  masterauth redis123 <span class="o">(</span>主机密码和从机密码设置相同<span class="o">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h1 id="redis哨兵模式">Redis哨兵模式</h1>
<h2 id="复制sentinelconf到自己目录下">复制sentinel.conf到自己目录下</h2>
<h3 id="安装好的redis源码默认含有redisconf文件和sentinelconf文件">安装好的redis源码默认含有redis.conf文件和sentinel.conf文件</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">将/opt/redis-6.0.6下的两个配置文件复制到自己的目录下（ycconfig）
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">cp /opt/redis-6.0.6/redis.conf /usr/local/bin/ycconfig/
</span></span><span class="line"><span class="cl">cp /opt/redis-6.0.6/sentinel.conf /usr/local/bin/ycconfig/
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="复制sentinelconf到sentinel-26380confsentinel-23681conf">复制sentinel.conf到sentinel-26380.conf，sentinel-23681.conf</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">cp sentinel.conf sentinel-26380.conf
</span></span><span class="line"><span class="cl">cp sentinel.conf sentinel-26381.conf
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="修改sentinelconf配置文件主要修改5处其他redis默认的一般不修改">修改sentinel.conf配置文件（主要修改5处，其他redis默认的一般不修改）</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">port <span class="m">26379</span>  
</span></span><span class="line"><span class="cl">哨兵sentinel实例运行的端口，默认26379
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">daemonize yes<span class="o">(</span>默认是no<span class="o">)</span>  
</span></span><span class="line"><span class="cl">redis默认不是以守护进程的方式运行，可以通过该配置项修改，使用yes启用守护进程
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">pidfile /var/run/redis-sentinel.pid
</span></span><span class="line"><span class="cl">当redis以守护进程方式运行时，redis默认会把pid写入/var/run/redis-sentinel.pid文件，可以通过pidfile指定
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">logfile <span class="s2">&#34;/usr/local/bin/ycconfig/sentinel-26379.log&#34;</span>
</span></span><span class="line"><span class="cl">指定日志文件名
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">sentinel auth-pass mymaster redis123
</span></span><span class="line"><span class="cl">设置主的密码
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">sentinel monitor mymaster 127.0.0.1 <span class="m">6379</span> <span class="m">2</span> （redis默认配置）
</span></span><span class="line"><span class="cl">mymaster名字可以自定义，ip地址为master节点的地址 后边的 <span class="m">2</span> 代表的是，如果有俩个哨兵判断这个主节点挂了那这个主节点就挂了，通常设置为哨兵个数一半加一。
</span></span><span class="line"><span class="cl">只有当半数以上的slave节点认为master节点宕机了,才会进行选举master节点,否则不会进行选举
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">sentinel down-after-milliseconds mymaster <span class="m">30000</span> <span class="o">(</span>redis默认配置<span class="o">)</span>
</span></span><span class="line"><span class="cl">哨兵连接主节点多长时间没有响应就代表挂了。后边 <span class="m">30000</span> 是毫秒，也就是 <span class="m">30</span> 秒。
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">sentinel parallel-syncs mymaster <span class="m">1</span> （redis默认配置）
</span></span><span class="line"><span class="cl">这个配置项是指在故障转移时，最多有多少个从节点对新的主节点进行同步,这个值越小完成故障转移的时间就越长，这个值越大就意味着越多的从节点因为同步数据而不可用,可以通过将这个值设为 <span class="m">1</span> 来保证每次只有一个slave 处于不能处理命令请求的状态。
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">sentinel failover-timeout mymaster <span class="m">180000</span>  （redis默认配置）
</span></span><span class="line"><span class="cl">1. 同一个sentinel对同一个master两次failover之间的间隔时间。
</span></span><span class="line"><span class="cl">2. 当一个slave从一个错误的master那里同步数据开始计算时间。直到slave被纠正为向正确的master那里同步数据时。
</span></span><span class="line"><span class="cl">3.当想要取消一个正在进行的failover所需要的时间。
</span></span><span class="line"><span class="cl">4.当进行failover时，配置所有slaves指向新的master所需的最大时间。不过，即使过了这个超时，slaves依然会被正确配置为指向master，但是就不按parallel-syncs所配置的规则来了。
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="启动redis哨兵服务">启动redis哨兵服务</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">redis-sentinel sentienl.conf        <span class="o">(</span>启动26379端口哨兵，两个步骤<span class="o">)</span>
</span></span><span class="line"><span class="cl">    redis-cli -p <span class="m">26379</span>
</span></span><span class="line"><span class="cl">redis-sentinel sentienl-26380.conf  <span class="o">(</span>启动26380端口哨兵，两个步骤<span class="o">)</span>
</span></span><span class="line"><span class="cl">    redis-cli -p <span class="m">26380</span>
</span></span><span class="line"><span class="cl">redis-sentinel sentienl-26381.conf  <span class="o">(</span>启动26381端口哨兵，两个步骤<span class="o">)</span>
</span></span><span class="line"><span class="cl">    redis-cli -p <span class="m">26381</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="查看哨兵信息">查看哨兵信息</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">info sentinel
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">127.0.0.1:26379&gt; info sentinel
</span></span><span class="line"><span class="cl"><span class="c1"># Sentinel</span>
</span></span><span class="line"><span class="cl">sentinel_masters:1
</span></span><span class="line"><span class="cl">sentinel_tilt:0
</span></span><span class="line"><span class="cl">sentinel_running_scripts:0
</span></span><span class="line"><span class="cl">sentinel_scripts_queue_length:0
</span></span><span class="line"><span class="cl">sentinel_simulate_failure_flags:0
</span></span><span class="line"><span class="cl">master0:name<span class="o">=</span>mymaster,status<span class="o">=</span>ok,address<span class="o">=</span>127.0.0.1:6379,slaves<span class="o">=</span>2,sentinels<span class="o">=</span><span class="m">1</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="测试哨兵模式">测试哨兵模式</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="o">[</span>root@yc ~<span class="o">]</span><span class="c1"># ps -ef|grep redis  （找到主机进程号）</span>
</span></span><span class="line"><span class="cl">root      <span class="m">7390</span>     <span class="m">1</span>  <span class="m">0</span> Mar17 ?        00:04:03 redis-server 127.0.0.1:6380
</span></span><span class="line"><span class="cl">root      <span class="m">7647</span>     <span class="m">1</span>  <span class="m">0</span> Mar17 ?        00:04:28 redis-server 127.0.0.1:6379
</span></span><span class="line"><span class="cl">root      <span class="m">7837</span>     <span class="m">1</span>  <span class="m">0</span> Mar17 ?        00:04:03 redis-server 127.0.0.1:6381
</span></span><span class="line"><span class="cl">root     <span class="m">14885</span>     <span class="m">1</span>  <span class="m">0</span> 11:06 ?        00:00:03 redis-sentinel *:26379 <span class="o">[</span>sentinel<span class="o">]</span>
</span></span><span class="line"><span class="cl">root     <span class="m">15311</span>     <span class="m">1</span>  <span class="m">0</span> 11:14 ?        00:00:02 redis-sentinel *:26380 <span class="o">[</span>sentinel<span class="o">]</span>
</span></span><span class="line"><span class="cl">root     <span class="m">15323</span>  <span class="m">9975</span>  <span class="m">0</span> 11:14 pts/0    00:00:00 redis-cli -p <span class="m">26380</span>
</span></span><span class="line"><span class="cl">root     <span class="m">15436</span>     <span class="m">1</span>  <span class="m">0</span> 11:16 ?        00:00:01 redis-sentinel *:26381 <span class="o">[</span>sentinel<span class="o">]</span>
</span></span><span class="line"><span class="cl">root     <span class="m">15449</span>  <span class="m">9997</span>  <span class="m">0</span> 11:16 pts/2    00:00:00 redis-cli -p <span class="m">26381</span>
</span></span><span class="line"><span class="cl">root     <span class="m">15874</span>  <span class="m">9069</span>  <span class="m">0</span> 11:25 pts/1    00:00:00 redis-cli -p <span class="m">6379</span>
</span></span><span class="line"><span class="cl">root     <span class="m">15921</span> <span class="m">15892</span>  <span class="m">0</span> 11:26 pts/3    00:00:00 grep --color<span class="o">=</span>auto redis
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">[</span>root@yc ~<span class="o">]</span><span class="c1"># kill -9 7647  （杀死主机进程）</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">127.0.0.1:6381&gt; info replication  （查看6381端口信息，发现角色从slave变为master）
</span></span><span class="line"><span class="cl"><span class="c1"># Replication</span>
</span></span><span class="line"><span class="cl">role:master
</span></span><span class="line"><span class="cl">connected_slaves:1
</span></span><span class="line"><span class="cl">slave0:ip<span class="o">=</span>127.0.0.1,port<span class="o">=</span>6380,state<span class="o">=</span>online,offset<span class="o">=</span>417612,lag<span class="o">=</span><span class="m">0</span>
</span></span><span class="line"><span class="cl">master_replid:d3597e4133704dfe6b60c8103b5fc7174d480a4b
</span></span><span class="line"><span class="cl">master_replid2:1447d768216f7530d3f885ae67f6529cfc593d02
</span></span><span class="line"><span class="cl">master_repl_offset:417745
</span></span><span class="line"><span class="cl">second_repl_offset:409820
</span></span><span class="line"><span class="cl">repl_backlog_active:1
</span></span><span class="line"><span class="cl">repl_backlog_size:1048576
</span></span><span class="line"><span class="cl">repl_backlog_first_byte_offset:4840
</span></span><span class="line"><span class="cl">repl_backlog_histlen:412906
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">127.0.0.1:26380&gt; info sentinel （查看哨兵信息，发现127.0.0.1:6381成为新的master）
</span></span><span class="line"><span class="cl"><span class="c1"># Sentinel</span>
</span></span><span class="line"><span class="cl">sentinel_masters:1
</span></span><span class="line"><span class="cl">sentinel_tilt:0
</span></span><span class="line"><span class="cl">sentinel_running_scripts:0
</span></span><span class="line"><span class="cl">sentinel_scripts_queue_length:0
</span></span><span class="line"><span class="cl">sentinel_simulate_failure_flags:0
</span></span><span class="line"><span class="cl">master0:name<span class="o">=</span>mymaster,status<span class="o">=</span>ok,address<span class="o">=</span>127.0.0.1:6381,slaves<span class="o">=</span>2,sentinels<span class="o">=</span><span class="m">3</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="遇到的问题">遇到的问题</h2>
<h3 id="启动sentinelconf报错">启动sentinel.conf报错</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">No such master with specified name.
</span></span><span class="line"><span class="cl">原因是配置的顺序，也就是我们监听的时候，是需要先配置监听master，给master取一个名字叫mymaster，才能配置这个认证节点的密码。但是默认配置是密码在前面，监听配置在后面，这样就会报这个错，调整一下即可。
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">sentinel monitor mymaster 127.0.0.1 6379 2
</span></span><span class="line"><span class="cl">sentinel auth-pass mymaster redis123
</span></span><span class="line"><span class="cl">顺序这样就能正常启动
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="主机杀死重连后master_link_statusdown">主机杀死重连后，master_link_status:down</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">这是因为从机设置了密码，当主机重连后会自动变为slave，在redis.conf配置文件中需要配置添加
</span></span><span class="line"><span class="cl">masterauth redis123
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">这样再次重启后master_link_status:up 显示正常
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="sentinel监视redismaster节点挂了不自动选举的问题next-failover-delay-i-will-not-start-a-failover-before-sat-mar-19-003923-2022">sentinel监视redis，master节点挂了不自动选举的问题，Next failover delay: I will not start a failover before Sat Mar 19 00:39:23 2022</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="c1">#修改redis.conf、redis-6380.conf、redis-6381.conf 中bind配置后 重启自动选举生效 </span>
</span></span><span class="line"><span class="cl">1、bind 0.0.0.0
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">2、protected-mode no（这个我本来设置的就是no）
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#修改了#sentinel leader-epoch mymaster后重启（不知道有没有影响）</span>
</span></span><span class="line"><span class="cl"><span class="c1">#sentinel leader-epoch mymaster 44 这个我修改成2 重启后自动修改成44了，之前是184</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h1 id="spirngboot集成redis">SpirngBoot集成Redis</h1>
<h2 id="1添加依赖">1.添加依赖</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-data-redis<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/dependency&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="2yml配置">2.yml配置</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">spring</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">redis</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">host</span><span class="p">:</span><span class="w"> </span><span class="m">8.140.1.39</span><span class="w">   </span><span class="c">#linux对应主机号IP</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="m">6381</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">password</span><span class="p">:</span><span class="w"> </span><span class="l">redis123</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">database</span><span class="p">:</span><span class="w"> </span><span class="m">0</span><span class="w">   </span><span class="c">#默认使用redis第0个数据库</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">lettuce</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">shutdown-timeout</span><span class="p">:</span><span class="w"> </span><span class="m">0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">pool</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">max-active</span><span class="p">:</span><span class="w"> </span><span class="m">8</span><span class="w">  </span><span class="c"># 最大活跃连接</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">max-wait</span><span class="p">:</span><span class="w"> </span>-<span class="m">1</span><span class="w">   </span><span class="c"># 最大阻塞时间</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">max-idle</span><span class="p">:</span><span class="w"> </span><span class="m">8</span><span class="w">    </span><span class="c"># 最大空闲连接</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">min-idle</span><span class="p">:</span><span class="w"> </span><span class="m">0</span><span class="w">    </span><span class="c"># 最小空闲连接</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">connect-timeout</span><span class="p">:</span><span class="w"> </span><span class="m">10000</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kn">package</span> <span class="nn">com.yc.redis</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">org.junit.jupiter.api.Test</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">org.springframework.boot.test.context.SpringBootTest</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">org.springframework.data.geo.Point</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">org.springframework.data.redis.connection.RedisGeoCommands</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">org.springframework.data.redis.core.RedisTemplate</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">java.util.HashMap</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@SpringBootTest</span>
</span></span><span class="line"><span class="cl"><span class="kd">class</span> <span class="nc">RedisSpringbootApplicationTests</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@Autowired</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="n">RedisTemplate</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="n">redisTemplate</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@Test</span>
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="nf">contextLoads</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">redisTemplate</span><span class="o">.</span><span class="na">opsForValue</span><span class="o">().</span><span class="na">get</span><span class="o">(</span><span class="s">&#34;name&#34;</span><span class="o">));</span>
</span></span><span class="line"><span class="cl">        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">redisTemplate</span><span class="o">.</span><span class="na">opsForList</span><span class="o">().</span><span class="na">range</span><span class="o">(</span><span class="s">&#34;list&#34;</span><span class="o">,</span> <span class="n">0</span><span class="o">,</span> <span class="o">-</span><span class="n">1</span><span class="o">));</span>
</span></span><span class="line"><span class="cl">        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">redisTemplate</span><span class="o">.</span><span class="na">hasKey</span><span class="o">(</span><span class="s">&#34;name&#34;</span><span class="o">)</span> <span class="o">+</span> <span class="s">&#34;  &#34;</span> <span class="o">+</span> <span class="n">redisTemplate</span><span class="o">.</span><span class="na">hasKey</span><span class="o">(</span><span class="s">&#34;list&#34;</span><span class="o">));</span>
</span></span><span class="line"><span class="cl">        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">redisTemplate</span><span class="o">.</span><span class="na">opsForValue</span><span class="o">().</span><span class="na">get</span><span class="o">(</span><span class="s">&#34;who&#34;</span><span class="o">));</span>
</span></span><span class="line"><span class="cl">        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">redisTemplate</span><span class="o">.</span><span class="na">keys</span><span class="o">(</span><span class="s">&#34;*&#34;</span><span class="o">));</span>
</span></span><span class="line"><span class="cl">        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">redisTemplate</span><span class="o">.</span><span class="na">opsForList</span><span class="o">().</span><span class="na">index</span><span class="o">(</span><span class="s">&#34;list&#34;</span><span class="o">,</span> <span class="n">3</span><span class="o">));</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;===============================================&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">HashMap</span> <span class="n">hashMap</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">        <span class="n">hashMap</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">&#34;name&#34;</span><span class="o">,</span> <span class="s">&#34;yc&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">hashMap</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">&#34;age&#34;</span><span class="o">,</span> <span class="s">&#34;22&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">hashMap</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">&#34;sex&#34;</span><span class="o">,</span> <span class="s">&#34;男&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">redisTemplate</span><span class="o">.</span><span class="na">opsForHash</span><span class="o">().</span><span class="na">putIfAbsent</span><span class="o">(</span><span class="s">&#34;hash&#34;</span><span class="o">,</span> <span class="s">&#34;name&#34;</span><span class="o">,</span> <span class="s">&#34;yc&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">redisTemplate</span><span class="o">.</span><span class="na">opsForHash</span><span class="o">().</span><span class="na">get</span><span class="o">(</span><span class="s">&#34;hash&#34;</span><span class="o">,</span> <span class="s">&#34;name&#34;</span><span class="o">));</span>
</span></span><span class="line"><span class="cl">        <span class="n">redisTemplate</span><span class="o">.</span><span class="na">opsForHash</span><span class="o">().</span><span class="na">putAll</span><span class="o">(</span><span class="s">&#34;hashmap&#34;</span><span class="o">,</span> <span class="n">hashMap</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@Test</span>
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="nf">geospatial</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">redisTemplate</span><span class="o">.</span><span class="na">opsForGeo</span><span class="o">().</span><span class="na">add</span><span class="o">(</span><span class="s">&#34;china:city&#34;</span><span class="o">,</span> <span class="k">new</span> <span class="n">Point</span><span class="o">(</span><span class="n">116</span><span class="o">.</span><span class="na">512885</span><span class="o">,</span> <span class="n">39</span><span class="o">.</span><span class="na">847469</span><span class="o">),</span> <span class="s">&#34;北京&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">redisTemplate</span><span class="o">.</span><span class="na">opsForGeo</span><span class="o">().</span><span class="na">add</span><span class="o">(</span><span class="s">&#34;china:city&#34;</span><span class="o">,</span> <span class="k">new</span> <span class="n">Point</span><span class="o">(</span><span class="n">121</span><span class="o">.</span><span class="na">486801</span><span class="o">,</span> <span class="n">31</span><span class="o">.</span><span class="na">24257</span><span class="o">),</span> <span class="s">&#34;上海&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">redisTemplate</span><span class="o">.</span><span class="na">opsForGeo</span><span class="o">().</span><span class="na">add</span><span class="o">(</span><span class="s">&#34;china:city&#34;</span><span class="o">,</span> <span class="k">new</span> <span class="n">Point</span><span class="o">(</span><span class="n">114</span><span class="o">.</span><span class="na">064552</span><span class="o">,</span> <span class="n">22</span><span class="o">.</span><span class="na">548457</span><span class="o">),</span> <span class="s">&#34;深圳&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">redisTemplate</span><span class="o">.</span><span class="na">opsForGeo</span><span class="o">().</span><span class="na">add</span><span class="o">(</span><span class="s">&#34;china:city&#34;</span><span class="o">,</span> <span class="k">new</span> <span class="n">Point</span><span class="o">(</span><span class="n">121</span><span class="o">.</span><span class="na">621631</span><span class="o">,</span> <span class="n">38</span><span class="o">.</span><span class="na">918954</span><span class="o">),</span> <span class="s">&#34;大连&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">redisTemplate</span><span class="o">.</span><span class="na">opsForGeo</span><span class="o">().</span><span class="na">add</span><span class="o">(</span><span class="s">&#34;china:city&#34;</span><span class="o">,</span> <span class="k">new</span> <span class="n">Point</span><span class="o">(</span><span class="n">120</span><span class="o">.</span><span class="na">215512</span><span class="o">,</span> <span class="n">30</span><span class="o">.</span><span class="na">253083</span><span class="o">),</span> <span class="s">&#34;杭州&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">redisTemplate</span><span class="o">.</span><span class="na">opsForGeo</span><span class="o">().</span><span class="na">add</span><span class="o">(</span><span class="s">&#34;china:city&#34;</span><span class="o">,</span> <span class="k">new</span> <span class="n">Point</span><span class="o">(</span><span class="n">100</span><span class="o">.</span><span class="na">626621</span><span class="o">,</span> <span class="n">36</span><span class="o">.</span><span class="na">292102</span><span class="o">),</span> <span class="s">&#34;海南&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">redisTemplate</span><span class="o">.</span><span class="na">opsForGeo</span><span class="o">().</span><span class="na">position</span><span class="o">(</span><span class="s">&#34;china:city&#34;</span><span class="o">,</span> <span class="s">&#34;北京&#34;</span><span class="o">,</span> <span class="s">&#34;上海&#34;</span><span class="o">,</span> <span class="s">&#34;深圳&#34;</span><span class="o">,</span> <span class="s">&#34;大连&#34;</span><span class="o">));</span>
</span></span><span class="line"><span class="cl">        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;===========================================================&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;北京与上海之间的距离：&#34;</span> <span class="o">+</span> <span class="n">redisTemplate</span><span class="o">.</span><span class="na">opsForGeo</span><span class="o">().</span><span class="na">distance</span><span class="o">(</span><span class="s">&#34;china:city&#34;</span><span class="o">,</span> <span class="s">&#34;北京&#34;</span><span class="o">,</span> <span class="s">&#34;上海&#34;</span><span class="o">,</span> <span class="n">RedisGeoCommands</span><span class="o">.</span><span class="na">DistanceUnit</span><span class="o">.</span><span class="na">KILOMETERS</span><span class="o">));</span>
</span></span><span class="line"><span class="cl">        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;北京的地理坐标：&#34;</span> <span class="o">+</span> <span class="n">redisTemplate</span><span class="o">.</span><span class="na">opsForGeo</span><span class="o">().</span><span class="na">position</span><span class="o">(</span><span class="s">&#34;china:city&#34;</span><span class="o">,</span> <span class="s">&#34;北京&#34;</span><span class="o">));</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@Test</span>
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="nf">hyperLogLog</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">redisTemplate</span><span class="o">.</span><span class="na">opsForHyperLogLog</span><span class="o">().</span><span class="na">size</span><span class="o">(</span><span class="s">&#34;day&#34;</span><span class="o">));</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="4遇到的问题">4.遇到的问题</h2>
<h3 id="41-启动项目显示unable-to-connect-to-81401396381">4.1 启动项目显示Unable to connect to 8.140.1.39:6381</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="c1"># protected-mode yes 改为 protected-mode no (即该配置项表示是否开启保护模式，默认是开启，开启后Redis只会本地进行访问，拒绝外部访问)。</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 注释掉bind 127.0.0.1 即 #bind 127.0.0.1 (ps: 不注释掉，表示指定 redis 只接收来自于该 IP 地址的请求，注释掉后，则表示将处理所有请求)。</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#开启防火墙（我的错误最后发现是6381防火墙没开）</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 开放6381端口</span>
</span></span><span class="line"><span class="cl">firewall-cmd --permanent --add-port<span class="o">=</span>6381/tcp
</span></span><span class="line"><span class="cl"><span class="c1">#重启防火墙(修改配置后要重启防火墙)</span>
</span></span><span class="line"><span class="cl">firewall-cmd --reload
</span></span></code></pre></td></tr></table>
</div>
</div>
    </div>

    <div class="post-copyright">
  <p class="copyright-item">
    <span class="item-title">文章作者</span>
    <span class="item-content">chengtry</span>
  </p>
  <p class="copyright-item">
    <span class="item-title">上次更新</span>
    <span class="item-content">
        2023-04-23 16:58:31
        
    </span>
  </p>
  
  
</div>
<footer class="post-footer">
      <div class="post-tags">
          <a href="/tags/redis/">Redis</a>
          </div>
      <nav class="post-nav">
        <a class="prev" href="/post/java/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">Java</span>
            <span class="prev-text nav-mobile">上一篇</span>
          </a>
        
      </nav>
    </footer>
  </article>
        </div>
        

  

  

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
      <a href="mailto:412307724@qq.com" class="iconfont icon-email" title="email"></a>
      <a href="https://github.com/chengtry" class="iconfont icon-github" title="github"></a>
  <a href="https://chengtry.github.io/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    由 <a class="hexo-link" href="https://gohugo.io">Hugo</a> 强力驱动
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    主题 - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
    2023<span class="heart"><i class="iconfont icon-heart"></i></span><span>chengtry</span>
  </span>
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js" integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js" integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin="anonymous"></script>



<script type="text/javascript" src="/js/main.min.64437849d125a2d603b3e71d6de5225d641a32d17168a58106e0b61852079683.js"></script>








<script>
  function createCopyButton(highlightDiv) {
    const div = document.createElement("div");
    div.className = "copy-code";
    div.innerText = "Copy";
    div.addEventListener("click", () =>
      copyCodeToClipboard(div, highlightDiv)
    );
    addCopyButtonToDom(div, highlightDiv);
  }

  async function copyCodeToClipboard(button, highlightDiv) {
    const codeToCopy = highlightDiv.querySelector(":last-child > .chroma > code")
      .innerText;
    await navigator.clipboard.writeText(codeToCopy);
    button.blur();
    button.innerText = "Copied!";
    setTimeout(() => button.innerText = "Copy", 2000);
  }

  function addCopyButtonToDom(button, highlightDiv) {
    highlightDiv.insertBefore(button, highlightDiv.firstChild);
    const wrapper = document.createElement("div");
    wrapper.className = "highlight-wrapper";
    highlightDiv.parentNode.insertBefore(wrapper, highlightDiv);
    wrapper.appendChild(highlightDiv);
  }

  var isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);
  if(!isMobile){
     document.querySelectorAll(".highlight").forEach((highlightDiv) => createCopyButton(highlightDiv));
  }
</script>  


</body>
</html>
